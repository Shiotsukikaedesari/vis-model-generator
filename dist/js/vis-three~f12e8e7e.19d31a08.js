(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["vis-three~f12e8e7e"],{2209:function(e,t,s){"use strict";s.d(t,"a",(function(){return le})),s.d(t,"b",(function(){return ft})),s.d(t,"c",(function(){return mt})),s.d(t,"d",(function(){return pe})),s.d(t,"e",(function(){return dt})),s.d(t,"f",(function(){return ms})),s.d(t,"g",(function(){return jt})),s.d(t,"h",(function(){return Es})),s.d(t,"i",(function(){return yt})),s.d(t,"j",(function(){return S})),s.d(t,"k",(function(){return cs})),s.d(t,"l",(function(){return lt})),s.d(t,"m",(function(){return fs})),s.d(t,"n",(function(){return tt}));var i=s("5a89"),r=s("4721"),a=s("ef20"),n=s("32d9"),o=s("93e9"),h=s("b1f1"),c=Object.defineProperty,l=(e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,p=(e,t,s)=>(l(e,"symbol"!==typeof t?t+"":t,s),s);class d{constructor(){p(this,"listeners",new Map)}addEventListener(e,t){const s=this.listeners;s.has(e)||s.set(e,new Set),s.get(e).add(t)}hasEventListener(e,t){const s=this.listeners;return!!s.has(e)&&s.get(e).has(t)}removeEventListener(e,t){const s=this.listeners;s.has(e)&&s.get(e).has(t)&&s.get(e).delete(t)}dispatchEvent(e){var t;const s=e.type,i=this.listeners;if(i.has(s))try{null==(t=i.get(s))||t.forEach(t=>{t.call(this,e)})}catch(r){console.error(r)}}clear(){this.listeners=new Map}useful(){return Boolean([...this.listeners.keys()].length)}}const u="rgb(230, 20, 240)",m="rgb(255, 158, 240)",g="rgb(255, 255, 255)",f=()=>new i["E"]({color:g});class M extends i["F"]{constructor(e){super(),p(this,"sphere"),p(this,"target"),p(this,"shape"),p(this,"type","VisPointLightHelper"),p(this,"cachaColor"),p(this,"cachaDistance"),p(this,"cachaVector3"),this.geometry=new i["e"];const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new i["v"](t,3)),this.material=f(),this.geometry.boundingSphere;const s=(new i["k"]).copy(e.color).multiplyScalar(e.intensity),r=new i["O"](new i["X"](e.distance,0),new i["P"]({color:s,wireframe:!0}));r.raycast=()=>{},this.shape=r,this.target=e,this.sphere=new i["ob"](new i["Db"](0,0,0),1),this.cachaColor=e.color.getHex(),this.cachaDistance=e.distance,this.cachaVector3=new i["Db"],this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.onBeforeRender=()=>{const e=this.target,t=this.shape,s=this;e.distance!==this.cachaDistance&&(t.geometry.dispose(),t.geometry=new i["X"](e.distance,0),this.cachaDistance=e.distance),e.color.getHex()!==this.cachaColor&&(t.material.color.copy(e.color).multiplyScalar(e.intensity),s.material.color.copy(e.color).multiplyScalar(e.intensity),this.cachaColor=e.color.getHex())}}raycast(e,t){const s=this.target,i=s.matrixWorld,r=this.sphere;r.set(this.cachaVector3.set(0,0,0),1),r.applyMatrix4(i),e.ray.intersectsSphere(r)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class E extends i["F"]{constructor(e){super(),p(this,"shape"),p(this,"target"),p(this,"type","CameraHelper"),p(this,"cachaData");const t=new i["e"],s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new i["v"](s,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const r=new i["g"](e);r.matrix=new i["N"],r.matrixAutoUpdate=!0,r.raycast=()=>{},this.add(r),this.shape=r,this.geometry=t,this.material=f(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof i["cb"]?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof i["Z"]?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let t=!1;const s=this.cachaData;Object.keys(s).forEach(i=>{s[i]!==e[i]&&(s[i]=e[i],t=!0)}),t&&this.shape.update()}}raycast(e,t){const s=this.matrixWorld,i=this.geometry.boundingBox.clone();if(i.applyMatrix4(s),e.ray.intersectsBox(i)){const s=this.target;t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}}class b extends i["F"]{constructor(e){super(),p(this,"target"),p(this,"type","VisMeshHelper"),p(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new i["r"](e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=f(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.onBeforeRender=()=>{const e=this.target;e.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new i["r"](e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid)}}}var y;(function(e){e["ADD"]="add",e["REMOVE"]="remove"})(y||(y={}));const w=class extends i["t"]{constructor(e){super(),p(this,"map"),p(this,"scene"),this.map=new Map,this.scene=e}getMap(){return this.map}add(e){if(!w.filterHelperMap[e.type])if(w.typeHelperMap[e.type]){const t=new w.typeHelperMap[e.type](e);this.map.set(e,t),this.scene._add(t),this.dispatchEvent({type:y.ADD,helper:t,object:e})}else console.warn(`Scene helper compiler can not support this type object: '${e.type}'`)}remove(e){if(!w.filterHelperMap[e.type])if(this.map.has(e)){const t=this.map.get(e);this.scene._remove(t),t.geometry.dispose(),t.material&&(t.material instanceof i["M"]?t.material.dispose():t.material.forEach(e=>{e.dispose()})),this.map.delete(e),this.dispatchEvent({type:y.REMOVE,helper:t,object:e})}else console.warn("Scene helper compiler can not found this object`s helper: "+e)}setVisiable(e){const t=this.scene;e?this.map.forEach((e,s)=>{t._add(e)}):this.map.forEach((e,s)=>{t._remove(e)})}resetHelperColor(...e){const t=this.map,s=w.helperColorHex;e.forEach(e=>{if(t.has(e)){const i=t.get(e);i.material.color.setHex(s)}})}setHelperHoverColor(...e){const t=this.map,s=w.hoverColorHex;e.forEach(e=>{if(t.has(e)){const i=t.get(e);i.material.color.setHex(s)}})}setHelperActiveColor(...e){const t=this.map,s=w.activeColorHex;e.forEach(e=>{if(t.has(e)){const i=t.get(e);i.material.color.setHex(s)}})}};let v=w;var C,S,L;p(v,"helperColorHex",new i["k"](g).getHex()),p(v,"activeColorHex",new i["k"](u).getHex()),p(v,"hoverColorHex",new i["k"](m).getHex()),p(v,"typeHelperMap",{PointLight:M,PerspectiveCamera:E,OrthographicCamera:E,Mesh:b}),p(v,"filterHelperMap",{AmbientLight:!0,Object3D:!0}),function(e){e["DefaultPerspectiveCamera"]="DefaultPerspectiveCamera",e["DefaultOrthograpbicCamera"]="DefaultOrthograpbicCamera"}(C||(C={})),function(e){e["DEFAULT"]="default",e["TOP"]="top",e["BOTTOM"]="bottom",e["LEFT"]="left",e["RIGHT"]="right",e["FRONT"]="front",e["BACK"]="back"}(S||(S={})),function(e){e["GEOMETRY"]="geometry",e["MATERIAL"]="material",e["LIGHT"]="light",e["ENV"]="env"}(L||(L={})),i["mb"].prototype.add=function(...e){if(!arguments.length)return this;if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}const t=e[0];if(t===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this;if(t&&t.isObject3D){if(null!==t.parent){const e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent({type:"removed"}))}t.parent=this,this.children.push(t),t.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this};class A extends i["mb"]{constructor(e){if(super(),p(this,"cameraSet"),p(this,"lightSet"),p(this,"meshSet"),p(this,"lineSet"),p(this,"pointsSet"),p(this,"spriteSet"),p(this,"helperCompiler"),p(this,"resetHoverObjectSet"),p(this,"resetActiveObjectSet"),p(this,"displayMode"),p(this,"meshOverrideMaterial"),p(this,"lineOverrideMaterial"),p(this,"pointsOverrideMaterial"),p(this,"spriteOverrideMaterial"),p(this,"materialCacheMap"),p(this,"defaultAmbientLight"),p(this,"defaultDirectionalLight"),p(this,"backgroundCache"),p(this,"environmentCache"),p(this,"defaultPerspectiveCamera"),p(this,"defaultOrthograpbicCamera"),p(this,"axesHelper"),p(this,"gridHelper"),p(this,"showAxesHelper"),p(this,"showGridHelper"),p(this,"getDefaultPerspectiveCamera"),p(this,"getDefaultOrthographicCamera"),p(this,"setAxesHelper"),p(this,"setGridHelper"),p(this,"switchDisplayMode"),p(this,"setDisplayMode"),this.cameraSet=new Set,this.lightSet=new Set,this.meshSet=new Set,this.lineSet=new Set,this.pointsSet=new Set,this.spriteSet=new Set,this.helperCompiler=new v(this),this.resetHoverObjectSet=new Set,this.resetActiveObjectSet=new Set,e.hasDefaultPerspectiveCamera&&(e.defaultPerspectiveCameraSetting?this.defaultPerspectiveCamera=new i["cb"](e.defaultPerspectiveCameraSetting.fov,e.defaultPerspectiveCameraSetting.aspect,e.defaultPerspectiveCameraSetting.near,e.defaultPerspectiveCameraSetting.far):this.defaultPerspectiveCamera=new i["cb"](45,window.innerWidth/window.innerHeight,1,1e3),this.defaultPerspectiveCamera.position.set(50,50,50),this.defaultPerspectiveCamera.lookAt(0,0,0),this.defaultPerspectiveCamera.name="默认透视相机",this.cameraSet.add(this.defaultPerspectiveCamera),this.getDefaultPerspectiveCamera=function(){return this.defaultPerspectiveCamera}),e.hasDefaultOrthographicCamera){if(e.defaultOrthographicCameraSetting){const t=e.defaultOrthographicCameraSetting;this.defaultOrthograpbicCamera=new i["Z"](t.left,t.right,t.top,t.bottom,t.near,t.far)}else{const e=window.innerWidth/2,t=window.innerHeight/2;this.defaultOrthograpbicCamera=new i["Z"](-e/8,e/8,t/8,-t/8,1,1e3)}this.defaultOrthograpbicCamera.name="默认正交相机",this.cameraSet.add(this.defaultOrthograpbicCamera),this.getDefaultOrthographicCamera=function(){return this.defaultOrthograpbicCamera},this.addEventListener(S.TOP+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,60,0)}),this.addEventListener(S.BOTTOM+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,-60,0)}),this.addEventListener(S.RIGHT+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(60,0,0)}),this.addEventListener(S.LEFT+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(-60,0,0)}),this.addEventListener(S.FRONT+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,0,60)}),this.addEventListener(S.BACK+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,0,-60)})}if(e.hasAxesHelper&&(this.axesHelper=new i["b"](500),this.axesHelper.matrixAutoUpdate=!1,this.axesHelper.raycast=()=>{},super.add(this.axesHelper),this.setAxesHelper=function(e){const t=this.axesHelper;if(e.size){const s=t.geometry.getAttribute("position");s.setX(e.size,1),s.setY(e.size,3),s.setZ(e.size,5),s.needsUpdate=!0}void 0!==typeof e.visiable&&(t.visible=e.visiable)},this.showAxesHelper=e=>{e?super.add(this.axesHelper):super.remove(this.axesHelper)}),e.hasGridHelper){const e=new i["z"](500,50,"rgb(130, 130, 130)","rgb(70, 70, 70)");if(e.raycast=()=>{},e.material instanceof i["M"]){const t=e.material;t.transparent=!0,t.opacity=.5,t.needsUpdate=!0}e.matrixAutoUpdate=!1,e.raycast=()=>{},this.gridHelper=e,super.add(e),this.addEventListener(S.DEFAULT+"ViewPoint",t=>{e.rotation.set(0,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(S.TOP+"ViewPoint",t=>{e.rotation.set(0,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(S.BOTTOM+"ViewPoint",t=>{e.rotation.set(0,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(S.RIGHT+"ViewPoint",t=>{e.rotation.set(0,0,Math.PI/2),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(S.LEFT+"ViewPoint",t=>{e.rotation.set(0,0,Math.PI/2),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(S.FRONT+"ViewPoint",t=>{e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(S.BACK+"ViewPoint",t=>{e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.showGridHelper=e=>{e?super.add(this.gridHelper):super.remove(this.gridHelper)}}if(e.hasDisplayMode){const t="rgb(250, 250, 250)";this.meshOverrideMaterial=new i["Q"]({color:t}),this.lineOverrideMaterial=new i["E"]({color:t}),this.pointsOverrideMaterial=new i["hb"]({color:t,size:5,sizeAttenuation:!1}),this.spriteOverrideMaterial=new i["ub"]({color:t}),this.materialCacheMap=new WeakMap,this.defaultAmbientLight=new i["a"]("rgb(255, 255, 255)",.5),this.defaultAmbientLight.matrixAutoUpdate=!1,this.defaultDirectionalLight=new i["o"]("rgb(255, 255, 255)",.3),this.defaultDirectionalLight.castShadow=!1,this.defaultDirectionalLight.position.set(-100,100,100),this.defaultDirectionalLight.updateMatrix(),this.defaultDirectionalLight.updateMatrixWorld(),this.defaultDirectionalLight.matrixAutoUpdate=!1,this.switchDisplayMode=e=>{const t=()=>{const e=this.materialCacheMap,t=this.meshOverrideMaterial;this.meshSet.forEach(s=>{e.set(s,s.material),s.material=t});const s=this.lineOverrideMaterial;this.lineSet.forEach(t=>{e.set(t,t.material),t.material=s});const i=this.pointsOverrideMaterial;this.pointsSet.forEach(t=>{e.set(t,t.material),t.material=i});const r=this.spriteOverrideMaterial;this.spriteSet.forEach(t=>{e.set(t,t.material),t.material=r})},s=()=>{const e=this.materialCacheMap;this.meshSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))}),this.lineSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))}),this.pointsSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))}),this.spriteSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))})},r=()=>{this.lightSet.forEach(e=>{super.remove(e)}),super.add(this.defaultAmbientLight),super.add(this.defaultDirectionalLight)},a=()=>{this.lightSet.forEach(e=>{super.add(e)}),super.remove(this.defaultAmbientLight),super.remove(this.defaultDirectionalLight)},n=()=>{this.background instanceof i["xb"]&&(this.backgroundCache=this.background,this.background=null),this.environment instanceof i["xb"]&&(this.environmentCache=this.environment,this.environment=null)},o=()=>{this.backgroundCache&&(this.background=this.backgroundCache,this.backgroundCache=void 0),this.environmentCache&&(this.environment=this.environmentCache,this.environmentCache=void 0)};e===L.GEOMETRY?(t(),n(),r()):e===L.MATERIAL?(s(),n(),r()):e===L.LIGHT?(s(),n(),a()):e===L.ENV?(s(),o(),a()):console.warn("VisScene can not set this mode: "+e)},this.setDisplayMode=e=>{this.displayMode=e,this.switchDisplayMode(e)},void 0!==e.displayMode?(this.setDisplayMode(e.displayMode),this.switchDisplayMode(this.displayMode)):(this.setDisplayMode(L.ENV),this.switchDisplayMode(this.displayMode))}}getHelperCompiler(){return this.helperCompiler}setObjectHelperVisiable(e){this.helperCompiler.setVisiable(e)}setObjectHelperHover(...e){const t=this.resetHoverObjectSet,s=this.resetActiveObjectSet;return e.forEach((e,i,r)=>{t.delete(e),s.has(e)&&r.splice(i,1)}),s.forEach(e=>{t.delete(e)}),this.helperCompiler.resetHelperColor(...t),t.clear(),this.helperCompiler.setHelperHoverColor(...e),e.forEach(e=>{t.add(e)}),this}setObjectHelperActive(...e){const t=this.resetActiveObjectSet;return e.forEach(e=>{t.delete(e)}),this.helperCompiler.resetHelperColor(...t),t.clear(),this.helperCompiler.setHelperActiveColor(...e),e.forEach(e=>{t.add(e)}),this}showObjectHelper(e){return this.helperCompiler.setVisiable(e),this}setViewPoint(e){this.dispatchEvent({type:e+"ViewPoint"})}add(...e){let t=0;return e.forEach(e=>{e instanceof i["O"]?(this.meshSet.add(e),t+=1):e instanceof i["D"]?(this.lineSet.add(e),t+=1):e instanceof i["C"]?(this.lightSet.add(e),t+=1):e instanceof i["gb"]?(this.pointsSet.add(e),t+=1):e instanceof i["tb"]?(this.spriteSet.add(e),t+=1):e instanceof i["f"]&&(this.cameraSet.add(e),t+=1),this.helperCompiler.add(e)}),void 0!==this.displayMode&&t>0&&this.switchDisplayMode(this.displayMode),super.add(...e)}remove(...e){const t=this.materialCacheMap;return e.forEach(e=>{t&&t.has(e)&&t.delete(e),e instanceof i["O"]?this.meshSet.delete(e):e instanceof i["D"]?this.lineSet.delete(e):e instanceof i["C"]?this.lightSet.delete(e):e instanceof i["gb"]?this.pointsSet.delete(e):e instanceof i["tb"]?this.spriteSet.delete(e):e instanceof i["f"]&&this.cameraSet.delete(e),this.helperCompiler.remove(e)}),super.remove(...e)}_add(...e){return super.add(...e)}_remove(...e){return super.remove(...e)}updateMaterial(e){var t;return void 0!==this.displayMode&&"geometry"===this.displayMode&&(null==(t=this.materialCacheMap)||t.set(e,e.material),this.switchDisplayMode&&this.switchDisplayMode(this.displayMode)),this}}const R=function(e){if(this.scene instanceof A)return console.warn("this has installed modeling scene plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;const t=new A(e);if(this.scene=t,this.render=()=>(this.webGLRenderer.render(t,this.currentCamera),this),e.hasDefaultPerspectiveCamera){const e=t.getDefaultPerspectiveCamera();this.currentCamera=e,t.addEventListener(S.DEFAULT+"ViewPoint",t=>{this.setCamera(e)})}if(e.hasDefaultOrthographicCamera){const e=t.getDefaultOrthographicCamera();t.addEventListener(S.TOP+"ViewPoint",t=>{this.orbitControls&&this.orbitControls.target.set(0,0,0),this.setCamera(e)}),t.addEventListener(S.BOTTOM+"ViewPoint",t=>{this.orbitControls&&this.orbitControls.target.set(0,0,0),this.setCamera(e)}),t.addEventListener(S.RIGHT+"ViewPoint",t=>{this.orbitControls&&this.orbitControls.target.set(0,0,0),this.setCamera(e)}),t.addEventListener(S.LEFT+"ViewPoint",t=>{this.orbitControls&&this.orbitControls.target.set(0,0,0),this.setCamera(e)}),t.addEventListener(S.FRONT+"ViewPoint",t=>{this.orbitControls&&this.orbitControls.target.set(0,0,0),this.setCamera(e)}),t.addEventListener(S.BACK+"ViewPoint",t=>{this.orbitControls&&this.orbitControls.target.set(0,0,0),this.setCamera(e)})}return!0},T=function(e){if(this.scene)return console.warn("this has installed scene plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;this.scene=new i["mb"],this.render=()=>(this.webGLRenderer.render(this.scene,this.currentCamera),this);const t=new i["cb"];return t.position.set(50,50,50),t.lookAt(0,0,0),this.currentCamera=t,!0};var O,x,D,j;(function(e){e["RENDER"]="render",e["PLAY"]="play",e["STOP"]="stop"})(O||(O={})),function(e){e["HOVERCHANGE"]="hover-change",e["ACTIVECHANGE"]="active-change"}(x||(x={})),function(e){e["POINTERDOWN"]="pointerdown",e["POINTERMOVE"]="pointermove",e["POINTERUP"]="pointerup"}(D||(D={})),function(e){e["SETMATERIAL"]="setMaterial"}(j||(j={}));class I extends d{constructor(){super(...arguments),p(this,"clock",new i["j"]),p(this,"animationFrame",-1),p(this,"render",()=>{const e=this.clock,t=e.getDelta(),s=e.getElapsedTime();this.dispatchEvent({type:O.RENDER,delta:t,total:s})}),p(this,"play",()=>{this.dispatchEvent({type:O.PLAY});const e=()=>{this.render(),this.animationFrame=requestAnimationFrame(e)};e()}),p(this,"stop",()=>{cancelAnimationFrame(this.animationFrame),this.animationFrame=-1,this.dispatchEvent({type:O.STOP})}),p(this,"checkHasRendering",()=>-1!==this.animationFrame),p(this,"hasVaildRender",()=>this.useful())}}const P=function(){return this.renderManager?(console.warn("this has installed render manager plugin."),!1):(this.renderManager=new I,this.render&&this.renderManager.addEventListener("render",this.render),this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},!0)};class G extends r["a"]{constructor(e,t){super(e,t),this.mouseButtons={LEFT:null,MIDDLE:i["L"].DOLLY,RIGHT:i["L"].ROTATE}}setCamera(e){return this.object=e,this.update(),this}}const N=function(e){if(this.orbitControls)return console.warn("this has installed orbitControls plugin."),!1;if(!this.webGLRenderer)return console.warn("this must install renderer before install orbitControls plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install orbitControls plugin."),!1;if(this.orbitControls=new G(this.currentCamera,this.dom),this.addEventListener("setCamera",e=>{this.orbitControls.setCamera(e.camera)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.scene instanceof A){const e=this.scene;e.addEventListener(S.DEFAULT+"ViewPoint",e=>{this.orbitControls.enableRotate=!0}),e.addEventListener(S.TOP+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(S.BOTTOM+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(S.RIGHT+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(S.LEFT+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(S.FRONT+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(S.BACK+"ViewPoint",e=>{this.orbitControls.enableRotate=!1})}return!0};class k{constructor(e){p(this,"REVISION"),p(this,"dom"),p(this,"addPanel"),p(this,"showPanel"),p(this,"begin"),p(this,"end"),p(this,"update"),p(this,"domElement"),p(this,"setMode");const t=Object(a["a"])();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const s=this.domElement;s.style.position="absolute",s.style.top="0",s.style.left="35px",e&&(s.style.top=e.top+"px",s.style.left=e.left+"px",s.style.right=e.right+"px",s.style.bottom=e.bottom+"px")}}const H=function(e){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install stats plugin."),!1;const t=new k(e);return this.stats=t,this.setStats=function(e){if(e)this.dom.appendChild(this.stats.domElement);else try{this.dom.removeChild(this.stats.domElement)}catch(t){}return this},this.renderManager.addEventListener("render",()=>{this.stats.update()}),!0},z=function(e){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let t,s;if(null==e?void 0:e.WebGLMultisampleRenderTarget){const e=this.webGLRenderer,s=e.getPixelRatio(),r=e.getDrawingBufferSize(new i["Cb"]);t=new n["a"](e,new i["Eb"](r.width*s,r.height*s,{format:i["jb"]}))}else t=new n["a"](this.webGLRenderer);return this.effectComposer=t,this.scene?(s=new o["a"](this.scene,this.currentCamera),t.addPass(s),this.addEventListener("setCamera",e=>{s.camera=e.camera}),this.addEventListener("setSize",e=>{t.setSize(e.width,e.height)}),this.renderManager&&this.renderManager.removeEventListener("render",this.render),this.render=()=>(this.effectComposer.render(),this),this.renderManager&&this.renderManager.addEventListener("render",e=>{this.effectComposer.render(e.delta)}),!0):(console.error("composer con not found support scene plugin."),!1)};class V extends d{constructor(e){super(),p(this,"dom"),p(this,"mouse"),p(this,"canMouseMove"),p(this,"mouseEventTimer"),p(this,"throttleTime");const t=e.dom;this.dom=t,this.mouse=new i["Cb"],this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60,t.addEventListener("pointerdown",e=>{this.pointerDown(e)}),t.addEventListener("pointermove",e=>{this.canMouseMove&&(this.canMouseMove=!1,this.mouseEventTimer=setTimeout(()=>{const t=this.mouse,s=this.dom;t.x=e.offsetX/s.offsetWidth*2-1,t.y=-e.offsetY/s.offsetHeight*2+1,this.canMouseMove=!0,this.pointerMove(e)},this.throttleTime))}),t.addEventListener("pointerup",e=>{this.pointerUp(e)})}getMousePoint(){return this.mouse}pointerDown(e){const t={mouse:this.mouse};for(let s in e)t[s]=e[s];this.dispatchEvent(t)}pointerMove(e){const t={mouse:this.mouse};for(let s in e)t[s]=e[s];this.dispatchEvent(t)}pointerUp(e){const t={mouse:this.mouse};for(let s in e)t[s]=e[s];this.dispatchEvent(t)}}const F=function(e){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;const t=new V(Object.assign(e||{},{dom:this.dom}));return this.pointerManager=t,!0};class U extends d{constructor(e){super(),p(this,"raycaster"),p(this,"scene"),p(this,"camera"),p(this,"recursive",!1),p(this,"penetrate",!1),this.raycaster=new i["kb"],this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setCamera(e){return this.camera=e,this}intersectObject(e){return this.raycaster.setFromCamera(e,this.camera),this.raycaster.intersectObjects(this.scene.children,this.recursive)}use(e){const t=function(e,t){return Object.assign({},e,t)};e.addEventListener("pointerdown",e=>{const s=this.intersectObject(e.mouse);if(this.dispatchEvent(t(e,{type:"pointerdown",intersections:s})),this.dispatchEvent(t(e,{type:"mousedown",intersections:s})),s.length)if(this.penetrate)for(let i of s)i.object.dispatchEvent(t(e,{type:"pointerdown",intersection:i})),i.object.dispatchEvent(t(e,{type:"mousedown",intersection:i}));else{const i=s[0];i.object.dispatchEvent(t(e,{type:"pointerdown",intersection:i})),i.object.dispatchEvent(t(e,{type:"mousedown",intersection:i}))}});const s=new Map;return e.addEventListener("pointermove",e=>{const i=this.intersectObject(e.mouse);if(this.dispatchEvent(t(e,{type:"pointermove",intersections:i})),this.dispatchEvent(t(e,{type:"mousemove",intersections:i})),i.length){if(this.penetrate)for(let r of i)s.has(r.object)?(r.object.dispatchEvent(t(e,{type:"pointermove",intersection:r})),r.object.dispatchEvent(t(e,{type:"mousemove",intersection:r}))):(r.object.dispatchEvent(t(e,{type:"pointerenter",intersection:r})),r.object.dispatchEvent(t(e,{type:"mouseenter",intersection:r})));else{const r=i[0];s.has(r.object)?(r.object.dispatchEvent(t(e,{type:"pointermove",intersection:r})),r.object.dispatchEvent(t(e,{type:"mousemove",intersection:r}))):(r.object.dispatchEvent(t(e,{type:"pointerenter",intersection:r})),r.object.dispatchEvent(t(e,{type:"mouseenter",intersection:r})))}for(let e of i)s.set(e.object,e)}else s.forEach(s=>{s.object.dispatchEvent(t(e,{type:"pointerleave",intersection:s})),s.object.dispatchEvent(t(e,{type:"mouseleave",intersection:s}))}),s.clear()}),e.addEventListener("pointerup",e=>{const s=this.intersectObject(e.mouse);if(this.dispatchEvent(t(e,{type:"pointerup",intersections:s})),this.dispatchEvent(t(e,{type:"mouseup",intersections:s})),this.dispatchEvent(t(e,{type:"click",intersections:s})),s.length)if(this.penetrate)for(let i of s)i.object.dispatchEvent(t(e,{type:"pointerup",intersection:i})),i.object.dispatchEvent(t(e,{type:"mouseup",intersection:i})),i.object.dispatchEvent(t(e,{type:"click",intersection:i}));else{const i=s[0];i.object.dispatchEvent(t(e,{type:"pointerup",intersection:i})),i.object.dispatchEvent(t(e,{type:"mouseup",intersection:i})),i.object.dispatchEvent(t(e,{type:"click",intersection:i}))}}),this}}const B=function(e){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const t=new U(Object.assign({scene:this.scene,camera:this.currentCamera},e));return t.use(this.pointerManager),this.eventManager=t,this.addEventListener("setCamera",e=>{this.eventManager.setCamera(e.camera)}),this.scene instanceof A&&(this.eventManager.addEventListener("pointermove",e=>{this.scene.setObjectHelperHover(...e.intersections.map(e=>e.object))}),this.eventManager.addEventListener("click",e=>{this.transing?this.transing=!1:0===e.button&&this.scene.setObjectHelperActive(...e.intersections.map(e=>e.object))})),!0};var W;(function(e){e["OBJECTCHANGE"]="objectChange",e["OBJECTCHANGED"]="objectChanged"})(W||(W={}));class $ extends h["a"]{constructor(e,t){super(e,t),p(this,"target"),p(this,"transObjectSet"),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=e=>{var t;this.enabled&&(null==(t=this.object)?void 0:t.parent)&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new i["W"],this.transObjectSet=new Set;let s="",r=this.target,a=this.transObjectSet,n={x:0,y:0,z:0},o=new WeakMap;this.addEventListener("mouseDown",e=>{s=e.target.mode,"translate"===s&&(s="position"),"rotate"===s&&(s="rotation"),n.x=r[s].x,n.y=r[s].y,n.z=r[s].z,a.forEach(e=>{o.set(e,e.matrixAutoUpdate),e.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",e=>{const t=r[s].x-n.x,i=r[s].y-n.y,o=r[s].z-n.z;n.x=r[s].x,n.y=r[s].y,n.z=r[s].z,a.forEach(e=>{e[s].x+=t,e[s].y+=i,e[s].z+=o,e.updateMatrix(),e.updateMatrixWorld()}),this.dispatchEvent({type:W.OBJECTCHANGED,transObjectSet:a,mode:s,target:r})}),this.addEventListener("mouseUp",e=>{a.forEach(e=>{e.matrixAutoUpdate=o.get(e),o.delete(e)})})}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setCamera(e){return this.camera=e,this}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(1===e.length){const s=e[0];return t.scale.copy(s.scale),t.rotation.copy(s.rotation),t.position.copy(s.position),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(s),this}const s=[],i=[],r=[];return e.forEach(e=>{s.push(e.position.x),i.push(e.position.y),r.push(e.position.z)}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.position.y=(Math.max(...i)-Math.min(...i))/2+Math.min(...i),t.position.z=(Math.max(...r)-Math.min(...r))/2+Math.min(...r),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(e=>{this.transObjectSet.add(e)}),this}}const _=function(e){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.webGLRenderer)return console.warn("this must install renderer before install transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const t=new $(this.currentCamera,this.dom);return this.transformControls=t,this.transing=!1,t.addEventListener("mouseDown",()=>{this.transing=!0}),this.scene instanceof i["mb"]?(this.scene.add(this.transformControls),this.scene.add(this.transformControls.target)):this.scene instanceof A&&(this.scene._add(this.transformControls),this.scene._add(this.transformControls.target)),this.setTransformControls=function(e){return this.transformControls.visible=e,this},this.addEventListener("setCamera",e=>{t.setCamera(e.camera)}),this.eventManager.addEventListener("pointerup",e=>{if(!this.transing&&0===e.button){const s=e.intersections.map(e=>e.object);t.setAttach(s[0])}}),!0},J=function(e){return this.webGLRenderer?(console.warn("this has installed webglRenderer plugin."),!1):(this.webGLRenderer=new i["Gb"](e),this.dom=this.webGLRenderer.domElement,this.setSize=function(e,t){var s,i;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=null==(s=this.dom)?void 0:s.offsetWidth),!t&&(t=null==(i=this.dom)?void 0:i.offsetHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)},this.setCamera=function(e){return this.currentCamera=e,this.dispatchEvent({type:"setCamera",camera:e}),this},this.setDom=function(e){return this.dom=e,e.appendChild(this.webGLRenderer.domElement),this},this.addEventListener("setSize",e=>{const t=e.width,s=e.height;this.webGLRenderer.setSize(t,s,!0);const r=this.currentCamera;r&&(r instanceof i["cb"]?(r.aspect=e.width/e.height,r.updateProjectionMatrix()):r instanceof i["Z"]&&(r.left=-t/16,r.right=t/16,r.top=s/16,r.bottom=-s/16,r.updateProjectionMatrix()))}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),!0)},X=/^[og]\s*(.+)?/,Y=/^mtllib /,Z=/^usemtl /,K=/^usemap /,q=new i["Db"],Q=new i["Db"],ee=new i["Db"],te=new i["Db"],se=new i["Db"];function ie(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const s=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const s=this._finalize(!1);s&&(s.inherited||s.groupCount<=0)&&this.materials.splice(s.index,1);const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==s?s.smooth:this.smooth,groupStart:void 0!==s?s.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"===typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let s=this.materials.length-1;s>=0;s--)this.materials[s].groupCount<=0&&this.materials.splice(s,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},s&&s.name&&"function"===typeof s.clone){const e=s.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)},parseNormalIndex:function(e,t){const s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)},parseUVIndex:function(e,t){const s=parseInt(e,10);return 2*(s>=0?s-1:s+t/2)},addVertex:function(e,t,s){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[s+0],i[s+1],i[s+2])},addVertexPoint:function(e){const t=this.vertices,s=this.object.geometry.vertices;s.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices,s=this.object.geometry.vertices;s.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,s){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[s+0],i[s+1],i[s+2])},addFaceNormal:function(e,t,s){const i=this.vertices,r=this.object.geometry.normals;q.fromArray(i,e),Q.fromArray(i,t),ee.fromArray(i,s),se.subVectors(ee,Q),te.subVectors(q,Q),se.cross(te),se.normalize(),r.push(se.x,se.y,se.z),r.push(se.x,se.y,se.z),r.push(se.x,se.y,se.z)},addColor:function(e,t,s){const i=this.colors,r=this.object.geometry.colors;void 0!==i[e]&&r.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&r.push(i[t+0],i[t+1],i[t+2]),void 0!==i[s]&&r.push(i[s+0],i[s+1],i[s+2])},addUV:function(e,t,s){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[s+0],i[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs,s=this.object.geometry.uvs;s.push(t[e+0],t[e+1])},addFace:function(e,t,s,i,r,a,n,o,h){const c=this.vertices.length;let l=this.parseVertexIndex(e,c),p=this.parseVertexIndex(t,c),d=this.parseVertexIndex(s,c);if(this.addVertex(l,p,d),this.addColor(l,p,d),void 0!==n&&""!==n){const e=this.normals.length;l=this.parseNormalIndex(n,e),p=this.parseNormalIndex(o,e),d=this.parseNormalIndex(h,e),this.addNormal(l,p,d)}else this.addFaceNormal(l,p,d);if(void 0!==i&&""!==i){const e=this.uvs.length;l=this.parseUVIndex(i,e),p=this.parseUVIndex(r,e),d=this.parseUVIndex(a,e),this.addUV(l,p,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let s=0,i=e.length;s<i;s++){const i=this.parseVertexIndex(e[s],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const s=this.vertices.length,i=this.uvs.length;for(let r=0,a=e.length;r<a;r++)this.addVertexLine(this.parseVertexIndex(e[r],s));for(let r=0,a=t.length;r<a;r++)this.addUVLine(this.parseUVIndex(t[r],i))}};return e.startObject("",!1),e}class re extends i["J"]{constructor(e){super(e),this.materials=null}load(e,t,s,r){const a=this,n=new i["u"](this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,(function(s){try{t(a.parse(s))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),s,r)}setMaterials(e){return this.materials=e,this}parse(e){const t=new ie;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const s=e.split("\n");let r="",a="",n=0,o=[];const h="function"===typeof"".trimLeft;for(let i=0,p=s.length;i<p;i++)if(r=s[i],r=h?r.trimLeft():r.trim(),n=r.length,0!==n&&(a=r.charAt(0),"#"!==a))if("v"===a){const e=r.split(/\s+/);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?t.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]));break}}else if("f"===a){const e=r.substr(1).trim(),s=e.split(/\s+/),i=[];for(let t=0,r=s.length;t<r;t++){const e=s[t];if(e.length>0){const t=e.split("/");i.push(t)}}const a=i[0];for(let r=1,n=i.length-1;r<n;r++){const e=i[r],s=i[r+1];t.addFace(a[0],e[0],s[0],a[1],e[1],s[1],a[2],e[2],s[2])}}else if("l"===a){const e=r.substring(1).trim().split(" ");let s=[];const i=[];if(-1===r.indexOf("/"))s=e;else for(let t=0,r=e.length;t<r;t++){const r=e[t].split("/");""!==r[0]&&s.push(r[0]),""!==r[1]&&i.push(r[1])}t.addLineGeometry(s,i)}else if("p"===a){const e=r.substr(1).trim(),s=e.split(" ");t.addPointGeometry(s)}else if(null!==(o=X.exec(r))){const e=(" "+o[0].substr(1).trim()).substr(1);t.startObject(e)}else if(Z.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(Y.test(r))t.materialLibraries.push(r.substring(7).trim());else if(K.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===a){if(o=r.split(" "),o.length>1){const e=o[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===r)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}t.finalize();const c=new i["A"];c.materialLibraries=[].concat(t.materialLibraries);const l=!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length);if(!0===l)for(let p=0,d=t.objects.length;p<d;p++){const e=t.objects[p],s=e.geometry,r=e.materials,a="Line"===s.type,n="Points"===s.type;let o=!1;if(0===s.vertices.length)continue;const h=new i["e"];h.setAttribute("position",new i["v"](s.vertices,3)),s.normals.length>0&&h.setAttribute("normal",new i["v"](s.normals,3)),s.colors.length>0&&(o=!0,h.setAttribute("color",new i["v"](s.colors,3))),!0===s.hasUVIndices&&h.setAttribute("uv",new i["v"](s.uvs,2));const l=[];for(let c=0,p=r.length;c<p;c++){const e=r[c],s=e.name+"_"+e.smooth+"_"+o;let h=t.materials[s];if(null!==this.materials)if(h=this.materials.create(e.name),!a||!h||h instanceof i["E"]){if(n&&h&&!(h instanceof i["hb"])){const e=new i["hb"]({size:10,sizeAttenuation:!1});i["M"].prototype.copy.call(e,h),e.color.copy(h.color),e.map=h.map,h=e}}else{const e=new i["E"];i["M"].prototype.copy.call(e,h),e.color.copy(h.color),h=e}void 0===h&&(h=a?new i["E"]:n?new i["hb"]({size:1,sizeAttenuation:!1}):new i["R"],h.name=e.name,h.flatShading=!e.smooth,h.vertexColors=o,t.materials[s]=h),l.push(h)}let d;if(l.length>1){for(let e=0,t=r.length;e<t;e++){const t=r[e];h.addGroup(t.groupStart,t.groupCount,e)}d=a?new i["F"](h,l):n?new i["gb"](h,l):new i["O"](h,l)}else d=a?new i["F"](h,l[0]):n?new i["gb"](h,l[0]):new i["O"](h,l[0]);d.name=e.name,c.add(d)}else if(t.vertices.length>0){const e=new i["hb"]({size:1,sizeAttenuation:!1}),s=new i["e"];s.setAttribute("position",new i["v"](t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(s.setAttribute("color",new i["v"](t.colors,3)),e.vertexColors=!0);const r=new i["gb"](s,e);c.add(r)}return c}}class ae extends i["J"]{constructor(e){super(e)}load(e,t,s,r){const a=this,n=""===this.path?i["K"].extractUrlBase(e):this.path,o=new i["u"](this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(s){try{t(a.parse(s,n))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),s,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const s=e.split("\n");let i={};const r=/\s+/,a={};for(let o=0;o<s.length;o++){let e=s[o];if(e=e.trim(),0===e.length||"#"===e.charAt(0))continue;const t=e.indexOf(" ");let n=t>=0?e.substring(0,t):e;n=n.toLowerCase();let h=t>=0?e.substring(t+1):"";if(h=h.trim(),"newmtl"===n)i={name:h},a[h]=i;else if("ka"===n||"kd"===n||"ks"===n||"ke"===n){const e=h.split(r,3);i[n]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[n]=h}const n=new ne(this.resourcePath||t,this.materialOptions);return n.setCrossOrigin(this.crossOrigin),n.setManager(this.manager),n.setMaterials(a),n}}class ne{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:i["y"],this.wrap=void 0!==this.options.wrap?this.options.wrap:i["lb"]}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const s in e){const i=e[s],r={};t[s]=r;for(const e in i){let t=!0,s=i[e];const a=e.toLowerCase();switch(a){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(t=!1);break}t&&(r[a]=s)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,s=this.materialsInfo[e],r={name:e,side:this.side};function a(e,t){return"string"!==typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}function n(e,s){if(r[e])return;const i=t.getTextureParams(s,r),n=t.loadTexture(a(t.baseUrl,i.url));n.repeat.copy(i.scale),n.offset.copy(i.offset),n.wrapS=t.wrap,n.wrapT=t.wrap,r[e]=n}for(const o in s){const e=s[o];let t;if(""!==e)switch(o.toLowerCase()){case"kd":r.color=(new i["k"]).fromArray(e);break;case"ks":r.specular=(new i["k"]).fromArray(e);break;case"ke":r.emissive=(new i["k"]).fromArray(e);break;case"map_kd":n("map",e);break;case"map_ks":n("specularMap",e);break;case"map_ke":n("emissiveMap",e);break;case"norm":n("normalMap",e);break;case"map_bump":case"bump":n("bumpMap",e);break;case"map_d":n("alphaMap",e),r.transparent=!0;break;case"ns":r.shininess=parseFloat(e);break;case"d":t=parseFloat(e),t<1&&(r.opacity=t,r.transparent=!0);break;case"tr":t=parseFloat(e),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(r.opacity=1-t,r.transparent=!0);break}}return this.materials[e]=new i["R"](r),this.materials[e]}getTextureParams(e,t){const s={scale:new i["Cb"](1,1),offset:new i["Cb"](0,0)},r=e.split(/\s+/);let a;return a=r.indexOf("-bm"),a>=0&&(t.bumpScale=parseFloat(r[a+1]),r.splice(a,2)),a=r.indexOf("-s"),a>=0&&(s.scale.set(parseFloat(r[a+1]),parseFloat(r[a+2])),r.splice(a,4)),a=r.indexOf("-o"),a>=0&&(s.offset.set(parseFloat(r[a+1]),parseFloat(r[a+2])),r.splice(a,4)),s.url=r.join(" ").trim(),s}loadTexture(e,t,s,r,a){const n=void 0!==this.manager?this.manager:i["n"];let o=n.getHandler(e);null===o&&(o=new i["yb"](n)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const h=o.load(e,s,r,a);return void 0!==t&&(h.mapping=t),h}}var oe;(function(e){e["LOADING"]="loading",e["DETAILLOADING"]="detailLoading",e["DETAILLOADED"]="detailLoaded",e["LOADED"]="loaded"})(oe||(oe={}));class he extends d{constructor(e){super(),p(this,"resourceMap"),p(this,"loaderMap"),p(this,"loadTotal"),p(this,"loadSuccess"),p(this,"loadError"),p(this,"isError"),p(this,"isLoading"),p(this,"isLoaded"),p(this,"loadDetailMap"),this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const t=new i["B"];this.loaderMap={jpg:t,png:t,jpeg:t,obj:new re,mtl:new ae},e&&(this.loaderMap=Object.assign(this.loaderMap,e.loaderExtends))}loaded(){return this.dispatchEvent({type:oe.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}load(e){var t;if(this.reset(),this.isLoading=!0,e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const s=this.resourceMap,i=this.loaderMap,r=this.loadDetailMap;for(let a of e){const e={url:a,progress:0,error:!1,message:a};if(r[a]=e,s.has(a)){e.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:oe.DETAILLOADED,detail:e}),this.dispatchEvent({type:oe.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}const n=null==(t=a.split(".").pop())?void 0:t.toLocaleLowerCase();if(!n){e.message=`url: ${a} 地址有误，无法获取文件格式。`,console.warn(e.message),e.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:oe.DETAILLOADED,detail:e}),this.dispatchEvent({type:oe.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError});continue}const o=i[n];o?o.loadAsync(a,t=>{e.progress=Number((t.loaded/t.total).toFixed(2)),this.dispatchEvent({type:oe.DETAILLOADING,detail:e})}).then(t=>{e.progress=1,this.loadSuccess+=1,this.resourceMap.set(a,t),this.dispatchEvent({type:oe.DETAILLOADED,detail:e}),this.dispatchEvent({type:oe.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(t=>{e.error=!0,e.message=JSON.stringify(t),this.loadError+=1,this.dispatchEvent({type:oe.DETAILLOADED,detail:e}),this.dispatchEvent({type:oe.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}):(e.message=`url: ${a} 不支持此文件格式加载。`,console.warn(e.message),e.error=!0,this.isError=!0,this.loadError+=1,this.dispatchEvent({type:oe.DETAILLOADED,detail:e}),this.dispatchEvent({type:oe.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}))}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}toJSON(){const e=[];return this.resourceMap.forEach((t,s)=>{e.push(s)}),JSON.stringify(e)}dispose(){return this.resourceMap.clear(),this}}const ce=function(e){if(this.loaderManager)return console.warn("engine has installed loaderManager plugin."),!1;const t=new he(e);return this.loaderManager=t,this.loadResources=(e,t)=>{const s=e=>{t(void 0,e),this.loaderManager.removeEventListener("loaded",s)};try{this.loaderManager.addEventListener("loaded",s)}catch(i){t(i)}return this.loaderManager.load(e),this},this.loadResourcesAsync=e=>new Promise((t,s)=>{const i=e=>{t(e),this.loaderManager.removeEventListener("loaded",i)};try{this.loaderManager.addEventListener("loaded",i)}catch(r){s(r)}this.loaderManager.load(e)}),!0};var le,pe;(function(e){e["BOXGEOMETRY"]="BoxGeometry",e["SPHEREGEOMETRY"]="SphereGeometry",e["LOADGEOMETRY"]="LoadGeometry",e["MODEL"]="Model",e["MESH"]="Mesh",e["LINE"]="Line",e["LINESEGMENTS"]="LineSegments",e["POINTS"]="Points",e["SPRITE"]="Sprite",e["IMAGETEXTURE"]="ImageTexture",e["CUBETEXTURE"]="CubeTexture",e["CANVASTEXTURE"]="CanvasTexture",e["MESHSTANDARDMATERIAL"]="MeshStandardMaterial",e["MESHPHONGMATERIAL"]="MeshPhongMaterial",e["SPRITEMATERIAL"]="SpriteMaterial",e["LINEBASICMATERIAL"]="LineBasicMaterial",e["POINTSMATERIAL"]="PointsMaterial",e["AMBIENTLIGHT"]="AmbientLight",e["SPOTLIGHT"]="SpotLight",e["POINTLIGHT"]="PointLight",e["PERSPECTIVECAMERA"]="PerspectiveCamera",e["ORTHOGRAPHICCAMERA"]="OrthographicCamera",e["WEBGLRENDERER"]="WebGLRenderer",e["SCENE"]="Scene",e["TRNASFORMCONTROLS"]="TransformControls",e["ORBITCONTROLS"]="OrbitControls",e["EVENT"]="Event"})(le||(le={})),function(e){e["CAMERA"]="camera",e["LIGHT"]="light",e["GEOMETRY"]="geometry",e["TEXTURE"]="texture",e["MATERIAL"]="material",e["RENDERER"]="renderer",e["SCENE"]="scene",e["SPRITE"]="sprite",e["CONTROLS"]="controls",e["EVENT"]="event",e["LINE"]="line",e["MESH"]="mesh",e["POINTS"]="points"}(pe||(pe={}));const de=()=>({vid:"",type:"Object3D",castShadow:!0,receiveShadow:!0,lookAt:"",visible:!0,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}),ue=function(){return Object.assign(de(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},me=function(){return Object.assign(de(),{type:le.AMBIENTLIGHT,color:"rgb(255, 255, 255)",intensity:1})},ge=function(){return Object.assign(ue(),{type:le.POINTLIGHT,distance:30,decay:.01})},fe=function(){return Object.assign(ue(),{type:le.SPOTLIGHT,distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},Me=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},Ee=function(){return Object.assign(Me(),{type:"BoxGeometry",width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},be=function(){return Object.assign(Me(),{type:"SphereGeometry",radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI})},ye=function(){return Object.assign(Me(),{type:"LoadGeometry",url:""})},we=function(){return{vid:"",type:"Texture",name:"",mapping:i["Ab"],wrapS:i["i"],wrapT:i["i"],magFilter:i["H"],minFilter:i["I"],anisotropy:1,format:i["jb"],offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:i["G"],needsUpdate:!1}},ve=function(){return Object.assign(we(),{type:"ImageTexture",url:""})},Ce=function(){return Object.assign(we(),{type:"CubeTexture",cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""}})},Se=function(){return Object.assign(we(),{type:"CanvasTexture",url:"",needsUpdate:!1})},Le=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,format:i["jb"],fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:i["y"],toneMapped:!0,transparent:!1,visible:!0}},Ae=function(){return Object.assign(Le(),{type:le.MESHSTANDARDMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:i["wb"],refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},Re=function(){return Object.assign(Le(),{type:le.MESHPHONGMATERIAL,aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:i["wb"],refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:i["U"],normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},Te=function(){return Object.assign(Le(),{type:le.SPRITEMATERIAL,color:"rgb(255, 255, 255)",rotation:0,map:"",alphaMap:"",sizeAttenuation:!0})},Oe=function(){return Object.assign(Le(),{type:le.LINEBASICMATERIAL,color:"rgb(255, 255, 255)",linecap:"round",linejoin:"round",linewidth:1})},xe=function(){return Object.assign(Le(),{type:le.POINTSMATERIAL,map:"",alphaMap:"",color:"rgb(255, 255, 255)",sizeAttenuation:!0,size:1})},De=function(){return Object.assign(de(),{type:le.PERSPECTIVECAMERA,adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},je=function(){return Object.assign(de(),{type:le.ORTHOGRAPHICCAMERA,adaptiveWindow:!1,left:120,right:120,top:67.5,bottom:67.5,near:5,far:50})},Ie=function(){return{vid:"WebGLRenderer",type:"WebGLRenderer",clearColor:"rgba(0, 0, 0, 0)",outputEncoding:i["G"],physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,type:i["ab"]},toneMapping:i["V"],toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null,size:null}},Pe=function(){return{vid:"Scene",type:"Scene",background:"",environment:"",fog:null}},Ge=function(){return{vid:"TransformControls",type:"TransformControls",axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},Ne=function(){return{vid:"OrbitControls",type:"OrbitControls",autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05}},ke=function(){return Object.assign(de(),{type:"Sprite",material:"",center:{x:.5,y:.5}})},He=function(){return{vid:"",type:"Event",pointerdown:[],pointermove:[],pointerup:[],pointerenter:[],pointerleave:[],click:[]}},ze=function(){return Object.assign(de(),{type:le.MESH,geometry:"",material:""})},Ve=function(){return Object.assign(de(),{type:le.POINTS,geometry:"",material:""})},Fe=function(){return Object.assign(de(),{type:le.LINE,geometry:"",material:""})};function Ue(e,t){return e in t}function Be(){return{[le.IMAGETEXTURE]:pe.TEXTURE,[le.CUBETEXTURE]:pe.TEXTURE,[le.CANVASTEXTURE]:pe.TEXTURE,[le.MESHSTANDARDMATERIAL]:pe.MATERIAL,[le.MESHPHONGMATERIAL]:pe.MATERIAL,[le.SPRITEMATERIAL]:pe.MATERIAL,[le.LINEBASICMATERIAL]:pe.MATERIAL,[le.POINTSMATERIAL]:pe.MATERIAL,[le.AMBIENTLIGHT]:pe.LIGHT,[le.SPOTLIGHT]:pe.LIGHT,[le.POINTLIGHT]:pe.LIGHT,[le.BOXGEOMETRY]:pe.GEOMETRY,[le.SPHEREGEOMETRY]:pe.GEOMETRY,[le.LOADGEOMETRY]:pe.GEOMETRY,[le.SPRITE]:pe.SPRITE,[le.LINE]:pe.LINE,[le.MESH]:pe.MESH,[le.POINTS]:pe.POINTS,[le.PERSPECTIVECAMERA]:pe.CAMERA,[le.ORTHOGRAPHICCAMERA]:pe.CAMERA,[le.WEBGLRENDERER]:pe.RENDERER,[le.SCENE]:pe.SCENE,[le.TRNASFORMCONTROLS]:pe.CONTROLS,[le.EVENT]:pe.EVENT}}function We(){return{[le.IMAGETEXTURE]:ve,[le.CUBETEXTURE]:Ce,[le.CANVASTEXTURE]:Se,[le.MESHSTANDARDMATERIAL]:Ae,[le.MESHPHONGMATERIAL]:Re,[le.SPRITEMATERIAL]:Te,[le.LINEBASICMATERIAL]:Oe,[le.POINTSMATERIAL]:xe,[le.AMBIENTLIGHT]:me,[le.SPOTLIGHT]:fe,[le.POINTLIGHT]:ge,[le.BOXGEOMETRY]:Ee,[le.SPHEREGEOMETRY]:be,[le.LOADGEOMETRY]:ye,[le.SPRITE]:ke,[le.LINE]:Fe,[le.MESH]:ze,[le.POINTS]:Ve,[le.PERSPECTIVECAMERA]:De,[le.ORTHOGRAPHICCAMERA]:je,[le.WEBGLRENDERER]:Ie,[le.SCENE]:Pe,[le.TRNASFORMCONTROLS]:Ge,[le.ORBITCONTROLS]:Ne,[le.EVENT]:He}}var $e,_e=new Uint8Array(16);function Je(){if(!$e&&($e="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!$e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $e(_e)}var Xe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ye(e){return"string"===typeof e&&Xe.test(e)}for(var Ze=[],Ke=0;Ke<256;++Ke)Ze.push((Ke+256).toString(16).substr(1));function qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(Ze[e[t+0]]+Ze[e[t+1]]+Ze[e[t+2]]+Ze[e[t+3]]+"-"+Ze[e[t+4]]+Ze[e[t+5]]+"-"+Ze[e[t+6]]+Ze[e[t+7]]+"-"+Ze[e[t+8]]+Ze[e[t+9]]+"-"+Ze[e[t+10]]+Ze[e[t+11]]+Ze[e[t+12]]+Ze[e[t+13]]+Ze[e[t+14]]+Ze[e[t+15]]).toLowerCase();if(!Ye(s))throw TypeError("Stringified UUID is invalid");return s}function Qe(e,t,s){e=e||{};var i=e.random||(e.rng||Je)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){s=s||0;for(var r=0;r<16;++r)t[s+r]=i[r];return t}return qe(i)}const et=We(),tt=function(e,t,s=!0,i=!0){if(et[e]){const r=(t,a)=>{for(const n in a)void 0!==t[n]?"object"!==typeof a[n]||null===a[n]||Array.isArray(a[n])?t[n]=a[n]:r(t[n],a[n]):(!s&&(t[n]=a[n]),s&&i&&console.warn(`'${e}' config can not set key: ${n}`))},a=et[e]();return""===a.vid&&(a.vid=Qe()),t&&r(a,t),a}return console.error(`type: ${e} can not be found in configList.`),null};var st;(function(e){e["MAPPED"]="mapped"})(st||(st={}));class it extends d{constructor(){super(),p(this,"structureMap",new Map),p(this,"configMap",new Map),p(this,"resourceMap",new Map)}mappingResource(e){const t=this.structureMap,s=this.configMap,r=this.resourceMap,a=function(e,t){const n={type:""+t.type};let o="";if(t.geometry){const a=t.geometry;a.computeBoundingBox();const h=a.boundingBox,c=h.getCenter(new i["Db"]);o=e+".geometry",r.set(o,a),s.set(o,tt(le.LOADGEOMETRY,{url:o,position:{x:c.x/(h.max.x-h.min.x)*2,y:c.y/(h.max.y-h.min.y)*2,z:c.z/(h.max.z-h.min.z)*2}})),n.geometry=o}if(t.material){const i=t.material;i instanceof Array?(n.material=[],i.forEach((t,i,a)=>{o=`${e}.material.${i}`,r.set(o,t),s.set(o,tt(t.type,t,!0,!1)),n.material[i]=o})):(o=e+".material",r.set(o,i),s.set(o,tt(i.type,i,!0,!1)),n.material=o)}return t.children.length&&(n.children=[],t.children.forEach((t,s,i)=>{o=`${e}.children.${s}`,n.children[s]=a(o,t)})),n};return e.forEach((e,n)=>{e instanceof HTMLImageElement?(r.set(n,e),s.set(n,tt(le.IMAGETEXTURE,{url:n})),t.set(n,n)):e instanceof HTMLCanvasElement?(r.set(n,e),t.set(n,n)):e instanceof i["W"]&&t.set(n,a(n,e))}),this.dispatchEvent({type:"mapped",structureMap:t,configMap:s,resourceMap:r}),this}dispose(){}}const rt=function(e){if(this.resourceManager)return console.warn("engine has installed resourceManager plugin."),!1;const t=new it;return this.resourceManager=t,this.loaderManager&&this.loaderManager.addEventListener("loaded",e=>{this.resourceManager.mappingResource(e.resourceMap)}),this.registerResources=e=>{const t=new Map;return Object.keys(e).forEach(s=>{t.set(s,e[s])}),this.resourceManager.mappingResource(t),this},!0},at=class extends d{constructor(){super()}proxyExtends(e,t){if(t||(t=[]),at.proxyWeakSet.has(e)||"object"!==typeof e&&null!==e)return e;const s={get:(e,t)=>Reflect.get(e,t),set:(s,i,r)=>{let a;if(void 0===s[i]){if("object"===typeof r&&null!==r){const e=t.concat([i]);r=this.proxyExtends(r,e)}a=Reflect.set(s,i,r),this.broadcast({operate:"add",path:t.concat([]),key:i,value:r})}else{if("object"===typeof r&&!at.proxyWeakSet.has(e)){const e=t.concat([i]);r=this.proxyExtends(r,e)}a=Reflect.set(s,i,r),this.broadcast({operate:"set",path:t.concat([]),key:i,value:r})}return a},deleteProperty:(e,s)=>{const i=Reflect.deleteProperty(e,s);return this.broadcast({operate:"delete",path:t.concat([]),key:s,value:""}),i}};if("object"===typeof e&&null!==e)for(const i in e){const s=t.concat([i]);Ue(i,e)&&"object"===typeof e[i]&&null!==e[i]&&(e[i]=this.proxyExtends(e[i],s))}return new Proxy(e,s)}broadcast({operate:e,path:t,key:s,value:i}){const r={__poto__:!0,length:!0};return Ue(s,r)&&r[s]||this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:s,value:i}}),this}};let nt=at;p(nt,"proxyWeakSet",new WeakSet);class ot{constructor(){p(this,"rule"),p(this,"memberSet"),this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(s=>{t(e,s)}),this}}class ht{constructor(e,t){p(this,"data"),p(this,"broadcast"),p(this,"translater"),this.translater=(new ot).setRule(e),this.broadcast=new nt,this.data=this.broadcast.proxyExtends(t),this.broadcast.addEventListener("broadcast",e=>{this.translater.translate(e.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(){return JSON.stringify(this.data)}load(e){const t=this.data;for(const s in e)t[s]=e[s];return this}}const ct=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)Ye(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();if(!s||!Ye(s))return void console.warn(`texture rule vid is illeage: '${s}'`);t.set(s,e,i,a)}};class lt extends ht{constructor(e){!e&&(e={}),super(ct,e)}}const pt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)Ye(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();if(!s||!Ye(s))return void console.warn(`material rule vid is illeage: '${s}'`);t.set(s,e,i,a)}};class dt extends ht{constructor(e){!e&&(e={}),super(pt,e)}}const ut=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"!==s)if("set"!==s);else{const e=r.concat([]),s=e.shift();s&&Ye(s)?t.set(s,e,i,a):console.warn(`model rule vid is illeage: '${s}'`)}else Ye(i)&&t.add(i,a)};class mt extends ht{constructor(e){!e&&(e={}),super(ut,e)}}const gt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"!==s)if("set"!==s);else{const e=r.concat([]),s=e.shift();s&&Ye(s)?t.set(s,e,a):console.warn(`geometry rule vid is illeage: '${s}'`)}else Ye(i)&&t.add(i,a)};class ft extends ht{constructor(e){!e&&(e={}),super(gt,e)}}const Mt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)Ye(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();s&&Ye(s)?t.set(s,e,i,a):console.warn(`camera rule vid is illeage: '${s}'`)}};class Et extends ht{constructor(e){!e&&(e={}),super(Mt,e)}}const bt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;"add"!==s?"set"!==s||t.set(r.concat([]),i,a):t.add(i,a)};class yt extends ht{constructor(e){!e&&(e={}),super(bt,e)}}const wt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;"set"===s&&t.set(r.concat([]),i,a)};class vt extends ht{constructor(e){!e&&(e={scene:Pe()}),super(wt,e)}}const Ct=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("set"===s){const e=r.concat([]),s=e.shift();s?t.set(s,e,i,a):console.error("controls rule can not found controls type in set operate.")}};class St extends ht{constructor(e){!e&&(e={}),super(Ct,e)}}const Lt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"!==s){if("set"===s){const e=r.concat([]),s=e.shift();t.set(s,e,i,a)}}else t.add(i,a)};class At extends ht{constructor(e){!e&&(e={}),super(Lt,e)}}const Rt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;"add"!==s||Ye(i)&&t.add(i,a)};class Tt extends ht{constructor(e){!e&&(e={}),super(Rt,e)}}const Ot=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"!==s)if("set"!==s);else{const e=r.concat([]),s=e.shift();s&&Ye(s)?t.set(s,e,i,a):console.warn(`model rule vid is illeage: '${s}'`)}else Ye(i)&&t.add(i,a)};class xt extends ht{constructor(e){!e&&(e={}),super(Ot,e)}}const Dt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"!==s)if("set"!==s);else{const e=r.concat([]),s=e.shift();s&&Ye(s)?t.set(s,e,i,a):console.warn(`model rule vid is illeage: '${s}'`)}else Ye(i)&&t.add(i,a)};class jt extends ht{constructor(e){!e&&(e={}),super(Dt,e)}}const It=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"!==s)if("set"!==s);else{const e=r.concat([]),s=e.shift();s&&Ye(s)?t.set(s,e,i,a):console.warn(`model rule vid is illeage: '${s}'`)}else Ye(i)&&t.add(i,a)};class Pt extends ht{constructor(e){!e&&(e={}),super(It,e)}}class Gt{constructor(e){p(this,"cameraDataSupport"),p(this,"lightDataSupport"),p(this,"geometryDataSupport"),p(this,"textureDataSupport"),p(this,"materialDataSupport"),p(this,"rendererDataSupport"),p(this,"sceneDataSupport"),p(this,"controlsDataSupport"),p(this,"spriteDataSupport"),p(this,"eventDataSupport"),p(this,"lineDataSupport"),p(this,"meshDataSupport"),p(this,"pointsDataSupport"),p(this,"dataSupportMap"),this.cameraDataSupport=new Et,this.lightDataSupport=new mt,this.geometryDataSupport=new ft,this.textureDataSupport=new lt,this.materialDataSupport=new dt,this.rendererDataSupport=new yt,this.sceneDataSupport=new vt,this.controlsDataSupport=new St,this.spriteDataSupport=new At,this.eventDataSupport=new Tt,this.lineDataSupport=new xt,this.meshDataSupport=new jt,this.pointsDataSupport=new Pt,e&&Object.keys(e).forEach(t=>{void 0!==this[t]&&(this[t]=e[t])});const t=new Map;for(let s in pe)t.set(pe[s],this[pe[s]+"DataSupport"]);this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn("can not found this type in dataSupportManager: "+e),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn("can not found this type in dataSupportManager: "+e),null)}setSupportData(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(t):console.warn("can not found this type in dataSupportManager: "+e),this}load(e){const t=this.dataSupportMap;return t.forEach((t,s)=>{e[s]&&t.load(e[s])}),this}toJSON(e){const t=e||{},s=this.dataSupportMap;return s.forEach((e,s)=>{t[s]=e.getData()}),JSON.stringify(t)}}const Nt=function(e){if(this.dataSupportManager)return console.warn("engine has installed dataSupportManager plugin."),!1;const t=new Gt(e);return this.dataSupportManager=t,this.toJSON=function(){if(this.loaderManager){const e={assets:JSON.parse(this.loaderManager.toJSON())};return this.dataSupportManager.toJSON(e)}return this.dataSupportManager.toJSON()},this.completeSet.add(()=>{const e=this.dataSupportManager.getDataSupport(pe.RENDERER).getData();e.WebGLRenderer||(e.WebGLRenderer=tt(le.WEBGLRENDERER));const t=this.dataSupportManager.getDataSupport(pe.SCENE).getData();t.scene||(t.scene=tt(le.SCENE));const s=this.dataSupportManager.getDataSupport(pe.CONTROLS).getData();this.transformControls&&(s[le.TRNASFORMCONTROLS]||(s[le.TRNASFORMCONTROLS]=tt(le.TRNASFORMCONTROLS))),this.orbitControls&&(s[le.ORBITCONTROLS]||(s[le.ORBITCONTROLS]=tt(le.ORBITCONTROLS)))}),!0};class kt{static applyConfig(e,t,s={},i){const r=Object.assign({vid:!0,type:!0},s),a=(e,t)=>{for(const s in e)r[s]||("object"===typeof e[s]&&null!==typeof e[s]&&Ue(s,t)?a(e[s],t[s]):Ue(s,t)&&(t[s]=e[s]))};a(e,t),i&&i()}constructor(){}}class Ht extends kt{constructor(e){super(),p(this,"IS_OBJECTCOMPILER",!0),p(this,"scene"),p(this,"target"),p(this,"map"),p(this,"weakMap"),p(this,"cacheObjectMap"),p(this,"geometryMap"),p(this,"materialMap"),p(this,"objectMapSet"),e?(e.scene&&(this.scene=e.scene),e.target&&(this.target=e.target)):(this.scene=new i["mb"],this.target={}),this.geometryMap=new Map,this.materialMap=new Map,this.map=new Map,this.weakMap=new WeakMap,this.objectMapSet=new Set,this.cacheObjectMap=new WeakMap}getMaterial(e){return Ye(e)?this.materialMap.has(e)?this.materialMap.get(e):(console.warn(`${this.COMPILER_NAME}Compiler: can not found material which vid: ${e}`),this.getReplaceMaterial()):(console.warn(`${this.COMPILER_NAME}Compiler: material vid parameter is illegal: ${e}`),this.getReplaceMaterial())}getGeometry(e){return Ye(e)?this.geometryMap.has(e)?this.geometryMap.get(e):(console.warn(`${this.COMPILER_NAME}Compiler: can not found geometry which vid: ${e}`),this.getReplaceGeometry()):(console.warn(`${this.COMPILER_NAME}Compiler: geometry vid parameter is illegal: ${e}`),this.getReplaceGeometry())}getObject(e){for(const t of this.objectMapSet)if(t.has(e))return t.get(e);return null}setLookAt(e,t){if(e===t)return console.error("can not set object lookAt itself."),this;if(!this.map.has(e))return console.error(`${this.COMPILER_NAME}Compiler: can not found object which vid: ${e}.`),this;const s=this.map.get(e);let i=this.cacheObjectMap.get(s);if(i||(i={lookAtTarget:null,updateMatrixWorldFun:null},this.cacheObjectMap.set(s,i)),!t)return i.updateMatrixWorldFun?(s.updateMatrixWorld=i.updateMatrixWorldFun,i.lookAtTarget=null,i.updateMatrixWorldFun=null,this):this;let r=this.getObject(t);if(!r)return console.warn(`${this.COMPILER_NAME}Compiler: can not found this vid mapping object: '${e}'`),this;const a=s.updateMatrixWorld;return i.updateMatrixWorldFun=a,i.lookAtTarget=r.position,s.updateMatrixWorld=e=>{a.bind(s)(e),s.lookAt(i.lookAtTarget)},this}linkGeometryMap(e){return this.geometryMap=e,this}linkMaterialMap(e){return this.materialMap=e,this}linkObjectMap(...e){for(let t of e)this.objectMapSet.has(t)||this.objectMapSet.add(t);return this}setScene(e){return this.scene=e,this}setTarget(e){return this.target=e,this}getMap(){return this.map}getObjectSymbol(e){return this.weakMap.has(e)?this.weakMap.get(e):null}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}remove(e){return this.map.has(e)?(this.weakMap.delete(this.map.get(e)),this.cacheObjectMap.delete(this.map.get(e)),this.map.delete(e),this):(console.warn(`${this.COMPILER_NAME}Compiler: can not found object which vid: ${e}.`),this)}dispose(){return this.map.clear(),this}}class zt extends Ht{constructor(e){super(e),p(this,"COMPILER_NAME",pe.CAMERA),p(this,"engine"),p(this,"constructMap"),p(this,"filterAttribute"),p(this,"cacheCameraMap"),p(this,"replaceMaterial",new i["M"]),p(this,"replaceGeometry",new i["e"]),e?e.engine&&(this.engine=e.engine):this.engine=(new os).install(rs.WEBGLRENDERER);const t=new Map;t.set("PerspectiveCamera",()=>new i["cb"]),t.set("OrthographicCamera",()=>new i["Z"](0,0,0,0)),this.constructMap=t,this.filterAttribute={scale:!0},this.cacheCameraMap=new WeakMap}getReplaceMaterial(){return console.warn("CameraCompiler: can not use material in CameraCompiler."),this.replaceMaterial}getReplaceGeometry(){return console.warn("CameraCompiler: can not use geometry in CameraCompiler."),this.replaceGeometry}setAdaptiveWindow(e,t){if(!this.map.has(e))return console.warn(`camera compiler can not found this vid camera: '${e}'`),this;const s=this.map.get(e);let r=this.cacheCameraMap.get(s);if(r||(r={},this.cacheCameraMap.set(s,r)),!t){if(r.setSizeFun&&this.engine.hasEventListener("setSize",r.setSizeFun))return this.engine.removeEventListener("setSize",r.setSizeFun),r.setSizeFun=void 0,this;if(r.setSizeFun&&!this.engine.hasEventListener("setSize",r.setSizeFun))return r.setSizeFun=void 0,this}if(t){if(r.setSizeFun&&this.engine.hasEventListener("setSize",r.setSizeFun))return this;if(r.setSizeFun&&!this.engine.hasEventListener("setSize",r.setSizeFun))return this.engine.addEventListener("setSize",r.setSizeFun),this;let e=e=>{};s instanceof i["cb"]?e=e=>{s.aspect=e.width/e.height,s.updateProjectionMatrix()}:s instanceof i["Z"]?e=e=>{const t=e.width,i=e.height;s.left=-t/16,s.right=t/16,s.top=i/16,s.bottom=-i/16}:console.warn("camera compiler can not support this class camera:",s),this.engine.addEventListener("setSize",e),r.setSizeFun=e;const t=this.engine.webGLRenderer.domElement;e({type:"setSize",width:t.offsetWidth,height:t.offsetHeight})}return this}add(e,t){if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)();kt.applyConfig(t,s,Object.assign({lookAt:!0,adaptiveWindow:!0},this.filterAttribute)),(s instanceof i["cb"]||s instanceof i["Z"])&&s.updateProjectionMatrix(),this.map.set(e,s),this.weakMap.set(s,e),this.setLookAt(t.vid,t.lookAt),this.setAdaptiveWindow(t.vid,t.adaptiveWindow),this.scene.add(s)}else console.warn("CameraCompiler: can not support this config type: "+t.type);return this}set(e,t,s,r){if(!this.map.has(e))return console.warn(`geometry compiler set function can not found vid geometry: '${e}'`),this;if(this.filterAttribute[s])return this;if("lookAt"===s)return this.setLookAt(e,r);if("adaptiveWindow"===s)return this.setAdaptiveWindow(e,r);let a=this.map.get(e);for(let i of t){if(this.filterAttribute[i])return this;a=a[i]}return a[s]=r,(a instanceof i["cb"]||a instanceof i["Z"])&&a.updateProjectionMatrix(),this}setEngine(e){return this.engine=e,this}dispose(){return super.dispose(),this.replaceGeometry.dispose(),this.replaceMaterial.dispose(),this}}class Vt extends kt{constructor(e){super(),p(this,"target"),p(this,"transformControls"),e?(e.target&&(this.target=e.target),e.transformControls&&(this.transformControls=e.transformControls)):(this.target={TransformControls:Ge()},this.transformControls=new h["a"](new i["f"]))}set(e,t,s,i){if("TransformControls"!==e)return console.warn(`controls compiler can not support this controls: '${e}'`),this;{const e=this.transformControls;if("snapAllow"===s){const t=this.target["TransformControls"];return i?(e.translationSnap=t.translationSnap,e.rotationSnap=t.rotationSnap,e.scaleSnap=t.scaleSnap):(e.translationSnap=null,e.rotationSnap=null,e.scaleSnap=null),this}e[s]=i}return this}setTarget(e){return this.target=e,this}compileAll(){return this}dispose(e){return this}}class Ft extends kt{constructor(e){super(),p(this,"target"),this.target=e?e.target:{}}add(e,t){return this}remove(){return this}setTarget(e){return this.target=e,this}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}}class Ut extends i["e"]{constructor(e){super(),p(this,"type","LoadBufferGeometry"),e&&this.copy(e)}}const Bt=class extends kt{constructor(e){super(),p(this,"target"),p(this,"map"),p(this,"constructMap"),p(this,"resourceMap"),p(this,"replaceGeometry"),this.target=e.target,this.map=new Map;const t=new Map;t.set("BoxGeometry",e=>Bt.transfromAnchor(new i["c"](e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments),e)),t.set("SphereGeometry",e=>Bt.transfromAnchor(new i["pb"](e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength),e)),t.set("LoadGeometry",e=>Bt.transfromAnchor(new Ut(this.getRescource(e.url)),e)),this.constructMap=t,this.resourceMap=new Map,this.replaceGeometry=new i["c"](10,10,10)}linkRescourceMap(e){return this.resourceMap=e,this}getRescource(e){if(!this.resourceMap.has(e))return console.error("rescoure can not found url: "+e),this.replaceGeometry.clone();if(this.resourceMap.has(e)&&this.resourceMap.get(e)instanceof i["e"]){const t=this.resourceMap.get(e);return t.clone()}return console.error("url mapping rescource is not class with BufferGeometry: "+e),this.replaceGeometry.clone()}getMap(){return this.map}setTarget(){return this}add(e,t){if(Ye(e)){if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)(t);this.map.set(e,s)}}else console.error("geometry vid parameter is illegal: "+e);return this}set(e,t,s){if(!Ye(e))return console.warn(`geometry compiler set function vid parameters is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`geometry compiler set function can not found vid geometry: '${e}'`),this;const i=this.map.get(e),r=this.target[e],a=this.constructMap.get(r.type)(r);return i.copy(a),i.uuid=a.uuid,a.dispose(),this}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this.map.forEach((e,t)=>{e.dispose()}),this}};let Wt=Bt;p(Wt,"transfromAnchor",(function(e,t){e.center(),!e.boundingBox&&e.computeBoundingBox();const s=e.boundingBox,r=t.position,a=t.rotation,n=t.scale,o=new i["N"],h=new i["Db"]((s.max.x-s.min.x)/2*r.x,(s.max.y-s.min.y)/2*r.y,(s.max.z-s.min.z)/2*r.z),c=(new i["ib"]).setFromEuler(new i["s"](a.x,a.y,a.z,"XYZ")),l=new i["Db"](n.x,n.y,n.z);return o.compose(h,c,l),e.applyMatrix4(o),e}));class $t extends Ht{constructor(e){super(e),p(this,"COMPILER_NAME",pe.LIGHT),p(this,"constructMap"),p(this,"filterAttribute"),p(this,"replaceMaterial",new i["M"]),p(this,"replaceGeometry",new i["e"]),this.constructMap=new Map,this.constructMap.set("PointLight",()=>new i["fb"]),this.constructMap.set("SpotLight",()=>new i["sb"]),this.constructMap.set("AmbientLight",()=>new i["a"]),this.setLookAt=function(e,t){return this},this.filterAttribute={scale:!0,rotation:!0,lookAt:!0}}getReplaceMaterial(){return console.warn("LightCompiler: can not use material in LightCompiler."),this.replaceMaterial}getReplaceGeometry(){return console.warn("LightCompiler: can not use geometry in LightCompiler."),this.replaceGeometry}add(e,t){if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)();kt.applyConfig(t,s,this.filterAttribute),s.color=new i["k"](t.color),this.map.set(e,s),this.weakMap.set(s,e),this.scene.add(s)}else console.warn(`LightCompiler: can not support Light type: ${t.type}.`);return this}set(e,t,s,i){if(!this.map.has(e))return console.warn(`LightCompiler: can not found this vid mapping object: '${e}'`),this;if(this.filterAttribute[s])return this;let r=this.map.get(e);for(let a of t){if(this.filterAttribute[a])return this;r=r[a]}return r[s]=i,this}dispose(){return super.dispose(),this.replaceGeometry.dispose(),this.replaceMaterial.dispose(),this}}class _t extends Ht{constructor(e){super(e),p(this,"replaceMaterial",new i["E"]({color:"rgb(150, 150, 150)"})),p(this,"replaceGeometry",new i["c"](10,10,10))}getReplaceMaterial(){return this.replaceMaterial}getReplaceGeometry(){return this.replaceGeometry}add(e,t){const s=new i["D"](this.getGeometry(t.geometry),this.getMaterial(t.material));return kt.applyConfig(t,s,{geometry:!0,material:!0,lookAt:!0}),this.map.set(e,s),this.weakMap.set(s,e),this.setLookAt(e,t.lookAt),this.scene.add(s),this}set(e,t,s,i){if(!this.map.has(e))return console.warn(`model compiler can not found this vid mapping object: '${e}'`),this;let r=this.map.get(e);if("lookAt"===s)return this.setLookAt(e,i);if("material"===s)return r.material=this.getMaterial(i),this;for(let a of t)r=r[a];return r[s]=i,this}dispose(){return super.dispose(),this.replaceGeometry.dispose(),this.replaceMaterial.dispose(),this}}class Jt extends kt{constructor(e){super(),p(this,"target"),p(this,"map"),p(this,"constructMap"),p(this,"mapAttribute"),p(this,"colorAttribute"),p(this,"texturelMap"),p(this,"resourceMap"),p(this,"cachaColor"),e?e.target&&(this.target=e.target):this.target={},this.map=new Map,this.texturelMap=new Map,this.resourceMap=new Map,this.cachaColor=new i["k"];const t=new Map;t.set(le.MESHSTANDARDMATERIAL,()=>new i["S"]),t.set(le.MESHPHONGMATERIAL,()=>new i["R"]),t.set(le.SPRITEMATERIAL,()=>new i["ub"]),t.set(le.LINEBASICMATERIAL,()=>new i["E"]),t.set(le.POINTSMATERIAL,()=>new i["hb"]),this.constructMap=t,this.colorAttribute={color:!0,emissive:!0},this.mapAttribute={roughnessMap:!0,normalMap:!0,metalnessMap:!0,map:!0,lightMap:!0,envMap:!0,emissiveMap:!0,displacementMap:!0,bumpMap:!0,alphaMap:!0,aoMap:!0,specularMap:!0}}getTexture(e){if(this.texturelMap.has(e)){const t=this.texturelMap.get(e);return t instanceof i["xb"]?t:(console.error("this object which mapped by vid is not instance of Texture: "+e),null)}return console.error("texture map can not found this vid: "+e),null}linkRescourceMap(e){return this.resourceMap=e,this}linkTextureMap(e){return this.texturelMap=e,this}add(e,t){if(Ye(e))if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)(),r=JSON.parse(JSON.stringify(t)),a={},n=this.colorAttribute;for(const e in n)r[e]&&(s[e]=new i["k"](r[e]),a[e]=!0);const o=this.mapAttribute;for(const e in o)r[e]&&(s[e]=this.getTexture(r[e]),a[e]=!0);kt.applyConfig(t,s,a),s.needsUpdate=!0,this.map.set(e,s)}else console.warn("material compiler can not support this type: "+t.type);else console.error("material vid parameter is illegal: "+e);return this}set(e,t,s,r){if(!Ye(e))return console.warn(`material compiler set function: vid is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`material compiler set function: can not found material which vid is: '${e}'`),this;const a=this.map.get(e);if(this.colorAttribute[s])return a[s]=new i["k"](r),this;if(this.mapAttribute[s])return a[s]=this.getTexture(r),a.needsUpdate=!0,this;let n=a;return t.forEach((e,t,s)=>{n=n[e]}),n[s]=r,this}getMap(){return this.map}setTarget(e){return this.target=e,this}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this.map.forEach((e,t)=>{e.dispose()}),this}}class Xt extends Ht{constructor(e){super(e),p(this,"COMPILER_NAME",pe.MESH),p(this,"replaceMaterial",new i["P"]({color:"rgb(150, 150, 150)"})),p(this,"replaceGeometry",new i["c"](10,10,10))}getReplaceMaterial(){return this.replaceMaterial}getReplaceGeometry(){return this.replaceGeometry}add(e,t){const s=new i["O"](this.getGeometry(t.geometry),this.getMaterial(t.material));return kt.applyConfig(t,s,{geometry:!0,material:!0,lookAt:!0}),this.map.set(e,s),this.weakMap.set(s,e),this.setLookAt(e,t.lookAt),this.scene.add(s),this}set(e,t,s,i){if(!this.map.has(e))return console.warn(`model compiler can not found this vid mapping object: '${e}'`),this;let r=this.map.get(e);if("lookAt"===s)return this.setLookAt(e,i);if("material"===s)return r.material=this.getMaterial(i),this;for(let a of t)r=r[a];return r[s]=i,this}dispose(){return super.dispose(),this.replaceGeometry.dispose(),this.replaceMaterial.dispose(),this}}class Yt extends Ht{constructor(e){super(e),p(this,"replaceMaterial",new i["hb"]({color:"rgb(150, 150, 150)"})),p(this,"replaceGeometry",new i["p"](5))}getReplaceMaterial(){return this.replaceMaterial}getReplaceGeometry(){return this.replaceGeometry}add(e,t){const s=new i["gb"](this.getGeometry(t.geometry),this.getMaterial(t.material));return kt.applyConfig(t,s,{geometry:!0,material:!0,lookAt:!0}),this.map.set(e,s),this.weakMap.set(s,e),this.setLookAt(e,t.lookAt),this.scene.add(s),this}set(e,t,s,i){if(!this.map.has(e))return console.warn(`PointsCompiler: can not found this vid mapping object: '${e}'`),this;let r=this.map.get(e);if("lookAt"===s)return this.setLookAt(e,i);if("material"===s)return r.material=this.getMaterial(i),this;for(let a of t)r=r[a];return r[s]=i,this}dispose(){return super.dispose(),this.replaceGeometry.dispose(),this.replaceMaterial.dispose(),this}}class Zt extends kt{constructor(e){super(),p(this,"renderer"),p(this,"engine"),p(this,"target"),p(this,"rendererCacheData"),this.engine=e.engine,this.target=e.target,this.renderer=this.engine.webGLRenderer,this.rendererCacheData={}}setClearColor(e){const t=Number(e.slice(0,-1).split(",").pop().trim());return this.renderer.setClearColor(e,t),this.renderer.clear(),this}setPixelRatio(e){return this.renderer.setPixelRatio(e),this.renderer.clear(),this}setSize(e){const t=this.renderer;if(e)t.setSize(e.x,e.y);else{const e=t.domElement;t.setSize(e.offsetWidth,e.offsetHeight)}return this}setViewpoint(e){const t=this.renderer;if(e)t.setViewport(e.x,e.y,e.width,e.height);else{const e=t.domElement;t.setViewport(0,0,e.offsetWidth,e.offsetHeight)}return this}setScissor(e){const t=this.renderer;if(e)t.setScissorTest(!0),t.setScissor(e.x,e.y,e.width,e.height);else{t.setScissorTest(!1);const e=t.domElement;t.setScissor(0,0,e.offsetWidth,e.offsetHeight)}return this}setAdaptiveCamera(e){if(!this.engine)return console.warn("renderer compiler is not set engine."),this;const t=this.renderer,s=this.engine,r=s.renderManager;if(!e){if(!this.rendererCacheData.adaptiveCameraFun)return this;if(this.rendererCacheData.adaptiveCameraFun)return r.removeEventListener("render",this.rendererCacheData.adaptiveCameraFun),this.rendererCacheData.adaptiveCameraFun=void 0,this}if(e){if(this.rendererCacheData.adaptiveCameraFun)return r.addEventListener("render",this.rendererCacheData.adaptiveCameraFun),this;const e=e=>{const r=s.currentCamera,a=t.domElement.offsetWidth,n=t.domElement.offsetHeight;let o=0,h=0,c=0,l=0,p=0;if(r instanceof i["cb"])p=r.aspect;else{if(!(r instanceof i["Z"]))return void console.warn("renderer compiler can not support this camera",r);o=r.right-r.left,h=r.top-r.bottom,p=o/h}p>=1?(o=a,h=o/p,l=n/2-h/2):(h=n,o=h*p,c=a/2-o/2),t.setScissor(c,l,o,h),t.setViewport(c,l,o,h),t.setScissorTest(!0)};this.rendererCacheData.adaptiveCameraFun=e,r.addEventListener("render",this.rendererCacheData.adaptiveCameraFun)}return this}set(e,t,s){const i={clearColor:()=>this.setClearColor(s),pixelRatio:()=>this.setPixelRatio(s),size:()=>this.setSize(this.target.size),viewport:()=>this.setViewpoint(this.target.viewport),scissor:()=>this.setScissor(this.target.scissor),adaptiveCamera:()=>this.setAdaptiveCamera(s)};if(i[e[0]||t])return i[e[0]||t](),this;let r=this.renderer;return e.forEach((e,t,s)=>{r=r[e]}),r[t]=s,this.renderer.clear(),this}setTarget(e){return this.target=e,this}compileAll(){const e=this.target;this.setClearColor(e.clearColor),this.setPixelRatio(e.pixelRatio),this.setSize(e.size),this.setViewpoint(e.viewport),this.setScissor(e.scissor),this.setAdaptiveCamera(e.adaptiveCamera);const t=JSON.parse(JSON.stringify(e));return delete t.vid,delete t.type,delete t.clearColor,delete t.pixelRatio,delete t.size,delete t.viewport,delete t.scissor,delete t.adaptiveCamera,kt.applyConfig(t,this.renderer),this.renderer.clear(),this}dispose(){return this.renderer.dispose(),this}}class Kt extends kt{constructor(e){super(),p(this,"target"),p(this,"engine"),p(this,"map"),e?(e.target&&(this.target=e.target),e.engine&&(this.engine=e.engine)):(this.target={},this.engine=new os),this.map={}}add(e,t){if("WebGLRenderer"===e){const s=new Zt({engine:this.engine,target:t});s.compileAll(),this.map[e]=s}}set(e,t,s){const i=e.shift();return i?this.map[i]?(this.map[i].set(e,t,s),this):(console.warn("renderer compiler can not support this type: "+i),this):(this.map[t].setTarget(s).compileAll(),this)}setTarget(e){return this.target=e,this}compileAll(){const e=this.target;return Object.keys(e).forEach(t=>{this.add(t,e[t])}),this}dispose(){return this}}class qt extends kt{constructor(e){super(),p(this,"textureMap"),p(this,"target"),p(this,"scene"),p(this,"fogCache"),e?(e.target&&(this.target=e.target),e.scene&&(this.scene=e.scene)):(this.target={scene:Pe()},this.scene=new i["mb"]),this.textureMap=new Map,this.fogCache=null}background(e){e?Ye(e)?this.textureMap.has(e)?this.scene.background=this.textureMap.get(e):console.warn(`scene compiler can not found this vid texture : '${e}'`):this.scene.background=new i["k"](e):this.scene.background=null}environment(e){e?Ye(e)?this.textureMap.has(e)?this.scene.environment=this.textureMap.get(e):console.warn(`scene compiler can not found this vid texture : '${e}'`):console.warn(`this vid is illegal: '${e}'`):this.scene.environment=null}fog(e){if(e)if("Fog"===e.type)if(this.fogCache instanceof i["w"]){const t=this.fogCache;t.color=new i["k"](e.color),t.near=e.near,t.far=e.far}else this.scene.fog=new i["w"](e.color,e.near,e.far),this.fogCache=this.scene.fog;else if("FogExp2"===e.type)if(this.fogCache instanceof i["x"]){const t=this.fogCache;t.color=new i["k"](e.color),t.density=e.density}else this.scene.fog=new i["x"](e.color,e.density),this.fogCache=this.scene.fog;else console.warn(`scene compiler can not support this type fog:'${e.type}'`);else this.scene.fog=null}linkTextureMap(e){return this.textureMap=e,this}set(e,t,s){const i=e.shift();if("scene"===i){const e={background:()=>this.background(s),environment:()=>this.environment(s),fog:()=>this.fog(this.target.scene.fog)};return e[t]&&e[t](),this}return console.warn("scene compiler can not support this type: "+i),this}setTarget(e){return this.target=e,this}compileAll(){const e=this.target.scene;return this.background(e.background),this.environment(e.environment),this.fog(e.fog),this}dispose(){return this}}class Qt extends Ht{constructor(e){super(e),p(this,"COMPILER_NAME",pe.SPRITE),p(this,"replaceMaterial",new i["ub"]({color:"rgb(150, 150, 150)"})),p(this,"replaceGeometry",new i["db"](10,10,10))}getReplaceMaterial(){return this.replaceMaterial}getReplaceGeometry(){return console.warn("SpriteCompiler: can not use geometry in SpriteCompiler."),this.replaceGeometry}getSpriteMaterial(e){const t=this.getMaterial(e);return t instanceof i["ub"]?t:(console.warn(`SpriteCompiler: sprite object can not support this type material: ${t.type}, vid: ${e}.`),this.getReplaceMaterial())}add(e,t){const s=new i["tb"];return this.map.set(e,s),this.weakMap.set(s,e),s.material=this.getSpriteMaterial(t.material),s.center.set(t.center.x,t.center.y),kt.applyConfig(t,s,{center:!0,material:!0}),this.scene.add(s),this}set(e,t,s,i){if(!this.map.has(e))return console.warn(`SpriteCompiler: can not found this vid mapping object: '${e}'`),this;let r=this.map.get(e);if("material"===s)return r.material=this.getSpriteMaterial(i),this;if("lookAt"===s)return this.setLookAt(e,i);for(let a of t)r=r[a];return r[s]=i,this}dispose(){return this.map.forEach((e,t)=>{e.geometry.dispose()}),super.dispose(),this.replaceGeometry.dispose(),this.replaceMaterial.dispose(),this}}class es extends i["xb"]{constructor(e,t,s,i,r,a,n,o,h,c){super(e,t,s,i,r,a,n,o,h,c)}}class ts extends kt{constructor(e){super(),p(this,"target"),p(this,"map"),p(this,"constructMap"),p(this,"resourceMap"),e?e.target&&(this.target=e.target):this.target={},this.map=new Map,this.resourceMap=new Map;const t=new Map;t.set(le.IMAGETEXTURE,()=>new es),t.set(le.CUBETEXTURE,()=>new i["l"]),t.set(le.CANVASTEXTURE,()=>new i["h"](document.createElement("canvas"))),this.constructMap=t}getResource(e){const t=this.resourceMap;if(t.has(e)){const s=t.get(e);return s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement?s:(console.error("this url mapping resource is not a texture image class: "+e),null)}return console.warn("resource can not font url: "+e),null}linkRescourceMap(e){return this.resourceMap=e,this}add(e,t){if(Ye(e))if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)(),i=JSON.parse(JSON.stringify(t));if(delete i.type,delete i.vid,t.type===le.IMAGETEXTURE||t.type===le.CANVASTEXTURE)s.image=this.getResource(i.url),delete i.url;else if(t.type===le.CUBETEXTURE){const e=t.cube,r=[this.getResource(e.px),this.getResource(e.nx),this.getResource(e.py),this.getResource(e.ny),this.getResource(e.pz),this.getResource(e.nz)];s.image=r,delete i.cube}kt.applyConfig(i,s),s.needsUpdate=!0,this.map.set(e,s)}else console.warn("texture compiler can not support this type: "+t.type);else console.error("texture vid parameter is illegal: "+e);return this}set(e,t,s,i){if(!Ye(e))return console.warn(`texture compiler set function: vid is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`texture compiler set function: can not found texture which vid is: '${e}'`),this;const r=this.map.get(e);if("needsUpdate"===s){if(i){r.needsUpdate=!0;const t=this.target[e];t.needsUpdate=!1}return this}let a=r;return t.forEach((e,t,s)=>{a=a[e]}),a[s]=i,r.needsUpdate=!0,this}getMap(){return this.map}setTarget(e){return this.target=e,this}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}}class ss{constructor(e){p(this,"cameraCompiler"),p(this,"lightCompiler"),p(this,"geometryCompiler"),p(this,"textureCompiler"),p(this,"materialCompiler"),p(this,"rendererCompiler"),p(this,"sceneCompiler"),p(this,"controlsCompiler"),p(this,"spriteCompiler"),p(this,"eventCompiler"),p(this,"lineCompiler"),p(this,"meshCompiler"),p(this,"pointsCompiler"),p(this,"objectCompilerList"),this.objectCompilerList=[],e&&Object.keys(e).forEach(t=>{this[t]=e[t],e[t].IS_OBJECTCOMPILER&&this.objectCompilerList.push(e[t])})}support(e){const t=e.dataSupportManager,s=t.textureDataSupport,i=t.materialDataSupport,r=t.cameraDataSupport,a=t.lightDataSupport,n=t.geometryDataSupport,o=t.rendererDataSupport,h=t.sceneDataSupport,c=t.controlsDataSupport,l=t.spriteDataSupport,p=t.eventDataSupport,d=t.lineDataSupport,u=t.meshDataSupport,m=t.pointsDataSupport,g=new ts({target:s.getData()});this.textureCompiler=g;const f=new Jt({target:i.getData()});this.materialCompiler=f;const M=new Wt({target:n.getData()});this.geometryCompiler=M;const E=new zt({target:r.getData(),scene:e.scene,engine:e});this.cameraCompiler=E,this.objectCompilerList.push(E);const b=new $t({scene:e.scene,target:a.getData()});this.lightCompiler=b,this.objectCompilerList.push(b);const y=new Qt({target:l.getData(),scene:e.scene});this.spriteCompiler=y,this.objectCompilerList.push(y);const w=new _t({target:d.getData(),scene:e.scene});this.lineCompiler=w,this.objectCompilerList.push(w);const v=new Xt({target:u.getData(),scene:e.scene});this.meshCompiler=v,this.objectCompilerList.push(v);const C=new Yt({target:m.getData(),scene:e.scene});this.pointsCompiler=C,this.objectCompilerList.push(C);const S=new Kt({target:o.getData(),engine:e});this.rendererCompiler=S;const L=new qt({target:h.getData(),scene:e.scene});this.sceneCompiler=L;const A=new Vt({target:c.getData(),transformControls:e.transformControls});this.controlsCompiler=A;const R=new Ft({target:p.getData()});this.eventCompiler=R;const T=e.resourceManager;L.linkTextureMap(g.getMap()),f.linkTextureMap(g.getMap());const O=this.objectCompilerList.map(e=>e.getMap());for(let x of this.objectCompilerList)x.linkGeometryMap(M.getMap()).linkMaterialMap(f.getMap()).linkObjectMap(...O);return g.linkRescourceMap(T.resourceMap),M.linkRescourceMap(T.resourceMap),s.addCompiler(g),i.addCompiler(f),r.addCompiler(E),a.addCompiler(b),n.addCompiler(M),o.addCompiler(S),h.addCompiler(L),c.addCompiler(A),l.addCompiler(y),d.addCompiler(w),u.addCompiler(v),m.addCompiler(C),this}getObjectSymbol(e){const t=this.objectCompilerList;for(let s of t){const t=s.getObjectSymbol(e);if(t)return t}return null}getMaterial(e){if(!Ye(e))return void console.warn("compiler manager vid is illeage: "+e);const t=this.materialCompiler;return t.getMap().get(e)}getTexture(e){if(!Ye(e))return void console.warn("compiler manager vid is illeage: "+e);const t=this.textureCompiler;return t.getMap().get(e)}getObject(e){}getObjectCompilerList(){return this.objectCompilerList}dispose(){return this.geometryCompiler.dispose(),this.materialCompiler.dispose(),this.lineCompiler.dispose(),this.spriteCompiler.dispose(),this}}const is=function(e){if(this.compilerManager)return console.warn("engine has installed compilerManager plugin."),!1;const t=new ss;return this.compilerManager=t,this.addEventListener("dispose",()=>{this.compilerManager.dispose()}),this.completeSet.add(()=>{var e;this.webGLRenderer?this.scene?this.renderManager?this.dataSupportManager?(null==(e=this.compilerManager)||e.support(this),this.eventManager&&t.getObjectCompilerList()):console.warn("must install dataSupportManager before compilerManager plugin."):console.warn("must install renderManager before compilerManager plugin."):console.warn("must install scene before compilerManager plugin."):console.warn("must install webGLRenderer before compilerManager plugin.")}),!0};var rs;(function(e){e["WEBGLRENDERER"]="WebGLRenderer",e["SCENE"]="Scene",e["MODELINGSCENE"]="ModelingScene",e["RENDERMANAGER"]="RenderManager",e["ORBITCONTROLS"]="OrbitControls",e["STATS"]="Stats",e["EFFECTCOMPOSER"]="EffectComposer",e["POINTERMANAGER"]="PointerManager",e["EVENTMANAGER"]="EventManager",e["TRANSFORMCONTROLS"]="TransformControls",e["LOADERMANAGER"]="LoaderManager",e["RESOURCEMANAGER"]="ResourceManager",e["DATASUPPORTMANAGER"]="DataSupportManager",e["COMPILERMANAGER"]="CompilerManager"})(rs||(rs={}));let as=new Map;as.set("WebGLRenderer",J),as.set("Scene",T),as.set("ModelingScene",R),as.set("RenderManager",P),as.set("OrbitControls",N),as.set("Stats",H),as.set("EffectComposer",z),as.set("PointerManager",F),as.set("EventManager",B),as.set("TransformControls",_),as.set("LoaderManager",ce),as.set("ResourceManager",rt),as.set("DataSupportManager",Nt),as.set("CompilerManager",is);const ns=class extends d{constructor(){super(),p(this,"completeSet"),p(this,"dom"),p(this,"webGLRenderer"),p(this,"currentCamera"),p(this,"scene"),p(this,"orbitControls"),p(this,"transformControls"),p(this,"effectComposer"),p(this,"renderManager"),p(this,"pointerManager"),p(this,"eventManager"),p(this,"loaderManager"),p(this,"resourceManager"),p(this,"dataSupportManager"),p(this,"compilerManager"),p(this,"stats"),p(this,"transing"),p(this,"setSize"),p(this,"setCamera"),p(this,"setDom"),p(this,"setStats"),p(this,"setTransformControls"),p(this,"loadResources"),p(this,"loadResourcesAsync"),p(this,"registerResources"),p(this,"toJSON"),p(this,"play"),p(this,"stop"),p(this,"render"),this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this}}optimizeMemory(){Object.keys(this).forEach(e=>{void 0===this[e]&&delete this[e]})}install(e,t){return ns.pluginHandler.has(e)?ns.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet.clear(),this}dispose(){return this.dispatchEvent({type:"dispose"}),this}};let os=ns;p(os,"pluginHandler",as),p(os,"register",(function(e,t){ns.pluginHandler&&ns.pluginHandler.set(e,t)})),p(os,"dispose",(function(){ns.pluginHandler=void 0}));const hs=class{constructor(){p(this,"supportData"),p(this,"supportDataType")}create(e){return e?(this.supportData={},this.supportDataType=e,this):(console.warn("you must give a module type in create params"),this)}add(e){return this.supportData&&this.supportDataType?e.type?hs.configModelMap[e.type]!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${e.type}'`),this):(this.supportData[e.vid]=tt(e.type,e),this):(console.warn("config can not found attribute 'type'"),this):(console.warn("you must call 'create' method before the 'add' method"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}};let cs=hs;var ls;p(cs,"configModelMap",Be()),function(e){e["ACTIVE"]="active",e["HOVER"]="hover"}(ls||(ls={}));const ps=new i["fb"]("rgb(255, 255, 255)",.5,200,1);ps.position.set(-30,5,20),ps.castShadow=!0;const ds=new i["O"](new i["c"](80,2,80),new i["S"]({color:"rgb(255, 255, 255)"}));ds.position.set(0,-11,0),ds.receiveShadow=!0,ds.castShadow=!0;const us=class{constructor(e){p(this,"material"),p(this,"dom"),p(this,"renderer"),p(this,"scene"),p(this,"camera"),p(this,"object");const t=new i["Gb"]({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=i["bb"];const s=new i["mb"],r=new i["cb"](45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new i["Db"](0,0,0)),s.add(us.ambientLight),s.add(us.pointLight),s.add(us.plane),this.scene=s,this.renderer=t,this.camera=r,this.object=new i["W"],(null==e?void 0:e.material)&&this.setMaterial(e.material),(null==e?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new i["O"](us.geometry,e);else if(e.type.includes("Line"))this.object=new i["D"](us.geometry,e);else if(e.type.includes("Ponits"))this.object=new i["gb"](us.geometry,e);else{if(!e.type.includes("Sprite"))return console.warn(`material displayer can not support this type material: '${e.type}'`),this;this.object=new i["tb"](e)}return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const e=this.dom;this.camera.aspect=e.offsetWidth/e.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.offsetWidth,e.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}dispose(){this.renderer.dispose()}};let ms=us;p(ms,"ambientLight",new i["a"]("rgb(255, 255, 255)",.7)),p(ms,"pointLight",ps),p(ms,"geometry",new i["pb"](10,12,12)),p(ms,"plane",ds),p(ms,"dispose",()=>{us.geometry.dispose(),us.plane.geometry.dispose()});const gs=class{constructor(e){p(this,"dom"),p(this,"texture"),p(this,"renderer"),p(this,"scene"),p(this,"camera");const t=new i["Gb"]({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=i["bb"];const s=new i["mb"],r=new i["cb"](45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new i["Db"](0,0,0)),s.add(gs.ambientLight),this.scene=s,this.renderer=t,this.camera=r,(null==e?void 0:e.texture)&&this.setTexture(e.texture),(null==e?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const e=this.dom;this.camera.aspect=e.offsetWidth/e.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.offsetWidth,e.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}dispose(){this.renderer.dispose()}};let fs=gs;p(fs,"ambientLight",new i["a"]("rgb(255, 255, 255)",1));class Ms extends os{constructor(e){super(),p(this,"IS_ENGINESUPPORT",!0),this.install(rs.LOADERMANAGER).install(rs.RESOURCEMANAGER).install(rs.DATASUPPORTMANAGER,e).install(rs.COMPILERMANAGER)}loadConfig(e,t){const s=()=>{const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)};if(e.assets&&e.assets.length){this.loaderManager.reset().load(e.assets);const i=r=>{delete e.assets,s(),this.resourceManager.removeEventListener("mapped",i),t&&t(r)};this.resourceManager.addEventListener("mapped",i)}else s(),t&&t();return this}loadConfigAsync(e){return new Promise((t,s)=>{const i=()=>{const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)};if(e.assets&&e.assets.length){this.loaderManager.reset().load(e.assets);const s=r=>{delete e.assets,i(),this.resourceManager.removeEventListener("mapped",s),t(r)};this.resourceManager.addEventListener("mapped",s)}else i(),t(void 0)})}}class Es extends Ms{constructor(e){super(e),p(this,"IS_ENGINESUPPORT",!0),this.install(rs.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(rs.MODELINGSCENE,{hasDefaultPerspectiveCamera:!0,hasDefaultOrthographicCamera:!0,hasAxesHelper:!0,hasGridHelper:!0,hasDisplayMode:!0,displayMode:"env"}).install(rs.RENDERMANAGER).install(rs.STATS).install(rs.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(rs.ORBITCONTROLS).install(rs.POINTERMANAGER).install(rs.EVENTMANAGER).install(rs.TRANSFORMCONTROLS).complete()}}}}]);