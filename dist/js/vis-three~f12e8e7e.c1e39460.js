(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["vis-three~f12e8e7e"],{2209:function(e,t,s){"use strict";s.d(t,"a",(function(){return A})),s.d(t,"b",(function(){return xt})),s.d(t,"c",(function(){return jt})),s.d(t,"d",(function(){return Pt})),s.d(t,"e",(function(){return Ct})),s.d(t,"f",(function(){return Fe})),s.d(t,"g",(function(){return K})),s.d(t,"h",(function(){return yt})),s.d(t,"i",(function(){return $t})),s.d(t,"j",(function(){return Ue})),s.d(t,"k",(function(){return It})),s.d(t,"l",(function(){return Ot})),s.d(t,"m",(function(){return Y})),s.d(t,"n",(function(){return Dt})),s.d(t,"o",(function(){return Vt})),s.d(t,"p",(function(){return wt})),s.d(t,"q",(function(){return Jt})),s.d(t,"r",(function(){return N}));var i=s("5a89"),r=s("4721"),a=s("ef20"),n=s("32d9"),o=s("93e9"),h=s("b1f1"),c=Object.defineProperty,l=(e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,p=(e,t,s)=>(l(e,"symbol"!==typeof t?t+"":t,s),s);class d{constructor(){p(this,"listeners",new Map)}addEventListener(e,t){const s=this.listeners;s.has(e)||s.set(e,new Set),s.get(e).add(t)}hasEventListener(e,t){const s=this.listeners;return!!s.has(e)&&s.get(e).has(t)}removeEventListener(e,t){const s=this.listeners;s.has(e)&&s.get(e).has(t)&&s.get(e).delete(t)}dispatchEvent(e){var t;const s=e.type,i=this.listeners;if(i.has(s))try{null==(t=i.get(s))||t.forEach(t=>{t.call(this,e)})}catch(r){console.error(r)}}}const u=()=>({vid:"",type:"Object3D",castShadow:!0,receiveShadow:!0,lookAt:"",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}),m=function(){return Object.assign(u(),{type:"Light",color:"rgb(255, 255, 255)",intensity:1})},g=function(){return Object.assign(u(),{type:"AmbientLight",color:"rgb(255, 255, 255)",intensity:1})},f=function(){return Object.assign(m(),{type:"PointLight",distance:30,decay:.01})},M=function(){return Object.assign(m(),{type:"SpotLight",distance:30,angle:Math.PI/180*45,penumbra:.01,decay:.01})},E=function(){return{vid:"",type:"Geometry",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},b=function(){return Object.assign(E(),{type:"BoxGeometry",width:5,height:5,depth:5,widthSegments:1,heightSegments:1,depthSegments:1})},w=function(){return Object.assign(E(),{type:"SphereGeometry",radius:3,widthSegments:32,heightSegments:32,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI})},v=function(){return Object.assign(E(),{type:"LoadGeometry",url:""})},y=function(){return Object.assign(u(),{type:"Model",display:"Mesh",geometry:"",material:""})},S=function(){return{vid:"",type:"Texture",name:"",mapping:i["xb"],wrapS:i["h"],wrapT:i["h"],magFilter:i["F"],minFilter:i["G"],anisotropy:1,format:i["gb"],offset:{x:0,y:0},repeat:{x:1,y:1},rotation:0,center:{x:0,y:0},matrixAutoUpdate:!0,encoding:i["E"],needsUpdate:!1}},C=function(){return Object.assign(S(),{type:"ImageTexture",url:""})},R=function(){return Object.assign(S(),{type:"CubeTexture",cube:{nx:"",ny:"",nz:"",px:"",py:"",pz:""}})},x=function(){return{vid:"",type:"Material",alphaTest:0,colorWrite:!0,depthTest:!0,depthWrite:!0,format:i["gb"],fog:!0,name:"",needsUpdate:!1,opacity:1,dithering:!1,shadowSide:null,side:i["w"],toneMapped:!0,transparent:!1,visible:!0}},L=function(){return Object.assign(x(),{type:"MeshStandardMaterial",aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,metalness:0,normalMapType:i["tb"],refractionRatio:.98,roughness:1,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",roughnessMap:"",normalMap:"",metalnessMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:""})},O=function(){return Object.assign(x(),{type:"MeshPhongMateria",aoMapIntensity:1,bumpScale:1,color:"rgb(255, 255, 255)",displacementScale:1,displacementBias:0,emissive:"rgb(0, 0, 0)",emissiveIntensity:1,envMapIntensity:1,flatShading:!1,lightMapIntensity:1,normalMapType:i["tb"],refractionRatio:.98,wireframe:!1,wireframeLinecap:"round",wireframeLinejoin:"round",specular:"rgb(17, 17, 17)",shininess:30,combine:i["S"],normalMap:"",map:"",lightMap:"",envMap:"",emissiveMap:"",displacementMap:"",bumpMap:"",alphaMap:"",aoMap:"",specularMap:""})},T=function(){return Object.assign(u(),{type:"PerspectiveCamera",adaptiveWindow:!1,fov:45,aspect:1920/1080,near:5,far:50})},D=function(){return Object.assign(u(),{type:"OrthographicCamera",adaptiveWindow:!1,left:120,right:120,top:67.5,bottom:67.5,near:5,far:50})};var A;(function(e){e["BOXGEOMETRY"]="BoxGeometry",e["SPHEREGEOMETRY"]="SphereGeometry",e["LOADGEOMETRY"]="LoadGeometry",e["MODEL"]="Model",e["MESH"]="Mesh",e["LINE"]="Line",e["POINTS"]="Points",e["IMAGETEXTURE"]="ImageTexture",e["CUBETEXTURE"]="CubeTexture",e["MESHSTANDARDMATERIAL"]="MeshStandardMaterial",e["MESHPHONGMATERIAL"]="MeshPhongMaterial",e["AMBIENTLIGHT"]="AmbientLight",e["SPOTLIGHT"]="SpotLight",e["POINTLIGHT"]="PointLight",e["PERSPECTIVECAMERA"]="PerspectiveCamera",e["ORTHOGRAPHICCAMERA"]="OrthographicCamera",e["WEBGLRENDERER"]="WebGLRenderer",e["SCENE"]="Scene",e["TRNASFORMCONTROLS"]="TransformControls",e["ORBITCONTROLS"]="OrbitControls"})(A||(A={}));const j=function(){return{vid:"WebGLRenderer",type:"WebGLRenderer",clearColor:"rgba(0, 0, 0, 0)",outputEncoding:i["E"],physicallyCorrectLights:!1,shadowMap:{enabled:!1,autoUpdate:!0,type:i["Y"]},toneMapping:i["T"],toneMappingExposure:1,pixelRatio:window.devicePixelRatio,adaptiveCamera:!1,viewport:null,scissor:null,size:null}},P=function(){return{vid:"Scene",type:"Scene",background:"",environment:"",fog:null}},G=function(){return{vid:"TransformControls",type:"TransformControls",axis:"XYZ",enabled:!0,mode:"translate",snapAllow:!1,rotationSnap:Math.PI/180*10,translationSnap:5,scaleSnap:.1,showX:!0,showY:!0,showZ:!0,size:1,space:"world"}},H=function(){return{vid:"OrbitControls",type:"OrbitControls",autoRotate:!1,autoRotateSpeed:2,enableDamping:!1,dampingFactor:.05}},k={[A.IMAGETEXTURE]:C,[A.CUBETEXTURE]:R,[A.MESHSTANDARDMATERIAL]:L,[A.MESHPHONGMATERIAL]:O,[A.AMBIENTLIGHT]:g,[A.SPOTLIGHT]:M,[A.POINTLIGHT]:f,[A.BOXGEOMETRY]:b,[A.SPHEREGEOMETRY]:w,[A.LOADGEOMETRY]:v,[A.MODEL]:y,[A.PERSPECTIVECAMERA]:T,[A.ORTHOGRAPHICCAMERA]:D,[A.WEBGLRENDERER]:j,[A.SCENE]:P,[A.TRNASFORMCONTROLS]:G,[A.ORBITCONTROLS]:H},N=function(e,t,s){if(k[e]){const i=(t,r)=>{for(const a in r)void 0!==t[a]?"object"===typeof r[a]&&null!==r[a]?i(t[a],r[a]):t[a]=r[a]:s&&console.warn(`'${e}' config can not set key: ${a}`)},r=k[e]();return t&&i(r,t),r}return console.error(`type: ${e} can not be found in configList.`),null},I="rgb(230, 20, 240)",z="rgb(255, 158, 240)",V="rgb(255, 255, 255)",F=()=>new i["C"]({color:V});class W extends i["D"]{constructor(e){super(),p(this,"sphere"),p(this,"target"),p(this,"shape"),p(this,"type","VisPointLightHelper"),p(this,"cachaColor"),p(this,"cachaDistance"),p(this,"cachaVector3"),this.geometry=new i["e"];const t=[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,0,0,-.707,-.707,0,.707,.707,0,.707,-.707,0,-.707,.707,-.707,0,-.707,.707,0,.707,.707,0,-.707,-.707,0,.707];this.geometry.setAttribute("position",new i["t"](t,3)),this.material=F(),this.geometry.boundingSphere;const s=(new i["j"]).copy(e.color).multiplyScalar(e.intensity),r=new i["M"](new i["V"](e.distance,0),new i["N"]({color:s,wireframe:!0}));r.raycast=()=>{},this.shape=r,this.target=e,this.sphere=new i["lb"](new i["Ab"](0,0,0),1),this.cachaColor=e.color.getHex(),this.cachaDistance=e.distance,this.cachaVector3=new i["Ab"],this.add(this.shape),this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.onBeforeRender=()=>{const e=this.target,t=this.shape,s=this;e.distance!==this.cachaDistance&&(t.geometry.dispose(),t.geometry=new i["V"](e.distance,0),this.cachaDistance=e.distance),e.color.getHex()!==this.cachaColor&&(t.material.color.copy(e.color).multiplyScalar(e.intensity),s.material.color.copy(e.color).multiplyScalar(e.intensity),this.cachaColor=e.color.getHex())}}raycast(e,t){const s=this.target,i=s.matrixWorld,r=this.sphere;r.set(this.cachaVector3.set(0,0,0),1),r.applyMatrix4(i),e.ray.intersectsSphere(r)&&t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}class U extends i["D"]{constructor(e){super(),p(this,"shape"),p(this,"target"),p(this,"type","CameraHelper"),p(this,"cachaData");const t=new i["e"],s=[0,0,0,-1,1,-1,0,0,0,-1,1,1,0,0,0,-1,-1,-1,0,0,0,-1,-1,1,-1,-1,1,-1,-1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,1,0,0,0,0,1,1,0,0,0,0,1,-1,0,0,0,0,-1,-1,0,0,0,0,-1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0,-1,-1,0,-1,1,0,-1,1,0,1,1,0,-1,1,2,-1,1,0,1,-1,2,1,-1,0,-1,-1,2,-1,-1,0,1,1,2,1,1,2,1,1,2,-1,1,2,-1,1,2,-1,-1,2,-1,-1,2,1,-1,2,1,-1,2,1,1];t.setAttribute("position",new i["t"](s,3)),t.rotateY(-90*Math.PI/180),t.computeBoundingBox();const r=new i["g"](e);r.matrix=new i["L"],r.matrixAutoUpdate=!0,r.raycast=()=>{},this.add(r),this.shape=r,this.geometry=t,this.material=F(),this.target=e,this.matrixAutoUpdate=!1,this.matrix=e.matrix,e instanceof i["ab"]?this.cachaData={fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}:e instanceof i["X"]?this.cachaData={left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far}:this.cachaData={},this.onBeforeRender=()=>{let t=!1;const s=this.cachaData;Object.keys(s).forEach(i=>{s[i]!==e[i]&&(s[i]=e[i],t=!0)}),t&&this.shape.update()}}raycast(e,t){const s=this.matrixWorld,i=this.geometry.boundingBox.clone();if(i.applyMatrix4(s),e.ray.intersectsBox(i)){const s=this.target;t.push({distance:e.ray.origin.distanceTo(s.position),object:s,point:s.position})}}}class B extends i["D"]{constructor(e){super(),p(this,"target"),p(this,"type","VisMeshHelper"),p(this,"cachaGeometryUUid");const t=1;this.target=e,this.geometry=new i["p"](e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid,this.material=F(),this.raycast=()=>{},this.matrixAutoUpdate=!1,this.matrix=e.matrix,this.onBeforeRender=()=>{const e=this.target;e.geometry.uuid!==this.cachaGeometryUUid&&(this.geometry.dispose(),this.geometry=new i["p"](e.geometry,t),this.cachaGeometryUUid=e.geometry.uuid)}}}var $;(function(e){e["ADD"]="add",e["REMOVE"]="remove"})($||($={}));const _=class extends i["r"]{constructor(e){super(),p(this,"map"),p(this,"scene"),this.map=new Map,this.scene=e}getMap(){return this.map}add(e){if(!_.filterHelperMap[e.type])if(_.typeHelperMap[e.type]){const t=new _.typeHelperMap[e.type](e);this.map.set(e,t),this.scene._add(t),this.dispatchEvent({type:$.ADD,helper:t,object:e})}else console.warn(`Scene helper compiler can not support this type object: '${e.type}'`)}remove(e){if(!_.filterHelperMap[e.type])if(this.map.has(e)){const t=this.map.get(e);this.scene._remove(t),t.geometry.dispose(),t.material&&(t.material instanceof i["K"]?t.material.dispose():t.material.forEach(e=>{e.dispose()})),this.map.delete(e),this.dispatchEvent({type:$.REMOVE,helper:t,object:e})}else console.warn("Scene helper compiler can not found this object`s helper: "+e)}setVisiable(e){const t=this.scene;e?this.map.forEach((e,s)=>{t._add(e)}):this.map.forEach((e,s)=>{t._remove(e)})}resetHelperColor(...e){const t=this.map,s=_.helperColorHex;e.forEach(e=>{if(t.has(e)){const i=t.get(e);i.material.color.setHex(s)}})}setHelperHoverColor(...e){const t=this.map,s=_.hoverColorHex;e.forEach(e=>{if(t.has(e)){const i=t.get(e);i.material.color.setHex(s)}})}setHelperActiveColor(...e){const t=this.map,s=_.activeColorHex;e.forEach(e=>{if(t.has(e)){const i=t.get(e);i.material.color.setHex(s)}})}};let J=_;var X,Y,q,K;p(J,"helperColorHex",new i["j"](V).getHex()),p(J,"activeColorHex",new i["j"](I).getHex()),p(J,"hoverColorHex",new i["j"](z).getHex()),p(J,"typeHelperMap",{PointLight:W,PerspectiveCamera:U,OrthographicCamera:U,Mesh:B}),p(J,"filterHelperMap",{AmbientLight:!0,Object3D:!0}),function(e){e["DefaultPerspectiveCamera"]="DefaultPerspectiveCamera",e["DefaultOrthograpbicCamera"]="DefaultOrthograpbicCamera"}(X||(X={})),function(e){e["DEFAULT"]="default",e["TOP"]="top",e["BOTTOM"]="bottom",e["LEFT"]="left",e["RIGHT"]="right",e["FRONT"]="front",e["BACK"]="back"}(Y||(Y={})),function(e){e["GEOMETRY"]="geometry",e["MATERIAL"]="material",e["LIGHT"]="light",e["ENV"]="env"}(q||(q={})),i["jb"].prototype.add=function(...e){if(!arguments.length)return this;if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}const t=e[0];if(t===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this;if(t&&t.isObject3D){if(null!==t.parent){const e=this.children.indexOf(t);-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent({type:"removed"}))}t.parent=this,this.children.push(t),t.dispatchEvent({type:"added"})}else console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e);return this};class Z extends i["jb"]{constructor(e){if(super(),p(this,"cameraSet"),p(this,"lightSet"),p(this,"meshSet"),p(this,"lineSet"),p(this,"pointsSet"),p(this,"spriteSet"),p(this,"helperCompiler"),p(this,"resetHoverObjectSet"),p(this,"resetActiveObjectSet"),p(this,"displayMode"),p(this,"meshOverrideMaterial"),p(this,"lineOverrideMaterial"),p(this,"pointsOverrideMaterial"),p(this,"spriteOverrideMaterial"),p(this,"materialCacheMap"),p(this,"defaultAmbientLight"),p(this,"defaultDirectionalLight"),p(this,"backgroundCache"),p(this,"environmentCache"),p(this,"defaultPerspectiveCamera"),p(this,"defaultOrthograpbicCamera"),p(this,"axesHelper"),p(this,"gridHelper"),p(this,"showAxesHelper"),p(this,"showGridHelper"),p(this,"getDefaultPerspectiveCamera"),p(this,"getDefaultOrthographicCamera"),p(this,"setAxesHelper"),p(this,"setGridHelper"),p(this,"switchDisplayMode"),p(this,"setDisplayMode"),this.cameraSet=new Set,this.lightSet=new Set,this.meshSet=new Set,this.lineSet=new Set,this.pointsSet=new Set,this.spriteSet=new Set,this.helperCompiler=new J(this),this.resetHoverObjectSet=new Set,this.resetActiveObjectSet=new Set,e.hasDefaultPerspectiveCamera&&(e.defaultPerspectiveCameraSetting?this.defaultPerspectiveCamera=new i["ab"](e.defaultPerspectiveCameraSetting.fov,e.defaultPerspectiveCameraSetting.aspect,e.defaultPerspectiveCameraSetting.near,e.defaultPerspectiveCameraSetting.far):this.defaultPerspectiveCamera=new i["ab"](45,window.innerWidth/window.innerHeight,1,1e3),this.defaultPerspectiveCamera.position.set(50,50,50),this.defaultPerspectiveCamera.lookAt(0,0,0),this.defaultPerspectiveCamera.name="默认透视相机",this.cameraSet.add(this.defaultPerspectiveCamera),this.getDefaultPerspectiveCamera=function(){return this.defaultPerspectiveCamera}),e.hasDefaultOrthographicCamera){if(e.defaultOrthographicCameraSetting){const t=e.defaultOrthographicCameraSetting;this.defaultOrthograpbicCamera=new i["X"](t.left,t.right,t.top,t.bottom,t.near,t.far)}else{const e=window.innerWidth/2,t=window.innerHeight/2;this.defaultOrthograpbicCamera=new i["X"](-e/8,e/8,t/8,-t/8,1,1e3)}this.defaultOrthograpbicCamera.name="默认正交相机",this.cameraSet.add(this.defaultOrthograpbicCamera),this.getDefaultOrthographicCamera=function(){return this.defaultOrthograpbicCamera},this.addEventListener(Y.TOP+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,60,0)}),this.addEventListener(Y.BOTTOM+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,-60,0)}),this.addEventListener(Y.RIGHT+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(60,0,0)}),this.addEventListener(Y.LEFT+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(-60,0,0)}),this.addEventListener(Y.FRONT+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,0,60)}),this.addEventListener(Y.BACK+"ViewPoint",e=>{this.defaultOrthograpbicCamera.position.set(0,0,-60)})}if(e.hasAxesHelper&&(this.axesHelper=new i["b"](500),this.axesHelper.matrixAutoUpdate=!1,this.axesHelper.raycast=()=>{},super.add(this.axesHelper),this.setAxesHelper=function(e){const t=this.axesHelper;if(e.size){const s=t.geometry.getAttribute("position");s.setX(e.size,1),s.setY(e.size,3),s.setZ(e.size,5),s.needsUpdate=!0}void 0!==typeof e.visiable&&(t.visible=e.visiable)},this.showAxesHelper=e=>{e?super.add(this.axesHelper):super.remove(this.axesHelper)}),e.hasGridHelper){const e=new i["x"](500,50,"rgb(130, 130, 130)","rgb(70, 70, 70)");if(e.raycast=()=>{},e.material instanceof i["K"]){const t=e.material;t.transparent=!0,t.opacity=.5,t.needsUpdate=!0}e.matrixAutoUpdate=!1,e.raycast=()=>{},this.gridHelper=e,super.add(e),this.addEventListener(Y.DEFAULT+"ViewPoint",t=>{e.rotation.set(0,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(Y.TOP+"ViewPoint",t=>{e.rotation.set(0,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(Y.BOTTOM+"ViewPoint",t=>{e.rotation.set(0,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(Y.RIGHT+"ViewPoint",t=>{e.rotation.set(0,0,Math.PI/2),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(Y.LEFT+"ViewPoint",t=>{e.rotation.set(0,0,Math.PI/2),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(Y.FRONT+"ViewPoint",t=>{e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.addEventListener(Y.BACK+"ViewPoint",t=>{e.rotation.set(Math.PI/2,0,0),e.updateMatrix(),e.updateMatrixWorld()}),this.showGridHelper=e=>{e?super.add(this.gridHelper):super.remove(this.gridHelper)}}if(e.hasDisplayMode){const t="rgb(250, 250, 250)";this.meshOverrideMaterial=new i["O"]({color:t}),this.lineOverrideMaterial=new i["C"]({color:t}),this.pointsOverrideMaterial=new i["eb"]({color:t,size:5,sizeAttenuation:!1}),this.spriteOverrideMaterial=new i["rb"]({color:t}),this.materialCacheMap=new WeakMap,this.defaultAmbientLight=new i["a"]("rgb(255, 255, 255)",.5),this.defaultAmbientLight.matrixAutoUpdate=!1,this.defaultDirectionalLight=new i["n"]("rgb(255, 255, 255)",.3),this.defaultDirectionalLight.castShadow=!1,this.defaultDirectionalLight.position.set(-100,100,100),this.defaultDirectionalLight.updateMatrix(),this.defaultDirectionalLight.updateMatrixWorld(),this.defaultDirectionalLight.matrixAutoUpdate=!1,this.switchDisplayMode=e=>{const t=()=>{const e=this.materialCacheMap,t=this.meshOverrideMaterial;this.meshSet.forEach(s=>{e.set(s,s.material),s.material=t});const s=this.lineOverrideMaterial;this.lineSet.forEach(t=>{e.set(t,t.material),t.material=s});const i=this.pointsOverrideMaterial;this.pointsSet.forEach(t=>{e.set(t,t.material),t.material=i});const r=this.spriteOverrideMaterial;this.spriteSet.forEach(t=>{e.set(t,t.material),t.material=r})},s=()=>{const e=this.materialCacheMap;this.meshSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))}),this.lineSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))}),this.pointsSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))}),this.spriteSet.forEach(t=>{e.get(t)&&(t.material=e.get(t),e.delete(t))})},r=()=>{this.lightSet.forEach(e=>{super.remove(e)}),super.add(this.defaultAmbientLight),super.add(this.defaultDirectionalLight)},a=()=>{this.lightSet.forEach(e=>{super.add(e)}),super.remove(this.defaultAmbientLight),super.remove(this.defaultDirectionalLight)},n=()=>{this.background instanceof i["ub"]&&(this.backgroundCache=this.background,this.background=null),this.environment instanceof i["ub"]&&(this.environmentCache=this.environment,this.environment=null)},o=()=>{this.backgroundCache&&(this.background=this.backgroundCache,this.backgroundCache=void 0),this.environmentCache&&(this.environment=this.environmentCache,this.environmentCache=void 0)};e===q.GEOMETRY?(t(),n(),r()):e===q.MATERIAL?(s(),n(),r()):e===q.LIGHT?(s(),n(),a()):e===q.ENV?(s(),o(),a()):console.warn("VisScene can not set this mode: "+e)},this.setDisplayMode=e=>{this.displayMode=e,this.switchDisplayMode(e)},void 0!==e.displayMode?(this.setDisplayMode(e.displayMode),this.switchDisplayMode(this.displayMode)):(this.setDisplayMode(q.ENV),this.switchDisplayMode(this.displayMode))}}getHelperCompiler(){return this.helperCompiler}setObjectHelperVisiable(e){this.helperCompiler.setVisiable(e)}setObjectHelperHover(...e){const t=this.resetHoverObjectSet,s=this.resetActiveObjectSet;return e.forEach((e,i,r)=>{t.delete(e),s.has(e)&&r.splice(i,1)}),s.forEach(e=>{t.delete(e)}),this.helperCompiler.resetHelperColor(...t),t.clear(),this.helperCompiler.setHelperHoverColor(...e),e.forEach(e=>{t.add(e)}),this}setObjectHelperActive(...e){const t=this.resetActiveObjectSet;return e.forEach(e=>{t.delete(e)}),this.helperCompiler.resetHelperColor(...t),t.clear(),this.helperCompiler.setHelperActiveColor(...e),e.forEach(e=>{t.add(e)}),this}showObjectHelper(e){return this.helperCompiler.setVisiable(e),this}setViewPoint(e){this.dispatchEvent({type:e+"ViewPoint"})}add(...e){let t=0;return e.forEach(e=>{e instanceof i["M"]?(this.meshSet.add(e),t+=1):e instanceof i["B"]?(this.lineSet.add(e),t+=1):e instanceof i["A"]?(this.lightSet.add(e),t+=1):e instanceof i["db"]?(this.pointsSet.add(e),t+=1):e instanceof i["qb"]?(this.spriteSet.add(e),t+=1):e instanceof i["f"]&&(this.cameraSet.add(e),t+=1),this.helperCompiler.add(e)}),void 0!==this.displayMode&&t>0&&this.switchDisplayMode(this.displayMode),super.add(...e)}remove(...e){const t=this.materialCacheMap;return e.forEach(e=>{t&&t.has(e)&&t.delete(e),e instanceof i["M"]?this.meshSet.delete(e):e instanceof i["B"]?this.lineSet.delete(e):e instanceof i["A"]?this.lightSet.delete(e):e instanceof i["db"]?this.pointsSet.delete(e):e instanceof i["qb"]?this.spriteSet.delete(e):e instanceof i["f"]&&this.cameraSet.delete(e),this.helperCompiler.remove(e)}),super.remove(...e)}_add(...e){return super.add(...e)}_remove(...e){return super.remove(...e)}updateMaterial(e){var t;return void 0!==this.displayMode&&"geometry"===this.displayMode&&(null==(t=this.materialCacheMap)||t.set(e,e.material),this.switchDisplayMode&&this.switchDisplayMode(this.displayMode)),this}}(function(e){e["CAMERA"]="camera",e["LIGHT"]="light",e["GEOMETRY"]="geometry",e["MODEL"]="model",e["TEXTURE"]="texture",e["MATERIAL"]="material",e["RENDERER"]="renderer",e["SCENE"]="scene",e["SPRITE"]="sprite",e["STRUCTURE"]="structure",e["CONTROLS"]="controls"})(K||(K={}));const Q=function(e){if(this.scene instanceof Z)return console.warn("this has installed modeling scene plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;const t=new Z(e);if(this.scene=t,this.render=()=>(this.webGLRenderer.render(t,this.currentCamera),this),e.hasDefaultPerspectiveCamera){const e=t.getDefaultPerspectiveCamera();this.currentCamera=e,t.addEventListener(Y.DEFAULT+"ViewPoint",t=>{this.setCamera(e)})}if(e.hasDefaultOrthographicCamera){const e=t.getDefaultOrthographicCamera();t.addEventListener(Y.TOP+"ViewPoint",t=>{this.setCamera(e)}),t.addEventListener(Y.BOTTOM+"ViewPoint",t=>{this.setCamera(e)}),t.addEventListener(Y.RIGHT+"ViewPoint",t=>{this.setCamera(e)}),t.addEventListener(Y.LEFT+"ViewPoint",t=>{this.setCamera(e)}),t.addEventListener(Y.FRONT+"ViewPoint",t=>{this.setCamera(e)}),t.addEventListener(Y.BACK+"ViewPoint",t=>{this.setCamera(e)})}return!0},ee=function(e){if(Q.call(this,e)){const e=this.dataSupportManager.getDataSupport(K.SCENE).getData();return e.scene=N(A.SCENE),!0}return!1};var te;(function(e){e["BOXGEOMETRY"]="BoxGeometry",e["SPHEREGEOMETRY"]="SphereGeometry",e["LOADGEOMETRY"]="LoadGeometry",e["MODEL"]="Model",e["MESH"]="Mesh",e["LINE"]="Line",e["POINTS"]="Points",e["IMAGETEXTURE"]="ImageTexture",e["CUBETEXTURE"]="CubeTexture",e["MESHSTANDARDMATERIAL"]="MeshStandardMaterial",e["MESHPHONGMATERIAL"]="MeshPhongMaterial",e["AMBIENTLIGHT"]="AmbientLight",e["SPOTLIGHT"]="SpotLight",e["POINTLIGHT"]="PointLight",e["PERSPECTIVECAMERA"]="PerspectiveCamera",e["ORTHOGRAPHICCAMERA"]="OrthographicCamera",e["WEBGLRENDERER"]="WebGLRenderer",e["SCENE"]="Scene",e["TRNASFORMCONTROLS"]="TransformControls",e["ORBITCONTROLS"]="OrbitControls"})(te||(te={}));const se=function(e){if(this.scene)return console.warn("this has installed scene plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;this.scene=new i["jb"],this.render=()=>(this.webGLRenderer.render(this.scene,this.currentCamera),this);const t=new i["ab"];return t.position.set(50,50,50),t.lookAt(0,0,0),this.currentCamera=t,!0},ie=function(e){if(se.call(this,e)){const e=this.dataSupportManager.getDataSupport(K.SCENE).getData();return e.scene=N(te.SCENE),!0}return!1};var re,ae,ne,oe,he;(function(e){e["RENDER"]="render",e["PLAY"]="play",e["STOP"]="stop"})(re||(re={})),function(e){e["HOVERCHANGE"]="hover-change",e["ACTIVECHANGE"]="active-change"}(ae||(ae={})),function(e){e["POINTERDOWN"]="pointerdown",e["POINTERMOVE"]="pointermove",e["POINTERUP"]="pointerup"}(ne||(ne={})),function(e){e["SETMATERIAL"]="setMaterial"}(oe||(oe={})),function(e){e["LOADING"]="loading",e["DETAILLOADING"]="detailLoading",e["DETAILLOADED"]="detailLoaded",e["LOADED"]="loaded"}(he||(he={}));class ce extends i["r"]{constructor(){super(...arguments),p(this,"clock",new i["i"]),p(this,"animationFrame",-1),p(this,"render",()=>{const e=this.clock,t=e.getDelta(),s=e.getElapsedTime();this.dispatchEvent({type:re.RENDER,delta:t,total:s})}),p(this,"play",()=>{this.dispatchEvent({type:re.PLAY});const e=()=>{this.render(),this.animationFrame=requestAnimationFrame(e)};e()}),p(this,"stop",()=>{cancelAnimationFrame(this.animationFrame),this.animationFrame=-1,this.dispatchEvent({type:re.STOP})}),p(this,"checkHasRendering",()=>-1!==this.animationFrame),p(this,"hasVaildRender",()=>{if(!this._listeners)return!1;const e=this._listeners["render"];return e&&e.length})}}const le=function(){return this.renderManager?(console.warn("this has installed render manager plugin."),!1):(this.renderManager=new ce,this.render&&this.renderManager.addEventListener("render",this.render),this.render=function(){return this.renderManager.render(),this},this.play=function(){return this.renderManager.play(),this},this.stop=function(){return this.renderManager.stop(),this},!0)};class pe extends r["a"]{constructor(e,t){super(e,t),this.mouseButtons={LEFT:null,MIDDLE:i["J"].DOLLY,RIGHT:i["J"].ROTATE}}setCamera(e){return this.object=e,this.update(),this}}const de=function(e){if(this.orbitControls)return console.warn("this has installed orbitControls plugin."),!1;if(!this.webGLRenderer)return console.warn("this must install renderer before install orbitControls plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install orbitControls plugin."),!1;if(this.orbitControls=new pe(this.currentCamera,this.dom),this.addEventListener("setCamera",e=>{this.orbitControls.setCamera(e.camera)}),this.renderManager.addEventListener("render",()=>{this.orbitControls.update()}),this.scene instanceof Z){const e=this.scene;e.addEventListener(Y.DEFAULT+"ViewPoint",e=>{this.orbitControls.enableRotate=!0}),e.addEventListener(Y.TOP+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(Y.BOTTOM+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(Y.RIGHT+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(Y.LEFT+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(Y.FRONT+"ViewPoint",e=>{this.orbitControls.enableRotate=!1}),e.addEventListener(Y.BACK+"ViewPoint",e=>{this.orbitControls.enableRotate=!1})}return!0},ue=function(e){if(de.call(this,e)){const e=this.dataSupportManager.getDataSupport(K.CONTROLS).getData();return e[A.ORBITCONTROLS]=N(A.ORBITCONTROLS),!0}return!1};class me{constructor(e){p(this,"REVISION"),p(this,"dom"),p(this,"addPanel"),p(this,"showPanel"),p(this,"begin"),p(this,"end"),p(this,"update"),p(this,"domElement"),p(this,"setMode");const t=Object(a["a"])();this.REVISION=t.REVISION,this.dom=t.dom,this.domElement=t.domElement,this.begin=t.begin.bind(t),this.end=t.end.bind(t),this.update=t.update.bind(t),this.addPanel=t.addPanel.bind(t),this.showPanel=t.showPanel.bind(t),this.setMode=t.setMode.bind(t);const s=this.domElement;s.style.position="absolute",s.style.top="0",s.style.left="35px",e&&(s.style.top=e.top+"px",s.style.left=e.left+"px",s.style.right=e.right+"px",s.style.bottom=e.bottom+"px")}}const ge=function(e){if(this.stats)return console.warn("this has installed stats plugin."),!1;if(!this.renderManager)return console.warn("this must install renderManager before install orbitControls plugin."),!1;const t=new me(e);return this.stats=t,this.setStats=function(e){if(e)this.dom.appendChild(this.stats.domElement);else try{this.dom.removeChild(this.stats.domElement)}catch(t){}return this},this.renderManager.addEventListener("render",()=>{this.stats.update()}),!0},fe=function(e){if(this.effectComposer)return console.warn("this has installed effect composer plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;let t,s;if(null==e?void 0:e.WebGLMultisampleRenderTarget){const e=this.webGLRenderer,s=e.getPixelRatio(),r=e.getDrawingBufferSize(new i["zb"]);t=new n["a"](e,new i["Bb"](r.width*s,r.height*s,{format:i["gb"]}))}else t=new n["a"](this.webGLRenderer);return this.effectComposer=t,this.scene?(s=new o["a"](this.scene,this.currentCamera),t.addPass(s),this.addEventListener("setCamera",e=>{s.camera=e.camera}),this.addEventListener("setSize",e=>{t.setSize(e.width,e.height)}),this.renderManager&&this.renderManager.removeEventListener("render",this.render),this.render=()=>(this.effectComposer.render(),this),this.renderManager&&this.renderManager.addEventListener("render",e=>{this.effectComposer.render(e.delta)}),!0):(console.error("composer con not found support scene plugin."),!1)};class Me extends d{constructor(e){super(),p(this,"dom"),p(this,"mouse"),p(this,"canMouseMove"),p(this,"mouseEventTimer"),p(this,"throttleTime");const t=e.dom;this.dom=t,this.mouse=new i["zb"],this.canMouseMove=!0,this.mouseEventTimer=null,this.throttleTime=e.throttleTime||1e3/60,t.addEventListener("pointerdown",e=>{this.pointerDown(e)}),t.addEventListener("pointermove",e=>{this.canMouseMove&&(this.canMouseMove=!1,this.mouseEventTimer=setTimeout(()=>{const t=this.mouse,s=this.dom;t.x=e.offsetX/s.offsetWidth*2-1,t.y=-e.offsetY/s.offsetHeight*2+1,this.canMouseMove=!0,this.pointerMove(e)},this.throttleTime))}),t.addEventListener("pointerup",e=>{this.pointerUp(e)})}getMousePoint(){return this.mouse}pointerDown(e){const t={mouse:this.mouse};for(let s in e)t[s]=e[s];this.dispatchEvent(t)}pointerMove(e){const t={mouse:this.mouse};for(let s in e)t[s]=e[s];this.dispatchEvent(t)}pointerUp(e){const t={mouse:this.mouse};for(let s in e)t[s]=e[s];this.dispatchEvent(t)}}const Ee=function(e){if(this.pointerManager)return console.warn("this has installed pointerManager plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;const t=new Me(Object.assign(e||{},{dom:this.dom}));return this.pointerManager=t,!0};class be extends d{constructor(e){super(),p(this,"raycaster"),p(this,"scene"),p(this,"camera"),p(this,"recursive",!1),p(this,"penetrate",!1),this.raycaster=new i["hb"],this.camera=e.camera,this.scene=e.scene,e.recursive&&(this.recursive=e.recursive),e.penetrate&&(this.penetrate=e.penetrate)}setCamera(e){return this.camera=e,this}intersectObject(e){return this.raycaster.setFromCamera(e,this.camera),this.raycaster.intersectObjects(this.scene.children,this.recursive)}use(e){const t=function(e,t){return Object.assign({},e,t)};e.addEventListener("pointerdown",e=>{const s=this.intersectObject(e.mouse);if(this.dispatchEvent(t(e,{type:"pointerdown",intersections:s})),this.dispatchEvent(t(e,{type:"mousedown",intersections:s})),s.length)if(this.penetrate)for(let i of s)i.object.dispatchEvent(t(e,{type:"pointerdown",intersection:i})),i.object.dispatchEvent(t(e,{type:"mousedown",intersection:i}));else{const i=s[0];i.object.dispatchEvent(t(e,{type:"pointerdown",intersection:i})),i.object.dispatchEvent(t(e,{type:"mousedown",intersection:i}))}});const s=new Map;return e.addEventListener("pointermove",e=>{const i=this.intersectObject(e.mouse);if(this.dispatchEvent(t(e,{type:"pointermove",intersections:i})),this.dispatchEvent(t(e,{type:"mousemove",intersections:i})),i.length){if(this.penetrate)for(let r of i)s.has(r.object)?(r.object.dispatchEvent(t(e,{type:"pointermove",intersection:r})),r.object.dispatchEvent(t(e,{type:"mousemove",intersection:r}))):(r.object.dispatchEvent(t(e,{type:"pointerenter",intersection:r})),r.object.dispatchEvent(t(e,{type:"mouseenter",intersection:r})));else{const r=i[0];s.has(r.object)?(r.object.dispatchEvent(t(e,{type:"pointermove",intersection:r})),r.object.dispatchEvent(t(e,{type:"mousemove",intersection:r}))):(r.object.dispatchEvent(t(e,{type:"pointerenter",intersection:r})),r.object.dispatchEvent(t(e,{type:"mouseenter",intersection:r})))}for(let e of i)s.set(e.object,e)}else s.forEach(s=>{s.object.dispatchEvent(t(e,{type:"pointerleave",intersection:s})),s.object.dispatchEvent(t(e,{type:"mouseleave",intersection:s}))}),s.clear()}),e.addEventListener("pointerup",e=>{const s=this.intersectObject(e.mouse);if(this.dispatchEvent(t(e,{type:"pointerup",intersections:s})),this.dispatchEvent(t(e,{type:"mouseup",intersections:s})),this.dispatchEvent(t(e,{type:"click",intersections:s})),s.length)if(this.penetrate)for(let i of s)i.object.dispatchEvent(t(e,{type:"pointerup",intersection:i})),i.object.dispatchEvent(t(e,{type:"mouseup",intersection:i})),i.object.dispatchEvent(t(e,{type:"click",intersection:i}));else{const i=s[0];i.object.dispatchEvent(t(e,{type:"pointerup",intersection:i})),i.object.dispatchEvent(t(e,{type:"mouseup",intersection:i})),i.object.dispatchEvent(t(e,{type:"click",intersection:i}))}}),this}}const we=function(e){if(this.eventManager)return console.warn("engine has installed eventManager plugin."),!1;if(!this.webGLRenderer)return console.error("must install some renderer before this plugin."),!1;if(!this.pointerManager)return console.error("must install pointerManager before this plugin."),!1;const t=new be(Object.assign({scene:this.scene,camera:this.currentCamera},e));return t.use(this.pointerManager),this.eventManager=t,this.addEventListener("setCamera",e=>{this.eventManager.setCamera(e.camera)}),this.scene instanceof Z&&(this.eventManager.addEventListener("pointermove",e=>{this.scene.setObjectHelperHover(...e.intersections.map(e=>e.object))}),this.eventManager.addEventListener("click",e=>{this.transing?this.transing=!1:0===e.button&&this.scene.setObjectHelperActive(...e.intersections.map(e=>e.object))})),!0},ve=function(e){return!!we.call(this,e)};var ye;(function(e){e["OBJECTCHANGE"]="objectChange",e["OBJECTCHANGED"]="objectChanged"})(ye||(ye={}));class Se extends h["a"]{constructor(e,t){super(e,t),p(this,"target"),p(this,"transObjectSet"),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this._onPointerDown=e=>{var t;this.enabled&&(null==(t=this.object)?void 0:t.parent)&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))},this.domElement.addEventListener("pointerdown",this._onPointerDown),this.target=new i["U"],this.transObjectSet=new Set;let s="",r=this.target,a=this.transObjectSet,n={x:0,y:0,z:0},o=new WeakMap;this.addEventListener("mouseDown",e=>{s=e.target.mode,"translate"===s&&(s="position"),"rotate"===s&&(s="rotation"),n.x=r[s].x,n.y=r[s].y,n.z=r[s].z,a.forEach(e=>{o.set(e,e.matrixAutoUpdate),e.matrixAutoUpdate=!1})}),this.addEventListener("objectChange",e=>{const t=r[s].x-n.x,i=r[s].y-n.y,o=r[s].z-n.z;n.x=r[s].x,n.y=r[s].y,n.z=r[s].z,a.forEach(e=>{e[s].x+=t,e[s].y+=i,e[s].z+=o,e.updateMatrix(),e.updateMatrixWorld()}),this.dispatchEvent({type:ye.OBJECTCHANGED,transObjectSet:a,mode:s,target:r})}),this.addEventListener("mouseUp",e=>{a.forEach(e=>{e.matrixAutoUpdate=o.get(e),o.delete(e)})})}getTarget(){return this.target}getTransObjectSet(){return this.transObjectSet}setCamera(e){return this.camera=e,this}setAttach(...e){if(this.transObjectSet.clear(),!e.length||!e[0])return this.detach(),this;this.attach(this.target);const t=this.target;if(1===e.length){const s=e[0];return t.scale.copy(s.scale),t.rotation.copy(s.rotation),t.position.copy(s.position),t.updateMatrix(),t.updateMatrixWorld(),this.transObjectSet.add(s),this}const s=[],i=[],r=[];return e.forEach(e=>{s.push(e.position.x),i.push(e.position.y),r.push(e.position.z)}),t.rotation.set(0,0,0),t.scale.set(0,0,0),t.position.x=(Math.max(...s)-Math.min(...s))/2+Math.min(...s),t.position.y=(Math.max(...i)-Math.min(...i))/2+Math.min(...i),t.position.z=(Math.max(...r)-Math.min(...r))/2+Math.min(...r),t.updateMatrix(),t.updateMatrixWorld(),e.forEach(e=>{this.transObjectSet.add(e)}),this}}const Ce=function(e){if(this.transformControls)return console.warn("this has installed transformControls plugin."),!1;if(!this.webGLRenderer)return console.warn("this must install renderer before install transformControls plugin."),!1;if(!this.pointerManager)return console.warn("this must install pointerManager before install transformControls plugin."),!1;if(!this.eventManager)return console.warn("this must install eventManager before install transformControls plugin."),!1;const t=new Se(this.currentCamera,this.dom);return this.transformControls=t,this.transing=!1,t.addEventListener("mouseDown",()=>{this.transing=!0}),this.scene instanceof i["jb"]?(this.scene.add(this.transformControls),this.scene.add(this.transformControls.target)):this.scene instanceof Z&&(this.scene._add(this.transformControls),this.scene._add(this.transformControls.target)),this.setTransformControls=function(e){return this.transformControls.visible=e,this},this.addEventListener("setCamera",e=>{t.setCamera(e.camera)}),this.eventManager.addEventListener("pointerup",e=>{if(!this.transing&&0===e.button){const s=e.intersections.map(e=>e.object);t.setAttach(s[0])}}),!0},Re=function(e){if(Ce.call(this,e)){const e=this.dataSupportManager.getDataSupport(K.CONTROLS).getData();return e[A.TRNASFORMCONTROLS]=N(A.TRNASFORMCONTROLS),!0}return!1},xe=function(e){return this.webGLRenderer?(console.warn("this has installed webglRenderer plugin."),!1):(this.webGLRenderer=new i["Db"](e),this.dom=this.webGLRenderer.domElement,this.setSize=function(e,t){var s,i;return e&&e<=0||t&&t<=0?(console.warn(`you must be input width and height bigger then zero, width: ${e}, height: ${t}`),this):(!e&&(e=null==(s=this.dom)?void 0:s.offsetWidth),!t&&(t=null==(i=this.dom)?void 0:i.offsetHeight),this.dispatchEvent({type:"setSize",width:e,height:t}),this)},this.setCamera=function(e){return this.currentCamera=e,this.dispatchEvent({type:"setCamera",camera:e}),this},this.setDom=function(e){return this.dom=e,e.appendChild(this.webGLRenderer.domElement),this},this.addEventListener("setSize",e=>{const t=e.width,s=e.height;this.webGLRenderer.setSize(t,s,!0);const r=this.currentCamera;r&&(r instanceof i["ab"]?(r.aspect=e.width/e.height,r.updateProjectionMatrix()):r instanceof i["X"]&&(r.left=-t/16,r.right=t/16,r.top=s/16,r.bottom=-s/16,r.updateProjectionMatrix()))}),this.addEventListener("dispose",()=>{this.webGLRenderer.dispose()}),!0)},Le=function(e){if(xe.call(this,e)){const e=this.dataSupportManager.getDataSupport(K.RENDERER).getData();return e.WebGLRenderer||(e.WebGLRenderer=N(te.WEBGLRENDERER)),!0}return!1};var Oe;(function(e){e["WEBGLRENDERER"]="WebGLRenderer",e["SCENE"]="Scene",e["MODELINGSCENE"]="ModelingScene",e["RENDERMANAGER"]="RenderManager",e["ORBITCONTROLS"]="OrbitControls",e["STATS"]="Stats",e["EFFECTCOMPOSER"]="EffectComposer",e["POINTERMANAGER"]="PointerManager",e["EVENTMANAGER"]="EventManager",e["TRANSFORMCONTROLS"]="TransformControls"})(Oe||(Oe={}));let Te=new Map;Te.set("WebGLRenderer",xe),Te.set("Scene",se),Te.set("ModelingScene",Q),Te.set("RenderManager",le),Te.set("OrbitControls",de),Te.set("Stats",ge),Te.set("EffectComposer",fe),Te.set("PointerManager",Ee),Te.set("EventManager",we),Te.set("TransformControls",Ce);const De=class extends d{constructor(){super(),p(this,"completeSet"),p(this,"dom"),p(this,"webGLRenderer"),p(this,"currentCamera"),p(this,"scene"),p(this,"orbitControls"),p(this,"transformControls"),p(this,"effectComposer"),p(this,"renderManager"),p(this,"pointerManager"),p(this,"eventManager"),p(this,"stats"),p(this,"transing"),p(this,"setSize"),p(this,"setCamera"),p(this,"setDom"),p(this,"setStats"),p(this,"setTransformControls"),p(this,"play"),p(this,"stop"),p(this,"render"),this.completeSet=new Set,this.render=function(){return console.warn("can not install some plugin"),this}}install(e,t){return De.pluginHandler.has(e)?De.pluginHandler.get(e).call(this,t):console.error(`engine can not support ${e} plugin.`),this}complete(){return this.completeSet.forEach(e=>{e(this)}),this.completeSet=void 0,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}};let Ae=De;p(Ae,"pluginHandler",Te),p(Ae,"register",(function(e,t){De.pluginHandler&&De.pluginHandler.set(e,t)})),p(Ae,"dispose",(function(){De.pluginHandler=void 0}));function je(e,t){return e in t}function Pe(){return{[A.IMAGETEXTURE]:K.TEXTURE,[A.CUBETEXTURE]:K.TEXTURE,[A.MESHSTANDARDMATERIAL]:K.MATERIAL,[A.MESHPHONGMATERIAL]:K.MATERIAL,[A.AMBIENTLIGHT]:K.LIGHT,[A.SPOTLIGHT]:K.LIGHT,[A.POINTLIGHT]:K.LIGHT,[A.BOXGEOMETRY]:K.GEOMETRY,[A.SPHEREGEOMETRY]:K.GEOMETRY,[A.LOADGEOMETRY]:K.GEOMETRY,[A.MODEL]:K.MODEL,[A.PERSPECTIVECAMERA]:K.CAMERA,[A.ORTHOGRAPHICCAMERA]:K.CAMERA,[A.WEBGLRENDERER]:K.RENDERER,[A.SCENE]:K.SCENE,[A.TRNASFORMCONTROLS]:K.CONTROLS}}const Ge=class extends d{constructor(){super()}proxyExtends(e,t){if(t||(t=[]),Ge.proxyWeakSet.has(e)||"object"!==typeof e&&null!==e)return e;const s={get:(e,t)=>Reflect.get(e,t),set:(s,i,r)=>{let a;if(void 0===s[i]){if("object"===typeof r&&null!==r){const e=t.concat([i]);r=this.proxyExtends(r,e)}a=Reflect.set(s,i,r),this.broadcast({operate:"add",path:t.concat([]),key:i,value:r})}else{if("object"===typeof r&&!Ge.proxyWeakSet.has(e)){const e=t.concat([i]);r=this.proxyExtends(r,e)}a=Reflect.set(s,i,r),this.broadcast({operate:"set",path:t.concat([]),key:i,value:r})}return a},deleteProperty:(e,s)=>{const i=Reflect.deleteProperty(e,s);return this.broadcast({operate:"delete",path:t.concat([]),key:s,value:""}),i}};if("object"===typeof e&&null!==e)for(const i in e){const s=t.concat([i]);je(i,e)&&"object"===typeof e[i]&&null!==e[i]&&(e[i]=this.proxyExtends(e[i],s))}return new Proxy(e,s)}broadcast({operate:e,path:t,key:s,value:i}){const r={__poto__:!0,length:!0};return je(s,r)&&r[s]||this.dispatchEvent({type:"broadcast",notice:{operate:e,path:t,key:s,value:i}}),this}};let He=Ge;p(He,"proxyWeakSet",new WeakSet);class ke{constructor(){p(this,"rule"),p(this,"memberSet"),this.rule=function(){},this.memberSet=new Set}apply(e){return this.memberSet.add(e),this}cancel(e){return this.memberSet.delete(e),this}setRule(e){return this.rule=e,this}translate(e){const t=this.rule;return this.memberSet.forEach(s=>{t(e,s)}),this}}class Ne{constructor(e,t){p(this,"data"),p(this,"broadcast"),p(this,"translater"),this.translater=(new ke).setRule(e),this.broadcast=new He,this.data=this.broadcast.proxyExtends(t),this.broadcast.addEventListener("broadcast",e=>{this.translater.translate(e.notice)})}getData(){return this.data}setData(e){return this.data=e,this}proxyData(e){return this.data=this.broadcast.proxyExtends(e),this.data}addCompiler(e){return e.setTarget(this.data),e.compileAll(),this.translater.apply(e),this}toJSON(){return JSON.stringify(this.data)}load(e){const t=this.data;for(const s in e)t[s]=e[s];return this}}var Ie=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ze(e){return"string"===typeof e&&Ie.test(e)}const Ve=function(e,t){const{operate:s,key:i,path:r,value:a}=e;"add"===s?ze(i)&&t.add(i,a):"set"===s&&t.set(r.concat([]),i,a)};class Fe extends Ne{constructor(e){!e&&(e={}),super(Ve,e)}}const We=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)ze(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();s&&ze(s)?t.set(s,e,i,a):console.warn(`model rule vid is illeage: '${s}'`)}};class Ue extends Ne{constructor(e){!e&&(e={}),super(We,e)}}const Be=/^[og]\s*(.+)?/,$e=/^mtllib /,_e=/^usemtl /,Je=/^usemap /,Xe=new i["Ab"],Ye=new i["Ab"],qe=new i["Ab"],Ke=new i["Ab"],Ze=new i["Ab"];function Qe(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const s=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const s=this._finalize(!1);s&&(s.inherited||s.groupCount<=0)&&this.materials.splice(s.index,1);const i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==s?s.smooth:this.smooth,groupStart:void 0!==s?s.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"===typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let s=this.materials.length-1;s>=0;s--)this.materials[s].groupCount<=0&&this.materials.splice(s,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},s&&s.name&&"function"===typeof s.clone){const e=s.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)},parseNormalIndex:function(e,t){const s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)},parseUVIndex:function(e,t){const s=parseInt(e,10);return 2*(s>=0?s-1:s+t/2)},addVertex:function(e,t,s){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[s+0],i[s+1],i[s+2])},addVertexPoint:function(e){const t=this.vertices,s=this.object.geometry.vertices;s.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices,s=this.object.geometry.vertices;s.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,s){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[s+0],i[s+1],i[s+2])},addFaceNormal:function(e,t,s){const i=this.vertices,r=this.object.geometry.normals;Xe.fromArray(i,e),Ye.fromArray(i,t),qe.fromArray(i,s),Ze.subVectors(qe,Ye),Ke.subVectors(Xe,Ye),Ze.cross(Ke),Ze.normalize(),r.push(Ze.x,Ze.y,Ze.z),r.push(Ze.x,Ze.y,Ze.z),r.push(Ze.x,Ze.y,Ze.z)},addColor:function(e,t,s){const i=this.colors,r=this.object.geometry.colors;void 0!==i[e]&&r.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&r.push(i[t+0],i[t+1],i[t+2]),void 0!==i[s]&&r.push(i[s+0],i[s+1],i[s+2])},addUV:function(e,t,s){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[s+0],i[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs,s=this.object.geometry.uvs;s.push(t[e+0],t[e+1])},addFace:function(e,t,s,i,r,a,n,o,h){const c=this.vertices.length;let l=this.parseVertexIndex(e,c),p=this.parseVertexIndex(t,c),d=this.parseVertexIndex(s,c);if(this.addVertex(l,p,d),this.addColor(l,p,d),void 0!==n&&""!==n){const e=this.normals.length;l=this.parseNormalIndex(n,e),p=this.parseNormalIndex(o,e),d=this.parseNormalIndex(h,e),this.addNormal(l,p,d)}else this.addFaceNormal(l,p,d);if(void 0!==i&&""!==i){const e=this.uvs.length;l=this.parseUVIndex(i,e),p=this.parseUVIndex(r,e),d=this.parseUVIndex(a,e),this.addUV(l,p,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let s=0,i=e.length;s<i;s++){const i=this.parseVertexIndex(e[s],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const s=this.vertices.length,i=this.uvs.length;for(let r=0,a=e.length;r<a;r++)this.addVertexLine(this.parseVertexIndex(e[r],s));for(let r=0,a=t.length;r<a;r++)this.addUVLine(this.parseUVIndex(t[r],i))}};return e.startObject("",!1),e}class et extends i["H"]{constructor(e){super(e),this.materials=null}load(e,t,s,r){const a=this,n=new i["s"](this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,(function(s){try{t(a.parse(s))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),s,r)}setMaterials(e){return this.materials=e,this}parse(e){const t=new Qe;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const s=e.split("\n");let r="",a="",n=0,o=[];const h="function"===typeof"".trimLeft;for(let i=0,p=s.length;i<p;i++)if(r=s[i],r=h?r.trimLeft():r.trim(),n=r.length,0!==n&&(a=r.charAt(0),"#"!==a))if("v"===a){const e=r.split(/\s+/);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?t.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]));break}}else if("f"===a){const e=r.substr(1).trim(),s=e.split(/\s+/),i=[];for(let t=0,r=s.length;t<r;t++){const e=s[t];if(e.length>0){const t=e.split("/");i.push(t)}}const a=i[0];for(let r=1,n=i.length-1;r<n;r++){const e=i[r],s=i[r+1];t.addFace(a[0],e[0],s[0],a[1],e[1],s[1],a[2],e[2],s[2])}}else if("l"===a){const e=r.substring(1).trim().split(" ");let s=[];const i=[];if(-1===r.indexOf("/"))s=e;else for(let t=0,r=e.length;t<r;t++){const r=e[t].split("/");""!==r[0]&&s.push(r[0]),""!==r[1]&&i.push(r[1])}t.addLineGeometry(s,i)}else if("p"===a){const e=r.substr(1).trim(),s=e.split(" ");t.addPointGeometry(s)}else if(null!==(o=Be.exec(r))){const e=(" "+o[0].substr(1).trim()).substr(1);t.startObject(e)}else if(_e.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if($e.test(r))t.materialLibraries.push(r.substring(7).trim());else if(Je.test(r))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===a){if(o=r.split(" "),o.length>1){const e=o[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;const e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===r)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}t.finalize();const c=new i["y"];c.materialLibraries=[].concat(t.materialLibraries);const l=!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length);if(!0===l)for(let p=0,d=t.objects.length;p<d;p++){const e=t.objects[p],s=e.geometry,r=e.materials,a="Line"===s.type,n="Points"===s.type;let o=!1;if(0===s.vertices.length)continue;const h=new i["e"];h.setAttribute("position",new i["t"](s.vertices,3)),s.normals.length>0&&h.setAttribute("normal",new i["t"](s.normals,3)),s.colors.length>0&&(o=!0,h.setAttribute("color",new i["t"](s.colors,3))),!0===s.hasUVIndices&&h.setAttribute("uv",new i["t"](s.uvs,2));const l=[];for(let c=0,p=r.length;c<p;c++){const e=r[c],s=e.name+"_"+e.smooth+"_"+o;let h=t.materials[s];if(null!==this.materials)if(h=this.materials.create(e.name),!a||!h||h instanceof i["C"]){if(n&&h&&!(h instanceof i["eb"])){const e=new i["eb"]({size:10,sizeAttenuation:!1});i["K"].prototype.copy.call(e,h),e.color.copy(h.color),e.map=h.map,h=e}}else{const e=new i["C"];i["K"].prototype.copy.call(e,h),e.color.copy(h.color),h=e}void 0===h&&(h=a?new i["C"]:n?new i["eb"]({size:1,sizeAttenuation:!1}):new i["P"],h.name=e.name,h.flatShading=!e.smooth,h.vertexColors=o,t.materials[s]=h),l.push(h)}let d;if(l.length>1){for(let e=0,t=r.length;e<t;e++){const t=r[e];h.addGroup(t.groupStart,t.groupCount,e)}d=a?new i["D"](h,l):n?new i["db"](h,l):new i["M"](h,l)}else d=a?new i["D"](h,l[0]):n?new i["db"](h,l[0]):new i["M"](h,l[0]);d.name=e.name,c.add(d)}else if(t.vertices.length>0){const e=new i["eb"]({size:1,sizeAttenuation:!1}),s=new i["e"];s.setAttribute("position",new i["t"](t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(s.setAttribute("color",new i["t"](t.colors,3)),e.vertexColors=!0);const r=new i["db"](s,e);c.add(r)}return c}}class tt extends i["H"]{constructor(e){super(e)}load(e,t,s,r){const a=this,n=""===this.path?i["I"].extractUrlBase(e):this.path,o=new i["s"](this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(s){try{t(a.parse(s,n))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),s,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const s=e.split("\n");let i={};const r=/\s+/,a={};for(let o=0;o<s.length;o++){let e=s[o];if(e=e.trim(),0===e.length||"#"===e.charAt(0))continue;const t=e.indexOf(" ");let n=t>=0?e.substring(0,t):e;n=n.toLowerCase();let h=t>=0?e.substring(t+1):"";if(h=h.trim(),"newmtl"===n)i={name:h},a[h]=i;else if("ka"===n||"kd"===n||"ks"===n||"ke"===n){const e=h.split(r,3);i[n]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[n]=h}const n=new st(this.resourcePath||t,this.materialOptions);return n.setCrossOrigin(this.crossOrigin),n.setManager(this.manager),n.setMaterials(a),n}}class st{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:i["w"],this.wrap=void 0!==this.options.wrap?this.options.wrap:i["ib"]}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const s in e){const i=e[s],r={};t[s]=r;for(const e in i){let t=!0,s=i[e];const a=e.toLowerCase();switch(a){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(t=!1);break}t&&(r[a]=s)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,s=this.materialsInfo[e],r={name:e,side:this.side};function a(e,t){return"string"!==typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}function n(e,s){if(r[e])return;const i=t.getTextureParams(s,r),n=t.loadTexture(a(t.baseUrl,i.url));n.repeat.copy(i.scale),n.offset.copy(i.offset),n.wrapS=t.wrap,n.wrapT=t.wrap,r[e]=n}for(const o in s){const e=s[o];let t;if(""!==e)switch(o.toLowerCase()){case"kd":r.color=(new i["j"]).fromArray(e);break;case"ks":r.specular=(new i["j"]).fromArray(e);break;case"ke":r.emissive=(new i["j"]).fromArray(e);break;case"map_kd":n("map",e);break;case"map_ks":n("specularMap",e);break;case"map_ke":n("emissiveMap",e);break;case"norm":n("normalMap",e);break;case"map_bump":case"bump":n("bumpMap",e);break;case"map_d":n("alphaMap",e),r.transparent=!0;break;case"ns":r.shininess=parseFloat(e);break;case"d":t=parseFloat(e),t<1&&(r.opacity=t,r.transparent=!0);break;case"tr":t=parseFloat(e),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(r.opacity=1-t,r.transparent=!0);break}}return this.materials[e]=new i["P"](r),this.materials[e]}getTextureParams(e,t){const s={scale:new i["zb"](1,1),offset:new i["zb"](0,0)},r=e.split(/\s+/);let a;return a=r.indexOf("-bm"),a>=0&&(t.bumpScale=parseFloat(r[a+1]),r.splice(a,2)),a=r.indexOf("-s"),a>=0&&(s.scale.set(parseFloat(r[a+1]),parseFloat(r[a+2])),r.splice(a,4)),a=r.indexOf("-o"),a>=0&&(s.offset.set(parseFloat(r[a+1]),parseFloat(r[a+2])),r.splice(a,4)),s.url=r.join(" ").trim(),s}loadTexture(e,t,s,r,a){const n=void 0!==this.manager?this.manager:i["m"];let o=n.getHandler(e);null===o&&(o=new i["vb"](n)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const h=o.load(e,s,r,a);return void 0!==t&&(h.mapping=t),h}}class it extends d{constructor(){super(),p(this,"resourceMap"),p(this,"loaderMap"),p(this,"loadTotal"),p(this,"loadSuccess"),p(this,"loadError"),p(this,"isError"),p(this,"isLoading"),p(this,"isLoaded"),p(this,"loadDetailMap"),this.resourceMap=new Map,this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={};const e=new i["z"];this.loaderMap={jpg:e,png:e,jpeg:e,obj:new et,mtl:new tt}}loaded(){return this.dispatchEvent({type:he.LOADED,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError,resourceMap:this.resourceMap}),this}checkLoaded(){return this.loadTotal===this.loadSuccess+this.loadError&&(this.isError=!0,this.isLoaded=!0,this.isLoading=!1,this.loaded()),this}load(e){var t;if(this.reset(),this.isLoading=!0,e.length<=0)return this.checkLoaded(),console.warn("url list is empty."),this;this.loadTotal+=e.length;const s=this.resourceMap,i=this.loaderMap,r=this.loadDetailMap;for(let a of e){const e={url:a,progress:0,error:!1,message:a};if(r[a]=e,s.has(a)){e.progress=1,this.loadSuccess+=1,this.dispatchEvent({type:he.DETAILLOADED,detail:e}),this.dispatchEvent({type:he.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded();continue}const n=null==(t=a.split(".").pop())?void 0:t.toLocaleLowerCase();if(!n){e.message=`url: ${a} 地址有误，无法获取文件格式。`,e.error=!0,this.isError=!0,this.loadError+=1;continue}const o=i[n];o?o.loadAsync(a,t=>{e.progress=Number((t.loaded/t.total).toFixed(2)),this.dispatchEvent({type:he.DETAILLOADING,detail:e})}).then(t=>{e.progress=1,this.loadSuccess+=1,this.resourceMap.set(a,t),this.dispatchEvent({type:he.DETAILLOADED,detail:e}),this.dispatchEvent({type:he.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}).catch(t=>{e.error=!0,e.message=JSON.stringify(t),this.loadError+=1,this.dispatchEvent({type:he.DETAILLOADED,detail:e}),this.dispatchEvent({type:he.LOADING,loadTotal:this.loadTotal,loadSuccess:this.loadSuccess,loadError:this.loadError}),this.checkLoaded()}):(e.message=`url: ${a} 不支持此文件格式加载。`,e.error=!0,this.isError=!0,this.loadError+=1)}return this}reset(){return this.loadTotal=0,this.loadSuccess=0,this.loadError=0,this.isError=!1,this.isLoading=!1,this.isLoaded=!1,this.loadDetailMap={},this}register(e,t){return this.loaderMap[e]=t,this}hasLoaded(e){return this.resourceMap.has(e)}getResource(e){return this.resourceMap.get(e)}getLoadDetailMap(){return this.loadDetailMap}setLoadDetailMap(e){return this.loadDetailMap=e,this}dispose(){return this.resourceMap.clear(),this}}var rt;(function(e){e["MAPPED"]="mapped"})(rt||(rt={}));class at extends d{constructor(){super(),p(this,"structureMap",new Map),p(this,"configMap",new Map),p(this,"resourceMap",new Map)}mappingResource(e){const t=this.structureMap,s=this.configMap,r=this.resourceMap,a=function(e,t){const n={type:""+t.type};let o="";if(t.geometry){const a=t.geometry;a.computeBoundingBox();const h=a.boundingBox,c=h.getCenter(new i["Ab"]);o=e+".geometry",r.set(o,a),s.set(o,N(A.LOADGEOMETRY,{url:o,position:{x:c.x/(h.max.x-h.min.x)*2,y:c.y/(h.max.y-h.min.y)*2,z:c.z/(h.max.z-h.min.z)*2}})),n.geometry=o}if(t.material){const i=t.material;i instanceof Array?(n.material=[],i.forEach((t,i,a)=>{o=`${e}.material.${i}`,r.set(o,t),s.set(o,N(t.type,t,!1)),n.material[i]=o})):(o=e+".material",r.set(o,i),s.set(o,N(i.type,i,!1)),n.material=o)}return t.children.length&&(n.children=[],t.children.forEach((t,s,i)=>{o=`${e}.children.${s}`,n.children[s]=a(o,t)})),n};return e.forEach((e,n)=>{e instanceof HTMLImageElement?(r.set(n,e),s.set(n,N(A.IMAGETEXTURE,{image:n})),t.set(n,n)):e instanceof HTMLCanvasElement?(r.set(n,e),t.set(n,n)):e instanceof i["U"]&&t.set(n,a(n,e))}),this.dispatchEvent({type:"mapped",structureMap:t,configMap:s,resourceMap:r}),this}dispose(){}}class nt{static applyConfig(e,t,s){const i={vid:!0,type:!0},r=(e,t)=>{for(const s in e)"object"===typeof e[s]&&null!==typeof e[s]&&je(s,t)?r(e[s],t[s]):je(s,t)&&!i[s]&&(t[s]=e[s])};r(e,t),s&&s()}constructor(){}}class ot extends nt{constructor(e){super(),p(this,"target"),p(this,"scene"),p(this,"engine"),p(this,"map"),p(this,"weakMap"),p(this,"constructMap"),p(this,"objectMapSet"),e?(e.target&&(this.target=e.target),e.scene&&(this.scene=e.scene),e.engine&&(this.engine=e.engine)):(this.scene=new i["jb"],this.target={},this.engine=(new Ae).install(Oe.WEBGLRENDERER)),this.map=new Map,this.weakMap=new WeakMap;const t=new Map;t.set("PerspectiveCamera",()=>new i["ab"]),t.set("OrthographicCamera",()=>new i["X"](0,0,0,0)),this.constructMap=t,this.objectMapSet=new Set}setLookAt(e,t){if(e===t)return console.error("can not set object lookAt itself."),this;const s=this.map.get(e),i=s.userData;if(!t)return i.updateMatrixWorldFun?(s.updateMatrixWorld=i.updateMatrixWorldFun,i.lookAtTarget=void 0,i.updateMatrixWorldFun=void 0,this):this;let r=void 0;for(const n of this.objectMapSet)if(n.has(t)){r=n.get(t);break}if(!r)return console.warn(`camera compiler can not found this vid mapping object in objectMapSet: '${e}'`),this;const a=s.updateMatrixWorld;return i.updateMatrixWorldFun=a,i.lookAtTarget=r.position,s.updateMatrixWorld=e=>{a.bind(s)(e),s.lookAt(i.lookAtTarget)},this}setAdaptiveWindow(e,t){if(!ze(e))return console.error(`camera compiler adaptive window vid is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`camera compiler can not found this vid camera: '${e}'`),this;const s=this.map.get(e);if(!t){if(s.userData.setSizeFun&&this.engine.hasEventListener("setSize",s.userData.setSizeFun))return this.engine.removeEventListener("setSize",s.userData.setSizeFun),s.userData.setSizeFun=void 0,this;if(!s.userData.setSizeFun&&!this.engine.hasEventListener("setSize",s.userData.setSizeFun))return this;if(s.userData.setSizeFun&&!this.engine.hasEventListener("setSize",s.userData.setSizeFun))return s.userData.setSizeFun=void 0,this}if(t){if(s.userData.setSizeFun&&this.engine.hasEventListener("setSize",s.userData.setSizeFun))return this;if(!this.engine.hasEventListener("setSize",s.userData.setSizeFun)&&s.userData.setSizeFun)return this.engine.addEventListener("setSize",s.userData.setSizeFun),this;let e=e=>{};s instanceof i["ab"]?e=e=>{s.aspect=e.width/e.height,s.updateProjectionMatrix()}:s instanceof i["X"]?e=e=>{const t=e.width,i=e.height;s.left=-t/16,s.right=t/16,s.top=i/16,s.bottom=-i/16}:console.warn("camera compiler can not support this class camera:",s),this.engine.addEventListener("setSize",e);const t=this.engine.webGLRenderer.domElement;e({type:"setSize",width:t.offsetWidth,height:t.offsetHeight})}return this}linkObjectMap(e){return this.objectMapSet.has(e)||this.objectMapSet.add(e),this}getSupportVid(e){return this.weakMap.has(e)?this.weakMap.get(e):null}add(e,t){if(ze(e)){if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)(),r=JSON.parse(JSON.stringify(t));delete r.vid,delete r.type,delete r.lookAt,delete r.adaptiveWindow,nt.applyConfig(r,s),(s instanceof i["ab"]||s instanceof i["X"])&&s.updateProjectionMatrix(),this.map.set(e,s),this.setLookAt(t.vid,t.lookAt),this.setAdaptiveWindow(t.vid,t.adaptiveWindow),this.scene.add(s)}}else console.error("camera vid parameter is illegal: "+e);return this}set(e,t,s,r){if(!ze(e))return console.warn(`camera compiler set function vid parameters is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`geometry compiler set function can not found vid geometry: '${e}'`),this;if("lookAt"===s)return this.setLookAt(e,r);if("adaptiveWindow"===s)return this.setAdaptiveWindow(e,r);const a=this.map.get(e);let n=a;return t.forEach((e,t,s)=>{n=a[e]}),n[s]=r,(a instanceof i["ab"]||a instanceof i["X"])&&a.updateProjectionMatrix(),this}remove(){}setEngine(e){return this.engine=e,this}setScene(e){return this.scene=e,this}setTarget(e){return this.target=e,this}getMap(){return this.map}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}}class ht extends nt{constructor(e){super(),p(this,"target"),p(this,"transformControls"),e?(e.target&&(this.target=e.target),e.transformControls&&(this.transformControls=e.transformControls)):(this.target={TransformControls:G()},this.transformControls=new h["a"](new i["f"]))}set(e,t,s,i){if("TransformControls"!==e)return console.warn(`controls compiler can not support this controls: '${e}'`),this;{const e=this.transformControls;if("snapAllow"===s){const t=this.target["TransformControls"];return i?(e.translationSnap=t.translationSnap,e.rotationSnap=t.rotationSnap,e.scaleSnap=t.scaleSnap):(e.translationSnap=null,e.rotationSnap=null,e.scaleSnap=null),this}e[s]=i}return this}setTarget(e){return this.target=e,this}compileAll(){return this}dispose(e){return this}}class ct extends i["e"]{constructor(e){super(),p(this,"type","LoadBufferGeometry"),e&&this.copy(e)}}const lt=class extends nt{constructor(e){super(),p(this,"target"),p(this,"map"),p(this,"constructMap"),p(this,"resourceMap"),p(this,"replaceGeometry"),this.target=e.target,this.map=new Map;const t=new Map;t.set("BoxGeometry",e=>lt.transfromAnchor(new i["c"](e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments),e)),t.set("SphereGeometry",e=>lt.transfromAnchor(new i["mb"](e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength),e)),t.set("LoadGeometry",e=>lt.transfromAnchor(new ct(this.getRescource(e.url)),e)),this.constructMap=t,this.resourceMap=new Map,this.replaceGeometry=new i["c"](10,10,10)}linkRescourceMap(e){return this.resourceMap=e,this}getRescource(e){if(!this.resourceMap.has(e))return console.error("rescoure can not found url: "+e),this.replaceGeometry.clone();if(this.resourceMap.has(e)&&this.resourceMap.get(e)instanceof i["e"]){const t=this.resourceMap.get(e);return t.clone()}return console.error("url mapping rescource is not class with BufferGeometry: "+e),this.replaceGeometry.clone()}getMap(){return this.map}setTarget(){return this}add(e,t){if(ze(e)){if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)(t);this.map.set(e,s)}}else console.error("geometry vid parameter is illegal: "+e);return this}set(e,t,s){if(!ze(e))return console.warn(`geometry compiler set function vid parameters is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`geometry compiler set function can not found vid geometry: '${e}'`),this;const i=this.map.get(e),r=this.target[e],a=this.constructMap.get(r.type)(r);return i.copy(a),i.uuid=a.uuid,a.dispose(),this}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}};let pt=lt;p(pt,"transfromAnchor",(function(e,t){e.center(),!e.boundingBox&&e.computeBoundingBox();const s=e.boundingBox,r=t.position,a=t.rotation,n=t.scale,o=new i["L"],h=new i["Ab"]((s.max.x-s.min.x)/2*r.x,(s.max.y-s.min.y)/2*r.y,(s.max.z-s.min.z)/2*r.z),c=(new i["fb"]).setFromEuler(new i["q"](a.x,a.y,a.z,"XYZ")),l=new i["Ab"](n.x,n.y,n.z);return o.compose(h,c,l),e.applyMatrix4(o),e}));class dt extends nt{constructor(e){super(),p(this,"scene"),p(this,"target"),p(this,"map"),p(this,"weakMap"),p(this,"constructMap"),this.scene=e.scene,this.target=e.target,this.map=new Map,this.weakMap=new WeakMap,this.constructMap=new Map,this.constructMap.set("PointLight",()=>new i["cb"]),this.constructMap.set("SpotLight",()=>new i["pb"]),this.constructMap.set("AmbientLight",()=>new i["a"])}getSupportVid(e){return this.weakMap.has(e)?this.weakMap.get(e):null}add(e,t){if(ze(e)){if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)();nt.applyConfig(t,s),s.color=new i["j"](t.color),this.map.set(e,s),this.weakMap.set(s,e),this.scene.add(s)}}else console.error("vid parameter is illegal: "+e)}set(e,t,s){const i=e.shift();if(ze(i)&&this.map.has(i)){let r=this.map.get(i);e.forEach((e,t,s)=>{r=r[e]}),r[t]=s}else console.error(`vid parameter is illegal: ${i} or can not found this vid light`)}remove(){}setTarget(e){return this.target=e,this}getMap(){return this.map}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}}class ut extends nt{constructor(e){super(),p(this,"target"),p(this,"map"),p(this,"constructMap"),p(this,"mapAttribute"),p(this,"colorAttribute"),p(this,"texturelMap"),p(this,"resourceMap"),p(this,"cachaColor"),e?e.target&&(this.target=e.target):this.target={},this.map=new Map,this.texturelMap=new Map,this.resourceMap=new Map,this.cachaColor=new i["j"];const t=new Map;t.set("MeshStandardMaterial",()=>new i["Q"]),this.constructMap=t,this.colorAttribute={color:!0,emissive:!0},this.mapAttribute={roughnessMap:!0,normalMap:!0,metalnessMap:!0,map:!0,lightMap:!0,envMap:!0,emissiveMap:!0,displacementMap:!0,bumpMap:!0,alphaMap:!0,aoMap:!0}}linkRescourceMap(e){return this.resourceMap=e,this}linkTextureMap(e){return this.texturelMap=e,this}add(e,t){if(ze(e))if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)(),r=JSON.parse(JSON.stringify(t));delete r.type,delete r.vid;const a=this.colorAttribute;for(const e in a)r[e]&&(s[e]=new i["j"](r[e]),delete r[e]);const n=this.mapAttribute;for(const e in n)r[e]&&(s[e]=this.getTexture(r[e]),delete r[e]);nt.applyConfig(r,s),s.needsUpdate=!0,this.map.set(e,s)}else console.warn("material compiler can not support this type: "+t.type);else console.error("material vid parameter is illegal: "+e);return this}set(e,t,s,r){if(!ze(e))return console.warn(`material compiler set function: vid is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`material compiler set function: can not found material which vid is: '${e}'`),this;const a=this.map.get(e);if(this.colorAttribute[s])return a[s]=new i["j"](r),this;if(this.mapAttribute[s])return a[s]=this.getTexture(r),a.needsUpdate=!0,this;let n=a;return t.forEach((e,t,s)=>{n=n[e]}),n[s]=r,this}getTexture(e){if(this.texturelMap.has(e)){const t=this.texturelMap.get(e);return t instanceof i["ub"]?t:(console.error("this object which mapped by vid is not instance of Texture: "+e),null)}return console.error("texture map can not found this vid: "+e),null}getMap(){return this.map}setTarget(e){return this.target=e,this}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}}class mt extends nt{constructor(e){super(),p(this,"scene"),p(this,"target"),p(this,"map"),p(this,"weakMap"),p(this,"constructMap"),p(this,"geometryMap"),p(this,"materialMap"),p(this,"objectMapSet"),p(this,"getReplaceMaterial"),p(this,"getReplaceGeometry"),e?(e.scene&&(this.scene=e.scene),e.target&&(this.target=e.target),e.geometryMap&&(this.geometryMap=e.geometryMap),e.materialMap&&(this.materialMap=e.materialMap)):(this.scene=new i["jb"],this.target={},this.geometryMap=new Map,this.materialMap=new Map),this.map=new Map,this.weakMap=new WeakMap,this.getReplaceMaterial=()=>new i["Q"]({color:"rgb(150, 150, 150)"}),this.getReplaceGeometry=()=>new i["c"](10,10,10);const t=new Map;t.set("Mesh",e=>new i["M"](this.getGeometry(e.geometry),this.getMaterial(e.material))),t.set("Line",e=>new i["B"](this.getGeometry(e.geometry),this.getMaterial(e.material))),t.set("Points",e=>new i["db"](this.getGeometry(e.geometry),this.getMaterial(e.material))),this.constructMap=t,this.objectMapSet=new Set}getMaterial(e){return ze(e)?this.materialMap.has(e)?this.materialMap.get(e):(console.warn("can not found material which vid: "+e),this.getReplaceMaterial()):(console.warn("material vid parameter is illegal: "+e),this.getReplaceMaterial())}getGeometry(e){return ze(e)?this.geometryMap.has(e)?this.geometryMap.get(e):(console.warn("can not found geometry which vid: "+e),this.getReplaceGeometry()):(console.warn("geometry vid parameter is illegal: "+e),this.getReplaceGeometry())}setLookAt(e,t){if(e===t)return console.error("can not set object lookAt itself."),this;const s=this.map.get(e),i=s.userData;if(!t)return i.updateMatrixWorldFun?(s.updateMatrixWorld=i.updateMatrixWorldFun,i.lookAtTarget=null,i.updateMatrixWorldFun=null,this):this;let r=null;for(const n of this.objectMapSet)if(n.has(t)){r=n.get(t);break}if(!r)return console.warn(`model compiler can not found this vid mapping object in objectMapSet: '${e}'`),this;const a=s.updateMatrixWorld;return i.updateMatrixWorldFun=a,i.lookAtTarget=r.position,s.updateMatrixWorld=e=>{a.bind(s)(e),s.lookAt(i.lookAtTarget)},this}setMaterial(e,t){return this.map.get(e).material=this.getMaterial(t),this}getSupportVid(e){return this.weakMap.has(e)?this.weakMap.get(e):null}add(e,t){if(ze(e)){if(t.type&&this.constructMap.has(t.display)){const s=this.constructMap.get(t.display)(t),i=JSON.parse(JSON.stringify(t));delete i.vid,delete i.type,delete i.display,delete i.geometry,delete i.material,delete i.lookAt,nt.applyConfig(i,s),this.map.set(e,s),this.weakMap.set(s,e),this.setLookAt(e,t.lookAt),this.scene.add(s)}}else console.warn("model compiler add function: model vid parameter is illegal: "+e);return this}set(e,t,s,i){if(!ze(e))return console.warn(`model compiler vid is illegal: '${e}'`),this;if(!this.map.has(e))return console.warn(`model compiler can not found this vid mapping object: '${e}'`),this;if("lookAt"===s)return this.setLookAt(e,i);if("material"===s)return this.setMaterial(e,i);let r=this.map.get(e);return t.forEach((e,t,s)=>{r=r[e]}),r[s]=i,this}remove(){}linkGeometryMap(e){return this.geometryMap=e,this}linkMaterialMap(e){return this.materialMap=e,this}linkObjectMap(e){return this.objectMapSet.has(e)||this.objectMapSet.add(e),this}setScene(e){return this.scene=e,this}setTarget(e){return this.target=e,this}getMap(){return this.map}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}}class gt extends nt{constructor(e){super(),p(this,"target"),p(this,"glRenderer"),p(this,"engine"),p(this,"glRendererCacheData"),e?(e.target&&(this.target=e.target),e.glRenderer&&(this.glRenderer=e.glRenderer),e.engine&&(this.engine=e.engine)):(this.target={WebGLRenderer:j()},this.glRenderer=new i["Db"]),this.glRendererCacheData={}}setClearColor(e){const t=Number(e.slice(0,-1).split(",").pop().trim());return this.glRenderer.setClearColor(e,t),this.glRenderer.clear(),this}setPixelRatio(e){return this.glRenderer.setPixelRatio(e),this.glRenderer.clear(),this}setSize(e){const t=this.glRenderer;if(e)t.setSize(e.x,e.y);else{const e=t.domElement;t.setSize(e.offsetWidth,e.offsetHeight)}return this}setViewpoint(e){const t=this.glRenderer;if(e)t.setViewport(e.x,e.y,e.width,e.height);else{const e=t.domElement;t.setViewport(0,0,e.offsetWidth,e.offsetHeight)}return this}setScissor(e){const t=this.glRenderer;if(e)t.setScissorTest(!0),t.setScissor(e.x,e.y,e.width,e.height);else{t.setScissorTest(!1);const e=t.domElement;t.setScissor(0,0,e.offsetWidth,e.offsetHeight)}return this}setAdaptiveCamera(e){if(!this.engine)return console.warn("renderer compiler is not set engine."),this;const t=this.glRenderer,s=this.engine,r=s.renderManager;if(!e){if(!this.glRendererCacheData.adaptiveCameraFun)return this;if(this.glRendererCacheData.adaptiveCameraFun)return r.removeEventListener(re.RENDER,this.glRendererCacheData.adaptiveCameraFun),this.glRendererCacheData.adaptiveCameraFun=void 0,this}if(e){if(this.glRendererCacheData.adaptiveCameraFun)return r.addEventListener(re.RENDER,this.glRendererCacheData.adaptiveCameraFun),this;const e=e=>{const r=s.currentCamera,a=t.domElement.offsetWidth,n=t.domElement.offsetHeight;let o=0,h=0,c=0,l=0,p=0;if(r instanceof i["ab"])p=r.aspect;else{if(!(r instanceof i["X"]))return void console.warn("renderer compiler can not support this camera",r);o=r.right-r.left,h=r.top-r.bottom,p=o/h}p>=1?(o=a,h=o/p,l=n/2-h/2):(h=n,o=h*p,c=a/2-o/2),t.setScissor(c,l,o,h),t.setViewport(c,l,o,h),t.setScissorTest(!0)};this.glRendererCacheData.adaptiveCameraFun=e,r.addEventListener(re.RENDER,this.glRendererCacheData.adaptiveCameraFun)}return this}set(e,t,s){const i=e.shift();if("WebGLRenderer"===i){const i=this.target.WebGLRenderer,r={clearColor:()=>this.setClearColor(s),pixelRatio:()=>this.setPixelRatio(s),size:()=>this.setSize(i.size),viewport:()=>this.setViewpoint(i.viewport),scissor:()=>this.setScissor(i.scissor),adaptiveCamera:()=>this.setAdaptiveCamera(s)};if(r[e[0]||t])return r[e[0]||t](),this;const a=this.glRenderer;let n=a;return e.forEach((e,t,s)=>{n=n[e]}),n[t]=s,a.clear(),this}return console.warn("renderer compiler can not support this type: "+i),this}setTarget(e){return this.target=e,this}compileAll(){const e=this.target,t=e.WebGLRenderer;this.setClearColor(t.clearColor),this.setPixelRatio(t.pixelRatio),this.setSize(t.size),this.setViewpoint(t.viewport),this.setScissor(t.scissor),this.setAdaptiveCamera(t.adaptiveCamera);const s=JSON.parse(JSON.stringify(t));return delete s.vid,delete s.type,delete s.clearColor,delete s.pixelRatio,delete s.size,delete s.viewport,delete s.scissor,delete s.adaptiveCamera,nt.applyConfig(s,this.glRenderer),this.glRenderer.clear(),this}dispose(){return this}}class ft extends nt{constructor(e){super(),p(this,"textureMap"),p(this,"target"),p(this,"scene"),p(this,"fogCache"),e?(e.target&&(this.target=e.target),e.scene&&(this.scene=e.scene)):(this.target={scene:P()},this.scene=new i["jb"]),this.textureMap=new Map,this.fogCache=null}background(e){e?ze(e)?this.textureMap.has(e)?this.scene.background=this.textureMap.get(e):console.warn(`scene compiler can not found this vid texture : '${e}'`):this.scene.background=new i["j"](e):this.scene.background=null}environment(e){e?ze(e)?this.textureMap.has(e)?this.scene.environment=this.textureMap.get(e):console.warn(`scene compiler can not found this vid texture : '${e}'`):console.warn(`this vid is illegal: '${e}'`):this.scene.environment=null}fog(e){if(e)if("Fog"===e.type)if(this.fogCache instanceof i["u"]){const t=this.fogCache;t.color=new i["j"](e.color),t.near=e.near,t.far=e.far}else this.scene.fog=new i["u"](e.color,e.near,e.far),this.fogCache=this.scene.fog;else if("FogExp2"===e.type)if(this.fogCache instanceof i["v"]){const t=this.fogCache;t.color=new i["j"](e.color),t.density=e.density}else this.scene.fog=new i["v"](e.color,e.density),this.fogCache=this.scene.fog;else console.warn(`scene compiler can not support this type fog:'${e.type}'`);else this.scene.fog=null}linkTextureMap(e){return this.textureMap=e,this}set(e,t,s){const i=e.shift();if("scene"===i){const e={background:()=>this.background(s),environment:()=>this.environment(s),fog:()=>this.fog(this.target.scene.fog)};return e[t]&&e[t](),this}return console.warn("scene compiler can not support this type: "+i),this}setTarget(e){return this.target=e,this}compileAll(){const e=this.target.scene;return this.background(e.background),this.environment(e.environment),this.fog(e.fog),this}dispose(){return this}}class Mt extends i["ub"]{constructor(e,t,s,i,r,a,n,o,h,c){super(e,t,s,i,r,a,n,o,h,c)}}class Et extends nt{constructor(e){super(),p(this,"target"),p(this,"map"),p(this,"constructMap"),p(this,"resourceMap"),e?e.target&&(this.target=e.target):this.target={},this.map=new Map,this.resourceMap=new Map;const t=new Map;t.set("ImageTexture",()=>new Mt),t.set("CubeTexture",()=>new i["k"]),this.constructMap=t}getResource(e){const t=this.resourceMap;if(t.has(e)){const s=t.get(e);return s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement?s:(console.error("this url mapping resource is not a texture image class: "+e),null)}return console.warn("resource can not font url: "+e),null}linkRescourceMap(e){return this.resourceMap=e,this}add(e,t){if(ze(e))if(t.type&&this.constructMap.has(t.type)){const s=this.constructMap.get(t.type)(),i=JSON.parse(JSON.stringify(t));if(delete i.type,delete i.vid,"ImageTexture"===t.type)s.image=this.getResource(i.url),delete i.url;else if("CubeTexture"===t.type){const e=t.cube,r=[this.getResource(e.px),this.getResource(e.nx),this.getResource(e.py),this.getResource(e.ny),this.getResource(e.pz),this.getResource(e.nz)];s.image=r,delete i.cube}nt.applyConfig(i,s),s.needsUpdate=!0,this.map.set(e,s)}else console.warn("texture compiler can not support this type: "+t.type);else console.error("texture vid parameter is illegal: "+e);return this}set(e,t,s,i){if(!ze(e))return console.warn(`texture compiler set function: vid is illeage: '${e}'`),this;if(!this.map.has(e))return console.warn(`texture compiler set function: can not found texture which vid is: '${e}'`),this;const r=this.map.get(e);let a=r;return t.forEach((e,t,s)=>{a=a[e]}),a[s]=i,r.needsUpdate=!0,this}getMap(){return this.map}setTarget(e){return this.target=e,this}compileAll(){const e=this.target;for(const t in e)this.add(t,e[t]);return this}dispose(){return this}}const bt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)ze(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();if(!s||!ze(s))return void console.warn(`texture rule vid is illeage: '${s}'`);t.set(s,e,i,a)}};class wt extends Ne{constructor(e){!e&&(e={}),super(bt,e)}}const vt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)ze(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();if(!s||!ze(s))return void console.warn(`material rule vid is illeage: '${s}'`);t.set(s,e,i,a)}};class yt extends Ne{constructor(e){!e&&(e={}),super(vt,e)}}const St=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)ze(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();if(!s||!ze(s))return void console.warn(`geometry rule vid is illeage: '${s}'`);t.set(s,e,a)}};class Ct extends Ne{constructor(e){!e&&(e={}),super(St,e)}}const Rt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("add"===s)ze(i)&&t.add(i,a);else if("set"===s){const e=r.concat([]),s=e.shift();s&&ze(s)?t.set(s,e,i,a):console.warn(`camera rule vid is illeage: '${s}'`)}};class xt extends Ne{constructor(e){!e&&(e={}),super(Rt,e)}}const Lt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;"set"===s&&t.set(r.concat([]),i,a)};class Ot extends Ne{constructor(e){!e&&(e={}),super(Lt,e)}}const Tt=function(e,t){const{operate:s,key:i,path:r,value:a}=e;"set"===s&&t.set(r.concat([]),i,a)};class Dt extends Ne{constructor(e){!e&&(e={scene:P()}),super(Tt,e)}}const At=function(e,t){const{operate:s,key:i,path:r,value:a}=e;if("set"===s){const e=r.concat([]),s=e.shift();s?t.set(s,e,i,a):console.error("controls rule can not found controls type in set operate.")}};class jt extends Ne{constructor(e){!e&&(e={}),super(At,e)}}class Pt{constructor(e){p(this,"cameraDataSupport"),p(this,"lightDataSupport"),p(this,"geometryDataSupport"),p(this,"modelDataSupport"),p(this,"textureDataSupport"),p(this,"materialDataSupport"),p(this,"rendererDataSupport"),p(this,"sceneDataSupport"),p(this,"controlsDataSupport"),p(this,"dataSupportMap"),e?Object.keys(e).forEach(t=>{this[t]=e[t]}):(this.cameraDataSupport=new xt,this.lightDataSupport=new Fe,this.geometryDataSupport=new Ct,this.modelDataSupport=new Ue,this.textureDataSupport=new wt,this.materialDataSupport=new yt,this.rendererDataSupport=new Ot,this.sceneDataSupport=new Dt,this.controlsDataSupport=new jt);const t=new Map;t.set(K.CAMERA,this.cameraDataSupport),t.set(K.LIGHT,this.lightDataSupport),t.set(K.GEOMETRY,this.geometryDataSupport),t.set(K.MODEL,this.modelDataSupport),t.set(K.TEXTURE,this.textureDataSupport),t.set(K.MATERIAL,this.materialDataSupport),t.set(K.RENDERER,this.rendererDataSupport),t.set(K.SCENE,this.sceneDataSupport),t.set(K.CONTROLS,this.controlsDataSupport),this.dataSupportMap=t}getDataSupport(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e):(console.warn("can not found this type in dataSupportManager: "+e),null)}getSupportData(e){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).getData():(console.warn("can not found this type in dataSupportManager: "+e),null)}setSupportData(e,t){return this.dataSupportMap.has(e)?this.dataSupportMap.get(e).setData(t):console.warn("can not found this type in dataSupportManager: "+e),this}load(e){return e.camera&&this.cameraDataSupport.load(e.camera),e.geometry&&this.geometryDataSupport.load(e.geometry),e.light&&this.lightDataSupport.load(e.light),e.material&&this.materialDataSupport.load(e.material),e.model&&this.modelDataSupport.load(e.model),e.texture&&this.textureDataSupport.load(e.texture),e.renderer&&this.rendererDataSupport.load(e.renderer),e.scene&&this.sceneDataSupport.load(e.scene),e.controls&&this.controlsDataSupport.load(e.controls),this}toJSON(){const e={[K.RENDERER]:this.rendererDataSupport.toJSON(),[K.SCENE]:this.sceneDataSupport.toJSON(),[K.CAMERA]:this.cameraDataSupport.toJSON(),[K.GEOMETRY]:this.geometryDataSupport.toJSON(),[K.LIGHT]:this.lightDataSupport.toJSON(),[K.MATERIAL]:this.materialDataSupport.toJSON(),[K.MODEL]:this.modelDataSupport.toJSON(),[K.TEXTURE]:this.textureDataSupport.toJSON(),[K.CONTROLS]:this.controlsDataSupport.toJSON()};return JSON.stringify(e)}}class Gt{constructor(e){p(this,"cameraCompiler"),p(this,"lightCompiler"),p(this,"geometryCompiler"),p(this,"modelCompiler"),p(this,"textureCompiler"),p(this,"materialCompiler"),p(this,"rendererCompiler"),p(this,"sceneCompiler"),p(this,"controlsCompiler"),Object.keys(e).forEach(t=>{this[t]=e[t]})}getObjectVid(e){const t=[this.cameraCompiler,this.lightCompiler,this.modelCompiler];for(let s of t){const t=s.getSupportVid(e);if(t)return t}return null}getMaterial(e){if(!ze(e))return void console.warn("compiler manager vid is illeage: "+e);const t=this.materialCompiler;return t.getMap().get(e)}getTexture(e){if(!ze(e))return void console.warn("compiler manager vid is illeage: "+e);const t=this.textureCompiler;return t.getMap().get(e)}}let Ht=new Map;Ht.set("WebGLRenderer",Le),Ht.set("Scene",ie),Ht.set("ModelingScene",ee),Ht.set("RenderManager",le),Ht.set("Stats",ge),Ht.set("EffectComposer",fe),Ht.set("PointerManager",Ee),Ht.set("EventManager",ve),Ht.set("OrbitControls",ue),Ht.set("TransformControls",Re);const kt=class extends Ae{constructor(e){super(),p(this,"dataSupportManager",new Pt),p(this,"resourceManager",new at),p(this,"loaderManager",new it),p(this,"compilerManager"),e&&e.dataSupportManager&&(this.dataSupportManager=e.dataSupportManager),this.loaderManager.addEventListener("loaded",e=>{this.resourceManager.mappingResource(e.resourceMap)})}mappingResource(e){return this.resourceManager.mappingResource(e),this}load(e,t){const s=()=>{const t=this.dataSupportManager;e.texture&&t.load({texture:e.texture}),e.material&&t.load({material:e.material}),delete e.texture,delete e.material,t.load(e)};if(e.assets&&e.assets.length){this.loaderManager.reset().load(e.assets);const i=r=>{delete e.assets,s(),this.resourceManager.removeEventListener("mapped",i),t&&t(r)};this.resourceManager.addEventListener("mapped",i)}else s(),t&&t()}support(){if(!this.webGLRenderer)return console.warn("support exec must after installed webGLRenderer"),this;if(!this.scene)return console.warn("support exec must after installed some scene"),this;if(!this.renderManager)return console.warn("support exec must after installed renderManager"),this;const e=this.dataSupportManager,t=e.getDataSupport(K.TEXTURE),s=e.getDataSupport(K.MATERIAL),i=e.getDataSupport(K.CAMERA),r=e.getDataSupport(K.LIGHT),a=e.getDataSupport(K.GEOMETRY),n=e.getDataSupport(K.MODEL),o=e.getDataSupport(K.RENDERER),h=e.getDataSupport(K.SCENE),c=e.getDataSupport(K.CONTROLS),l=new Et({target:t.getData()}),p=new ut({target:s.getData()}),d=new ot({target:i.getData(),scene:this.scene,engine:this}),u=new dt({scene:this.scene,target:r.getData()}),m=new pt({target:a.getData()}),g=new mt({scene:this.scene,target:n.getData()}),f=new gt({target:o.getData(),glRenderer:this.webGLRenderer,engine:this}),M=new ft({target:h.getData(),scene:this.scene}),E=new ht({target:c.getData(),transformControls:this.transformControls}),b=this.resourceManager;return M.linkTextureMap(l.getMap()),p.linkTextureMap(l.getMap()),g.linkGeometryMap(m.getMap()).linkMaterialMap(p.getMap()).linkObjectMap(u.getMap()).linkObjectMap(d.getMap()).linkObjectMap(g.getMap()),d.linkObjectMap(u.getMap()).linkObjectMap(d.getMap()).linkObjectMap(g.getMap()),l.linkRescourceMap(b.resourceMap),m.linkRescourceMap(b.resourceMap),t.addCompiler(l),s.addCompiler(p),i.addCompiler(d),r.addCompiler(u),a.addCompiler(m),n.addCompiler(g),o.addCompiler(f),h.addCompiler(M),c.addCompiler(E),this.compilerManager=new Gt({textureCompiler:l,materialCompiler:p,cameraCompiler:d,lightCompiler:u,geometryCompiler:m,modelCompiler:g,rendererCompiler:f,sceneCompiler:M,controlsCompiler:E}),this}install(e,t){return kt.pluginHandler.has(e)?kt.pluginHandler.get(e).call(this,t):console.error(`EngineSupport can not support ${e} plugin.`),this}};let Nt=kt;p(Nt,"pluginHandler",Ht);class It extends Nt{constructor(e){super(e),this.install(Oe.WEBGLRENDERER,{antialias:!0,alpha:!0}).install(Oe.MODELINGSCENE,{hasDefaultPerspectiveCamera:!0,hasDefaultOrthographicCamera:!0,hasAxesHelper:!0,hasGridHelper:!0,hasDisplayMode:!0,displayMode:"env"}).install(Oe.RENDERMANAGER).install(Oe.STATS).install(Oe.EFFECTCOMPOSER,{WebGLMultisampleRenderTarget:!0}).install(Oe.ORBITCONTROLS).install(Oe.POINTERMANAGER).install(Oe.EVENTMANAGER).install(Oe.TRANSFORMCONTROLS).support()}}const zt=class{constructor(){p(this,"supportData"),p(this,"supportDataType")}create(e){return e?(this.supportData={},this.supportDataType=e,this):(console.warn("you must give a module type in create params"),this)}add(e){return this.supportData&&this.supportDataType?e.type?zt.configModelMap[e.type]!==this.supportDataType?(console.warn(`current generator create config which module is in: ${this.supportDataType}, but you provide type is '${e.type}'`),this):(this.supportData[e.vid]=N(e.type,e),this):(console.warn("config can not found attribute 'type'"),this):(console.warn("you must call 'create' method before the 'add' method"),this)}get(){return this.supportDataType=void 0,this.supportData?this.supportData:{}}};let Vt=zt;var Ft;p(Vt,"configModelMap",Pe()),function(e){e["ACTIVE"]="active",e["HOVER"]="hover"}(Ft||(Ft={}));const Wt=new i["cb"]("rgb(255, 255, 255)",.5,200,1);Wt.position.set(-30,5,20),Wt.castShadow=!0;const Ut=new i["M"](new i["c"](80,2,80),new i["Q"]({color:"rgb(255, 255, 255)"}));Ut.position.set(0,-11,0),Ut.receiveShadow=!0,Ut.castShadow=!0;const Bt=class{constructor(e){p(this,"material"),p(this,"dom"),p(this,"renderer"),p(this,"scene"),p(this,"camera"),p(this,"object");const t=new i["Db"]({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=i["Z"];const s=new i["jb"],r=new i["ab"](45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new i["Ab"](0,0,0)),s.add(Bt.ambientLight),s.add(Bt.pointLight),s.add(Bt.plane),this.scene=s,this.renderer=t,this.camera=r,this.object=new i["U"],(null==e?void 0:e.material)&&this.setMaterial(e.material),(null==e?void 0:e.dom)&&this.setDom(e.dom)}setMaterial(e){if(this.scene.remove(this.object),this.material=e,e.type.includes("Mesh"))this.object=new i["M"](Bt.geometry,e);else if(e.type.includes("Line"))this.object=new i["B"](Bt.geometry,e);else if(e.type.includes("Ponits"))this.object=new i["db"](Bt.geometry,e);else{if(!e.type.includes("Sprite"))return console.warn(`material displayer can not support this type material: '${e.type}'`),this;this.object=new i["qb"](e)}return this.object.castShadow=!0,this.object.receiveShadow=!0,this.scene.add(this.object),this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("material displayer must set dom before setSize with empty parameters"),this;const e=this.dom;this.camera.aspect=e.offsetWidth/e.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.offsetWidth,e.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}dispose(){this.renderer.dispose()}};let $t=Bt;p($t,"ambientLight",new i["a"]("rgb(255, 255, 255)",.7)),p($t,"pointLight",Wt),p($t,"geometry",new i["mb"](10,12,12)),p($t,"plane",Ut),p($t,"dispose",()=>{Bt.geometry.dispose(),Bt.plane.geometry.dispose()});const _t=class{constructor(e){p(this,"dom"),p(this,"texture"),p(this,"renderer"),p(this,"scene"),p(this,"camera");const t=new i["Db"]({antialias:!0,preserveDrawingBuffer:!0});t.setPixelRatio(window.devicePixelRatio),t.setClearColor("rgb(150, 150, 150)"),t.shadowMap.enabled=!0,t.shadowMap.type=i["Z"];const s=new i["jb"],r=new i["ab"](45,window.innerWidth/window.innerHeight,1,500);r.position.set(0,0,35),r.up.x=0,r.up.y=1,r.up.z=0,r.lookAt(new i["Ab"](0,0,0)),s.add(_t.ambientLight),this.scene=s,this.renderer=t,this.camera=r,(null==e?void 0:e.texture)&&this.setTexture(e.texture),(null==e?void 0:e.dom)&&this.setDom(e.dom)}setTexture(e){return this.scene.background=e,this}setDom(e){return this.dom=e,this.setSize(),e.appendChild(this.renderer.domElement),this}setSize(e,t){if(e&&t)this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t,!0);else{if(!this.dom)return console.warn("texture displayer must set dom before setSize with empty parameters"),this;const e=this.dom;this.camera.aspect=e.offsetWidth/e.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.offsetWidth,e.offsetHeight,!0)}return this}render(){this.renderer.render(this.scene,this.camera)}dispose(){this.renderer.dispose()}};let Jt=_t;p(Jt,"ambientLight",new i["a"]("rgb(255, 255, 255)",1))}}]);